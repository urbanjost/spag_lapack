<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>ZGEJSV &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>ZGEJSV
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.4% of total for procedures.">970 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/zgejsv.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/zgejsv.f90.html'>zgejsv.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">ZGEJSV</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/zgejsv.html#variable-cone~60">CONE</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-czero~43">CZERO</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-one~368">ONE</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-zero~357">ZERO</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-aapp~3">aapp</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-aaqq~3">aaqq</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-aatmax~2">aatmax</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-aatmin~2">aatmin</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-almort~2">almort</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-big~7">big</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-big1~2">big1</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-cdummy~3">cdummy</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-cond_ok~2">cond_ok</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-condr1~2">condr1</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-condr2~2">condr2</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-ctemp~7">ctemp</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-defr~2">defr</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-entra~2">entra</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-entrat~2">entrat</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-epsln~5">epsln</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-errest~2">errest</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-goscal~2">goscal</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-ierr~33">ierr</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-iwoff~4">iwoff</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-jracc~2">jracc</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-kill~2">kill</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-l2aber~2">l2aber</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-l2kill~2">l2kill</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-l2pert~2">l2pert</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-l2rank~2">l2rank</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-l2tran~2">l2tran</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lquery~153">lquery</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lrwcon~2">lrwcon</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lrwqp3~2">lrwqp3</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lrwsvdj~2">lrwsvdj</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lsvec~5">lsvec</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwcon~4">lwcon</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwlqf~4">lwlqf</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwqp3~4">lwqp3</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwqrf~4">lwqrf</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgelqf~2">lwrk_zgelqf</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgeqp3~2">lwrk_zgeqp3</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgeqp3n">lwrk_zgeqp3n</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgeqrf~2">lwrk_zgeqrf</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgesvj">lwrk_zgesvj</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgesvju">lwrk_zgesvju</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zgesvjv">lwrk_zgesvjv</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zunmlq~2">lwrk_zunmlq</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zunmqr~2">lwrk_zunmqr</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwrk_zunmqrm">lwrk_zunmqrm</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwsvdj~2">lwsvdj</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwsvdjv~2">lwsvdjv</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwunmlq~2">lwunmlq</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwunmqr~2">lwunmqr</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-lwunmqrm~2">lwunmqrm</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-maxprj~2">maxprj</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-miniwrk~2">miniwrk</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-minrwrk~2">minrwrk</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-minwrk~19">minwrk</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-n1~33">n1</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-noscal~2">noscal</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-nr~7">nr</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-numrank~2">numrank</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-optwrk~4">optwrk</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-p~15">p</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-q~7">q</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-rdummy~4">rdummy</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-rowpiv~2">rowpiv</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-rsvec~5">rsvec</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-scalem~2">scalem</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-sconda~4">sconda</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-sfmin~22">sfmin</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-small~11">small</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-temp1~12">temp1</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-transp~2">transp</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-uscal1~2">uscal1</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-uscal2~2">uscal2</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-warning~2">warning</a>
            <a class="list-group-item" href="../proc/zgejsv.html#variable-xsc~2">xsc</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/zgejsv.html#src">ZGEJSV</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine ZGEJSV(Joba, Jobu, Jobv, Jobr, Jobt, Jobp, M, N, A, Lda, Sva, U, Ldu, V, Ldv, Cwork, Lwork, Rwork, Lrwork, Iwork, Info)  
</h2>
    

    <p>\brief \b ZGEJSV
 \htmlonly
 Download ZGEJSV + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/zgejsv.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/zgejsv.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/zgejsv.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>ZGEJSV computes the singular value decomposition (SVD) of a complex M-by-N
 matrix [A], where M &gt;= N. The SVD of [A] is written as</p>
<div class="codehilite"><pre><span></span><code><span class="w">          </span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">U</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">[</span><span class="n">SIGMA</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">[</span><span class="n">V</span><span class="o">]^*</span><span class="p">,</span><span class="w"></span>
</code></pre></div>

<p>where [SIGMA] is an N-by-N (M-by-N) matrix which is zero except for its N
 diagonal elements, [U] is an M-by-N (or M-by-M) unitary matrix, and
 [V] is an N-by-N unitary matrix. The diagonal elements of [SIGMA] are
 the singular values of [A]. The columns of [U] and [V] are the left and
 the right singular vectors of [A], respectively. The matrices [U] and [V]
 are computed and stored in the arrays U and V, respectively. The diagonal
 of [SIGMA] is computed and stored in the array SVA.
 \endverbatim</p>
<p>Arguments:
  ==========</p>
<p>\param[in] JOBA
 \verbatim
          JOBA is CHARACTER<em>1
         Specifies the level of accuracy:
       = &lsquo;C&rsquo;: This option works well (high relative accuracy) if A = B * D,
              with well-conditioned B and arbitrary diagonal matrix D.
              The accuracy cannot be spoiled by COLUMN scaling. The
              accuracy of the computed output depends on the condition of
              B, and the procedure aims at the best theoretical accuracy.
              The relative error max_{i=1:N}|d sigma_i| / sigma_i is
              bounded by f(M,N)</em>epsilon<em> cond(B), independent of D.
              The input matrix is preprocessed with the QRF with column
              pivoting. This initial preprocessing and preconditioning by
              a rank revealing QR factorization is common for all values of
              JOBA. Additional actions are specified as follows:
       = &lsquo;E&rsquo;: Computation as with &lsquo;C&rsquo; with an additional estimate of the
              condition number of B. It provides a realistic error bound.
       = &lsquo;F&rsquo;: If A = D1 * C * D2 with ill-conditioned diagonal scalings
              D1, D2, and well-conditioned matrix C, this option gives
              higher accuracy than the &lsquo;C&rsquo; option. If the structure of the
              input matrix is not known, and relative accuracy is
              desirable, then this option is advisable. The input matrix A
              is preprocessed with QR factorization with FULL (row and
              column) pivoting.
       = &lsquo;G&rsquo;: Computation as with &lsquo;F&rsquo; with an additional estimate of the
              condition number of B, where A=B</em>D. If A has heavily weighted
              rows, then using this condition number gives too pessimistic
              error bound.
       = &lsquo;A&rsquo;: Small singular values are not well determined by the data
              and are considered as noisy; the matrix is treated as
              numerically rank deficient. The error in the computed
              singular values is bounded by f(m,n)<em>epsilon</em>||A||.
              The computed SVD A = U * S * V^<em> restores A up to
              f(m,n)</em>epsilon<em>||A||.
              This gives the procedure the licence to discard (set to zero)
              all singular values below N</em>epsilon*||A||.
       = &lsquo;R&rsquo;: Similar as in &lsquo;A&rsquo;. Rank revealing property of the initial
              QR factorization is used do reveal (using triangular factor)
              a gap sigma_{r+1} &lt; epsilon * sigma_r in which case the
              numerical RANK is declared to be r. The SVD is computed with
              absolute error bounds, but more accurately than with &lsquo;A&rsquo;.
 \endverbatim</p>
<p>\param[in] JOBU
 \verbatim
          JOBU is CHARACTER<em>1
         Specifies whether to compute the columns of U:
       = &lsquo;U&rsquo;: N columns of U are returned in the array U.
       = &lsquo;F&rsquo;: full set of M left sing. vectors is returned in the array U.
       = &lsquo;W&rsquo;: U may be used as workspace of length M</em>N. See the description
              of U.
       = &lsquo;N&rsquo;: U is not computed.
 \endverbatim</p>
<p>\param[in] JOBV
 \verbatim
          JOBV is CHARACTER<em>1
         Specifies whether to compute the matrix V:
       = &lsquo;V&rsquo;: N columns of V are returned in the array V; Jacobi rotations
              are not explicitly accumulated.
       = &lsquo;J&rsquo;: N columns of V are returned in the array V, but they are
              computed as the product of Jacobi rotations, if JOBT = &lsquo;N&rsquo;.
       = &lsquo;W&rsquo;: V may be used as workspace of length N</em>N. See the description
              of V.
       = &lsquo;N&rsquo;: V is not computed.
 \endverbatim</p>
<p>\param[in] JOBR
 \verbatim
          JOBR is CHARACTER<em>1
         Specifies the RANGE for the singular values. Issues the licence to
         set to zero small positive singular values if they are outside
         specified range. If A .NE. 0 is scaled so that the largest singular
         value of c</em>A is around SQRT(BIG), BIG=DLAMCH(&lsquo;O&rsquo;), then JOBR issues
         the licence to kill columns of A whose norm in c<em>A is less than
         SQRT(SFMIN) (for JOBR = &lsquo;R&rsquo;), or less than SMALL=SFMIN/EPSLN,
         where SFMIN=DLAMCH(&lsquo;S&rsquo;), EPSLN=DLAMCH(&lsquo;E&rsquo;).
       = &lsquo;N&rsquo;: Do not kill small columns of c</em>A. This option assumes that
              BLAS and QR factorizations and triangular solvers are
              implemented to work in that range. If the condition of A
              is greater than BIG, use ZGESVJ.
       = &lsquo;R&rsquo;: RESTRICTED range for sigma(c*A) is [SQRT(SFMIN), SQRT(BIG)]
              (roughly, as described above). This option is recommended.
                                             ===========================
         For computing the singular values in the FULL range [SFMIN,BIG]
         use ZGESVJ.
 \endverbatim</p>
<p>\param[in] JOBT
 \verbatim
          JOBT is CHARACTER<em>1
         If the matrix is square then the procedure may determine to use
         transposed A if A^</em> seems to be better with respect to convergence.
         If the matrix is not square, JOBT is ignored.
         The decision is based on two values of entropy over the adjoint
         orbit of A^<em> * A. See the descriptions of WORK(6) and WORK(7).
       = &lsquo;T&rsquo;: transpose if entropy test indicates possibly faster
         convergence of Jacobi process if A^</em> is taken as input. If A is
         replaced with A^*, then the row pivoting is included automatically.
       = &lsquo;N&rsquo;: do not speculate.
         The option &lsquo;T&rsquo; can be used to compute only the singular values, or
         the full SVD (U, SIGMA and V). For only one set of singular vectors
         (U or V), the caller should provide both U and V, as one of the
         matrices is used as workspace if the matrix A is transposed.
         The implementer can easily remove this constraint and make the
         code more complicated. See the descriptions of U and V.
         In general, this option is considered experimental, and &lsquo;N&rsquo;; should
         be preferred. This is subject to changes in the future.
 \endverbatim</p>
<p>\param[in] JOBP
 \verbatim
          JOBP is CHARACTER*1
         Issues the licence to introduce structured perturbations to drown
         denormalized numbers. This licence should be active if the
         denormals are poorly implemented, causing slow computation,
         especially in cases of fast convergence (!). For details see [1,2].
         For the sake of simplicity, this perturbations are included only
         when the full SVD or only the singular values are requested. The
         implementer/user can easily add the perturbation for the cases of
         computing one set of singular vectors.
       = &lsquo;P&rsquo;: introduce perturbation
       = &lsquo;N&rsquo;: do not perturb
 \endverbatim</p>
<p>\param[in] M
 \verbatim
          M is INTEGER
         The number of rows of the input matrix A.  M &gt;= 0.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
         The number of columns of the input matrix A. M &gt;= N &gt;= 0.
 \endverbatim</p>
<p>\param[in,out] A
 \verbatim
          A is COMPLEX*16 array, dimension (LDA,N)
          On entry, the M-by-N matrix A.
 \endverbatim</p>
<p>\param[in] LDA
 \verbatim
          LDA is INTEGER
          The leading dimension of the array A.  LDA &gt;= max(1,M).
 \endverbatim</p>
<p>\param[out] SVA
 \verbatim
          SVA is DOUBLE PRECISION array, dimension (N)
          On exit,
          - For WORK(1)/WORK(2) = ONE: The singular values of A. During the
            computation SVA contains Euclidean column norms of the
            iterated matrices in the array A.
          - For WORK(1) .NE. WORK(2): The singular values of A are
            (WORK(1)/WORK(2)) * SVA(1:N). This factored form is used if
            sigma_max(A) overflows or if small singular values have been
            saved from underflow by scaling the input matrix A.
          - If JOBR=&rsquo;R&rsquo; then some of the singular values may be returned
            as exact zeros obtained by &ldquo;set to zero&rdquo; because they are
            below the numerical rank threshold or are denormalized numbers.
 \endverbatim</p>
<p>\param[out] U
 \verbatim
          U is COMPLEX<em>16 array, dimension ( LDU, N )
          If JOBU = &lsquo;U&rsquo;, then U contains on exit the M-by-N matrix of
                         the left singular vectors.
          If JOBU = &lsquo;F&rsquo;, then U contains on exit the M-by-M matrix of
                         the left singular vectors, including an ONB
                         of the orthogonal complement of the Range(A).
          If JOBU = &lsquo;W&rsquo;  .AND. (JOBV = &lsquo;V&rsquo; .AND. JOBT = &lsquo;T&rsquo; .AND. M = N),
                         then U is used as workspace if the procedure
                         replaces A with A^</em>. In that case, [V] is computed
                         in U as left singular vectors of A^<em> and then
                         copied back to the V array. This &lsquo;W&rsquo; option is just
                         a reminder to the caller that in this case U is
                         reserved as workspace of length N</em>N.
          If JOBU = &lsquo;N&rsquo;  U is not referenced, unless JOBT=&rsquo;T&rsquo;.
 \endverbatim</p>
<p>\param[in] LDU
 \verbatim
          LDU is INTEGER
          The leading dimension of the array U,  LDU &gt;= 1.
          IF  JOBU = &lsquo;U&rsquo; or &lsquo;F&rsquo; or &lsquo;W&rsquo;,  then LDU &gt;= M.
 \endverbatim</p>
<p>\param[out] V
 \verbatim
          V is COMPLEX<em>16 array, dimension ( LDV, N )
          If JOBV = &lsquo;V&rsquo;, &lsquo;J&rsquo; then V contains on exit the N-by-N matrix of
                         the right singular vectors;
          If JOBV = &lsquo;W&rsquo;, AND (JOBU = &lsquo;U&rsquo; AND JOBT = &lsquo;T&rsquo; AND M = N),
                         then V is used as workspace if the pprocedure
                         replaces A with A^</em>. In that case, [U] is computed
                         in V as right singular vectors of A^<em> and then
                         copied back to the U array. This &lsquo;W&rsquo; option is just
                         a reminder to the caller that in this case V is
                         reserved as workspace of length N</em>N.
          If JOBV = &lsquo;N&rsquo;  V is not referenced, unless JOBT=&rsquo;T&rsquo;.
 \endverbatim</p>
<p>\param[in] LDV
 \verbatim
          LDV is INTEGER
          The leading dimension of the array V,  LDV &gt;= 1.
          If JOBV = &lsquo;V&rsquo; or &lsquo;J&rsquo; or &lsquo;W&rsquo;, then LDV &gt;= N.
 \endverbatim</p>
<p>\param[out] CWORK
 \verbatim
          CWORK is COMPLEX*16 array, dimension (MAX(2,LWORK))
          If the call to ZGEJSV is a workspace query (indicated by LWORK=-1 or
          LRWORK=-1), then on exit CWORK(1) contains the required length of
          CWORK for the job parameters used in the call.
 \endverbatim</p>
<p>\param[in] LWORK
 \verbatim
          LWORK is INTEGER
          Length of CWORK to confirm proper allocation of workspace.
          LWORK depends on the job:</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span><span class="mf">1.</span><span class="w"> </span><span class="nf">If</span><span class="w"> </span><span class="kr">only</span><span class="w"> </span><span class="n">SIGMA</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kr">and</span><span class="w"></span>
<span class="w">        </span><span class="mf">1.1</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="p">(</span><span class="n">JOBA</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="s">&#39;E&#39;</span><span class="p">.</span><span class="kr">AND</span><span class="p">.</span><span class="n">JOBA</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="s">&#39;G&#39;</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mf">1.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="p">(</span><span class="n">blocked</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
<span class="w">           </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">.</span><span class="w"> </span><span class="n">Here</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"></span>
<span class="w">           </span><span class="n">block</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGESVJ</span><span class="p">)).</span><span class="w"></span>
<span class="w">        </span><span class="mf">1.2</span><span class="p">.</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">           </span><span class="n">required</span><span class="w"> </span><span class="p">(</span><span class="n">JOBA</span><span class="o">=</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="s">&#39;G&#39;</span><span class="p">).</span><span class="w"> </span><span class="kr">In</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="kr">case</span><span class="p">,</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"></span>
<span class="w">           </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="p">(</span><span class="n">blocked</span><span class="w"> </span><span class="n">code</span><span class="p">)</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">value</span><span class="w"></span>
<span class="w">           </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span><span class="o">=</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGESVJ</span><span class="p">),</span><span class="w"></span>
<span class="w">                        </span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZPOCON</span><span class="p">)).</span><span class="w"></span>
<span class="w">      </span><span class="mf">2.</span><span class="w"> </span><span class="nf">If</span><span class="w"> </span><span class="n">SIGMA</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">right</span><span class="w"> </span><span class="n">singular</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="p">(</span><span class="n">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;V&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="mf">2.1</span><span class="w">   </span><span class="p">..</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="p">(</span><span class="n">JOBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">)</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">where</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">,</span><span class="w"> </span><span class="n">ZGELQ</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">ZUNMLQ</span><span class="p">.</span><span class="w"> </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGESVJ</span><span class="p">),</span><span class="w"></span>
<span class="w">                   </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGELQF</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZUNMLQ</span><span class="p">)).</span><span class="w"></span>
<span class="w">        </span><span class="mf">2.2</span><span class="w"> </span><span class="p">..</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">           </span><span class="n">required</span><span class="w"> </span><span class="p">(</span><span class="n">JOBA</span><span class="o">=</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="s">&#39;G&#39;</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">)</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">where</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">,</span><span class="w"> </span><span class="n">ZGELQ</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">ZUNMLQ</span><span class="p">.</span><span class="w"> </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="w"> </span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZPOCON</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGESVJ</span><span class="p">),</span><span class="w"></span>
<span class="w">                   </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGELQF</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZUNMLQ</span><span class="p">)).</span><span class="w"></span>
<span class="w">      </span><span class="mf">3.</span><span class="w"> </span><span class="nf">If</span><span class="w"> </span><span class="n">SIGMA</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">left</span><span class="w"> </span><span class="n">singular</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">needed</span><span class="w"></span>
<span class="w">        </span><span class="mf">3.1</span><span class="w">  </span><span class="p">..</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="p">(</span><span class="n">JOBE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;N&#39;</span><span class="p">)</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="o">:</span><span class="w"></span>
<span class="w">           </span><span class="nf">if</span><span class="w"> </span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;U&#39;</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">)</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">where</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">,</span><span class="w"> </span><span class="n">ZUNMQR</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZUNMQR</span><span class="p">)).</span><span class="w"></span>
<span class="w">        </span><span class="mf">3.2</span><span class="w">  </span><span class="p">..</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">estimate</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scaled</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">           </span><span class="n">required</span><span class="w"> </span><span class="p">(</span><span class="n">JOBA</span><span class="o">=</span><span class="s">&#39;E&#39;</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="s">&#39;G&#39;</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">performance</span><span class="o">:</span><span class="w"></span>
<span class="w">           </span><span class="nf">if</span><span class="w"> </span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;U&#39;</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">)</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">NB</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">where</span><span class="w"> </span><span class="n">NB</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">,</span><span class="w"> </span><span class="n">ZUNMQR</span><span class="p">.</span><span class="w"></span>
<span class="w">           </span><span class="kr">In</span><span class="w"> </span><span class="n">general</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">computed</span><span class="w"> </span><span class="kr">as</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQP3</span><span class="p">),</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZPOCON</span><span class="p">),</span><span class="w"></span>
<span class="w">                    </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZGEQRF</span><span class="p">),</span><span class="w"> </span><span class="n">N</span><span class="o">+</span><span class="n">LWORK</span><span class="p">(</span><span class="n">ZUNMQR</span><span class="p">)).</span><span class="w"></span>
<span class="w">      </span><span class="mf">4.</span><span class="w"> </span><span class="nf">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">full</span><span class="w"> </span><span class="n">SVD</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">needed</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;U&#39;</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="n">JOBU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;F&#39;</span><span class="p">)</span><span class="w"> </span><span class="kr">and</span><span class="w"></span>
<span class="w">        </span><span class="mf">4.1</span><span class="p">.</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="n">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;V&#39;</span><span class="w"></span>
<span class="w">           </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="mf">4.2</span><span class="p">.</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="n">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;J&#39;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">is</span><span class="w"></span>
<span class="w">           </span><span class="n">LWORK</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="kr">In</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">cases</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">CWORK</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">accommodate</span><span class="w"> </span><span class="n">blocked</span><span class="w"> </span><span class="n">runs</span><span class="w"></span>
<span class="w">        </span><span class="kr">of</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="p">,</span><span class="w"> </span><span class="n">ZGELQF</span><span class="p">,</span><span class="w"> </span><span class="n">SUNMQR</span><span class="p">,</span><span class="w"> </span><span class="n">ZUNMLQ</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="nf">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">ZGEJSV</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">workspace</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="p">(</span><span class="n">indicated</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">LWORK</span><span class="o">=-</span><span class="mi">1</span><span class="w"> </span><span class="kr">or</span><span class="w"></span>
<span class="w">      </span><span class="n">LRWORK</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">CWORK</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimal</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">CWORK</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">the</span><span class="w"></span>
<span class="w">      </span><span class="n">minimal</span><span class="w"> </span><span class="nf">length</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">CWORK</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] RWORK
 \verbatim
          RWORK is DOUBLE PRECISION array, dimension (MAX(7,LWORK))
          On exit,
          RWORK(1) = Determines the scaling factor SCALE = RWORK(2) / RWORK(1)
                    such that SCALE<em>SVA(1:N) are the computed singular values
                    of A. (See the description of SVA().)
          RWORK(2) = See the description of RWORK(1).
          RWORK(3) = SCONDA is an estimate for the condition number of
                    column equilibrated A. (If JOBA = &lsquo;E&rsquo; or &lsquo;G&rsquo;)
                    SCONDA is an estimate of SQRT(||(R^</em> * R)^(-1)||_1).
                    It is computed using SPOCON. It holds
                    N^(-1/4) * SCONDA &lt;= ||R^(-1)||_2 &lt;= N^(1/4) * SCONDA
                    where R is the triangular factor from the QRF of A.
                    However, if R is truncated and the numerical rank is
                    determined to be strictly smaller than N, SCONDA is
                    returned as -1, thus indicating that the smallest
                    singular values might be lost.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">full</span> <span class="nv">SVD</span> <span class="nv">is</span> <span class="nv">needed</span>, <span class="nv">the</span> <span class="nv">following</span> <span class="nv">two</span> <span class="nv">condition</span> <span class="nv">numbers</span> <span class="nv">are</span>
      <span class="nv">useful</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">analysis</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">algorithm</span>. <span class="nv">They</span> <span class="nv">are</span> <span class="nv">provided</span> <span class="k">for</span>
      <span class="nv">a</span> <span class="nv">developer</span><span class="o">/</span><span class="nv">implementer</span> <span class="nv">who</span> <span class="nv">is</span> <span class="nv">familiar</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">details</span> <span class="nv">of</span>
      <span class="nv">the</span> <span class="nv">method</span>.

      <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">4</span><span class="ss">)</span> <span class="o">=</span> <span class="nv">an</span> <span class="nv">estimate</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">scaled</span> <span class="nv">condition</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">the</span>
                <span class="nv">triangular</span> <span class="nv">factor</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">QR</span> <span class="nv">factorization</span>.
      <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span> <span class="o">=</span> <span class="nv">an</span> <span class="nv">estimate</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">scaled</span> <span class="nv">condition</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">the</span>
                <span class="nv">triangular</span> <span class="nv">factor</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">second</span> <span class="nv">QR</span> <span class="nv">factorization</span>.
      <span class="nv">The</span> <span class="nv">following</span> <span class="nv">two</span> <span class="nv">parameters</span> <span class="nv">are</span> <span class="nv">computed</span> <span class="k">if</span> <span class="nv">JOBT</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">T</span><span class="s1">&#39;</span>.
      <span class="nv">They</span> <span class="nv">are</span> <span class="nv">provided</span> <span class="k">for</span> <span class="nv">a</span> <span class="nv">developer</span><span class="o">/</span><span class="nv">implementer</span> <span class="nv">who</span> <span class="nv">is</span> <span class="nv">familiar</span>
      <span class="nv">with</span> <span class="nv">the</span> <span class="nv">details</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">method</span>.
      <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">6</span><span class="ss">)</span> <span class="o">=</span> <span class="nv">the</span> <span class="nv">entropy</span> <span class="nv">of</span> <span class="nv">A</span><span class="o">^*</span> <span class="o">*</span> <span class="nv">A</span> :: <span class="nv">this</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">Shannon</span> <span class="nv">entropy</span>
                <span class="nv">of</span> <span class="nv">diag</span><span class="ss">(</span><span class="nv">A</span><span class="o">^*</span> <span class="o">*</span> <span class="nv">A</span><span class="ss">)</span> <span class="o">/</span> <span class="nv">Trace</span><span class="ss">(</span><span class="nv">A</span><span class="o">^*</span> <span class="o">*</span> <span class="nv">A</span><span class="ss">)</span> <span class="nv">taken</span> <span class="nv">as</span> <span class="nv">point</span> <span class="nv">in</span> <span class="nv">the</span>
                <span class="nv">probability</span> <span class="nv">simplex</span>.
      <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">7</span><span class="ss">)</span> <span class="o">=</span> <span class="nv">the</span> <span class="nv">entropy</span> <span class="nv">of</span> <span class="nv">A</span> <span class="o">*</span> <span class="nv">A</span><span class="o">^*</span>. <span class="ss">(</span><span class="nv">See</span> <span class="nv">the</span> <span class="nv">description</span> <span class="nv">of</span> <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">6</span><span class="ss">)</span>.<span class="ss">)</span>
      <span class="k">If</span> <span class="nv">the</span> <span class="k">call</span> <span class="nl">to</span> <span class="nv">ZGEJSV</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span> <span class="ss">(</span><span class="nv">indicated</span> <span class="nv">by</span> <span class="nv">LWORK</span><span class="o">=-</span><span class="mi">1</span> <span class="nv">or</span>
      <span class="nv">LRWORK</span><span class="o">=-</span><span class="mi">1</span><span class="ss">)</span>, <span class="k">then</span> <span class="nv">on</span> <span class="k">exit</span> <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> <span class="nv">contains</span> <span class="nv">the</span> <span class="nv">required</span> <span class="nv">length</span> <span class="nv">of</span>
      <span class="nv">RWORK</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">job</span> <span class="nv">parameters</span> <span class="nv">used</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">call</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] LRWORK
 \verbatim
          LRWORK is INTEGER
          Length of RWORK to confirm proper allocation of workspace.
          LRWORK depends on the job:</p>
<div class="codehilite"><pre><span></span><code>   <span class="mi">1</span>. <span class="k">If</span> <span class="nv">only</span> <span class="nv">the</span> <span class="nv">singular</span> <span class="nv">values</span> <span class="nv">are</span> <span class="nv">requested</span> <span class="nv">i</span>.<span class="nv">e</span>. <span class="k">if</span>
      <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">N</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">AND</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">N</span><span class="s1">&#39;</span><span class="ss">)</span>
      <span class="k">then</span>:
      <span class="mi">1</span>.<span class="mi">1</span>. <span class="k">If</span> <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBT</span>,<span class="s1">&#39;</span><span class="s">T</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">G</span><span class="s1">&#39;</span><span class="ss">)</span>,
           <span class="k">then</span>: <span class="nv">LRWORK</span> <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>, <span class="mi">2</span> <span class="o">*</span> <span class="nv">M</span> <span class="ss">)</span>.
      <span class="mi">1</span>.<span class="mi">2</span>. <span class="nv">Otherwise</span>, <span class="nv">LRWORK</span>  <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>,  <span class="nv">N</span> <span class="ss">)</span>.
   <span class="mi">2</span>. <span class="k">If</span> <span class="nv">singular</span> <span class="nv">values</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">right</span> <span class="nv">singular</span> <span class="nv">vectors</span> <span class="nv">are</span> <span class="nv">requested</span>
      <span class="nv">i</span>.<span class="nv">e</span>. <span class="k">if</span>
      <span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">V</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">J</span><span class="s1">&#39;</span><span class="ss">))</span> .<span class="nv">AND</span>.
      .<span class="nv">NOT</span>.<span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">U</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">))</span>
      <span class="k">then</span>:
      <span class="mi">2</span>.<span class="mi">1</span>. <span class="k">If</span> <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBT</span>,<span class="s1">&#39;</span><span class="s">T</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">G</span><span class="s1">&#39;</span><span class="ss">)</span>,
      <span class="k">then</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>, <span class="mi">2</span> <span class="o">*</span> <span class="nv">M</span> <span class="ss">)</span>.
      <span class="mi">2</span>.<span class="mi">2</span>. <span class="nv">Otherwise</span>, <span class="nv">LRWORK</span>  <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>,  <span class="nv">N</span> <span class="ss">)</span>.
   <span class="mi">3</span>. <span class="k">If</span> <span class="nv">singular</span> <span class="nv">values</span> <span class="nv">with</span> <span class="nv">the</span> <span class="nv">left</span> <span class="nv">singular</span> <span class="nv">vectors</span> <span class="nv">are</span> <span class="nv">requested</span>, <span class="nv">i</span>.<span class="nv">e</span>. <span class="k">if</span>
      <span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">U</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">))</span> .<span class="nv">AND</span>.
      .<span class="nv">NOT</span>.<span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">V</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">J</span><span class="s1">&#39;</span><span class="ss">))</span>
      <span class="k">then</span>:
      <span class="mi">3</span>.<span class="mi">1</span>. <span class="k">If</span> <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBT</span>,<span class="s1">&#39;</span><span class="s">T</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">G</span><span class="s1">&#39;</span><span class="ss">)</span>,
      <span class="k">then</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>, <span class="mi">2</span> <span class="o">*</span> <span class="nv">M</span> <span class="ss">)</span>.
      <span class="mi">3</span>.<span class="mi">2</span>. <span class="nv">Otherwise</span>, <span class="nv">LRWORK</span>  <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>,  <span class="nv">N</span> <span class="ss">)</span>.
   <span class="mi">4</span>. <span class="k">If</span> <span class="nv">singular</span> <span class="nv">values</span> <span class="nv">with</span> <span class="nv">both</span> <span class="nv">the</span> <span class="nv">left</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">right</span> <span class="nv">singular</span> <span class="nv">vectors</span>
      <span class="nv">are</span> <span class="nv">requested</span>, <span class="nv">i</span>.<span class="nv">e</span>. <span class="k">if</span>
      <span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">U</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBU</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">))</span> .<span class="nv">AND</span>.
      <span class="ss">(</span><span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">V</span><span class="s1">&#39;</span><span class="ss">)</span>.<span class="nv">OR</span>.<span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBV</span>,<span class="s1">&#39;</span><span class="s">J</span><span class="s1">&#39;</span><span class="ss">))</span>
      <span class="k">then</span>:
      <span class="mi">4</span>.<span class="mi">1</span>. <span class="k">If</span> <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBT</span>,<span class="s1">&#39;</span><span class="s">T</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">F</span><span class="s1">&#39;</span><span class="ss">)</span> .<span class="nv">OR</span>. <span class="nv">LSAME</span><span class="ss">(</span><span class="nv">JOBA</span>,<span class="s1">&#39;</span><span class="s">G</span><span class="s1">&#39;</span><span class="ss">)</span>,
      <span class="k">then</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>, <span class="mi">2</span> <span class="o">*</span> <span class="nv">M</span> <span class="ss">)</span>.
      <span class="mi">4</span>.<span class="mi">2</span>. <span class="nv">Otherwise</span>, <span class="nv">LRWORK</span>  <span class="o">=</span> <span class="nv">max</span><span class="ss">(</span> <span class="mi">7</span>, <span class="nv">N</span> <span class="ss">)</span>.

      <span class="k">If</span>, <span class="nv">on</span> <span class="nv">entry</span>, <span class="nv">LRWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="nv">or</span> <span class="nv">LWORK</span><span class="o">=-</span><span class="mi">1</span>, <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span> <span class="nv">is</span> <span class="nv">assumed</span> <span class="nv">and</span>
      <span class="nv">the</span> <span class="nv">length</span> <span class="nv">of</span> <span class="nv">RWORK</span> <span class="nv">is</span> <span class="nv">returned</span> <span class="nv">in</span> <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] IWORK
 \verbatim
          IWORK is INTEGER array, of dimension at least 4, that further depends
          on the job:</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span><span class="nt">1</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">only</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">then</span><span class="o">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">If</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBT</span><span class="o">,</span><span class="s1">&#39;T&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;F&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;G&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">         </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">+</span><span class="nt">M</span><span class="o">;</span><span class="w"> </span><span class="nt">otherwise</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">2</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">right</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">then</span><span class="o">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">If</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBT</span><span class="o">,</span><span class="s1">&#39;T&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;F&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;G&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">         </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">+</span><span class="nt">M</span><span class="o">;</span><span class="w"> </span><span class="nt">otherwise</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">3</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">left</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">then</span><span class="o">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">If</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBT</span><span class="o">,</span><span class="s1">&#39;T&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;F&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;G&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">         </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">+</span><span class="nt">M</span><span class="o">;</span><span class="w"> </span><span class="nt">otherwise</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">4</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">both</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">left</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">right</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"></span>
<span class="w">         </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="o">,</span><span class="w"> </span><span class="nt">then</span><span class="o">:</span><span class="w"></span>
<span class="w">         </span><span class="nt">4</span><span class="p">.</span><span class="nc">1</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBV</span><span class="o">,</span><span class="s1">&#39;J&#39;</span><span class="o">)</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">determined</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">follows</span><span class="o">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">If</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBT</span><span class="o">,</span><span class="s1">&#39;T&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;F&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;G&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">              </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">+</span><span class="nt">M</span><span class="o">;</span><span class="w"> </span><span class="nt">otherwise</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">N</span><span class="o">.</span><span class="w"></span>
<span class="w">         </span><span class="nt">4</span><span class="p">.</span><span class="nc">2</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBV</span><span class="o">,</span><span class="s1">&#39;V&#39;</span><span class="o">)</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">determined</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">follows</span><span class="o">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">If</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBT</span><span class="o">,</span><span class="s1">&#39;T&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;F&#39;</span><span class="o">)</span><span class="w"> </span><span class="p">.</span><span class="nc">OR</span><span class="o">.</span><span class="w"> </span><span class="nt">LSAME</span><span class="o">(</span><span class="nt">JOBA</span><span class="o">,</span><span class="s1">&#39;G&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">              </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">2</span><span class="o">*</span><span class="nt">N</span><span class="o">+</span><span class="nt">M</span><span class="o">;</span><span class="w"> </span><span class="nt">otherwise</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">2</span><span class="o">*</span><span class="nt">N</span><span class="o">.</span><span class="w"></span>

<span class="w">      </span><span class="nt">On</span><span class="w"> </span><span class="nt">exit</span><span class="o">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">1</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">numerical</span><span class="w"> </span><span class="nt">rank</span><span class="w"> </span><span class="nt">determined</span><span class="w"> </span><span class="nt">after</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">initial</span><span class="w"></span>
<span class="w">                 </span><span class="nt">QR</span><span class="w"> </span><span class="nt">factorization</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">pivoting</span><span class="o">.</span><span class="w"> </span><span class="nt">See</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">descriptions</span><span class="w"></span>
<span class="w">                 </span><span class="nt">of</span><span class="w"> </span><span class="nt">JOBA</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">JOBR</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">2</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">number</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">computed</span><span class="w"> </span><span class="nt">nonzero</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"></span>
<span class="w">      </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">3</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">nonzero</span><span class="o">,</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">warning</span><span class="w"> </span><span class="nt">message</span><span class="o">:</span><span class="w"></span>
<span class="w">                 </span><span class="nt">If</span><span class="w"> </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">3</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">some</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">column</span><span class="w"> </span><span class="nt">norms</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">A</span><span class="w"></span>
<span class="w">                 </span><span class="nt">were</span><span class="w"> </span><span class="nt">denormalized</span><span class="w"> </span><span class="nt">floats</span><span class="o">.</span><span class="w"> </span><span class="nt">The</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">high</span><span class="w"> </span><span class="nt">accuracy</span><span class="w"></span>
<span class="w">                 </span><span class="nt">is</span><span class="w"> </span><span class="nt">not</span><span class="w"> </span><span class="nt">warranted</span><span class="w"> </span><span class="nt">by</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">data</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">4</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">or</span><span class="w"> </span><span class="nt">-1</span><span class="o">.</span><span class="w"> </span><span class="nt">If</span><span class="w"> </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">4</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">procedure</span><span class="w"> </span><span class="nt">used</span><span class="w"> </span><span class="nt">A</span><span class="o">^*</span><span class="w"> </span><span class="nt">to</span><span class="w"></span>
<span class="w">                 </span><span class="nt">do</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">job</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">specified</span><span class="w"> </span><span class="nt">by</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">JOB</span><span class="w"> </span><span class="nt">parameters</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">If</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">call</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">ZGEJSV</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">workspace</span><span class="w"> </span><span class="nt">query</span><span class="w"> </span><span class="o">(</span><span class="nt">indicated</span><span class="w"> </span><span class="nt">by</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">-1</span><span class="w"> </span><span class="nt">or</span><span class="w"></span>
<span class="w">      </span><span class="nt">LRWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">-1</span><span class="o">),</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">exit</span><span class="w"> </span><span class="nt">IWORK</span><span class="o">(</span><span class="nt">1</span><span class="o">)</span><span class="w"> </span><span class="nt">contains</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">required</span><span class="w"> </span><span class="nt">length</span><span class="w"> </span><span class="nt">of</span><span class="w"></span>
<span class="w">      </span><span class="nt">IWORK</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">job</span><span class="w"> </span><span class="nt">parameters</span><span class="w"> </span><span class="nt">used</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">call</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
           &lt; 0:  if INFO = -i, then the i-th argument had an illegal value.
           = 0:  successful exit;
           &gt; 0:  ZGEJSV  did not converge in the maximal allowed number
                 of sweeps. The computed values may be inaccurate.
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date June 2016
 \ingroup complex16GEsing
 \par Further Details:</p>
<p>\verbatim</p>
<p>ZGEJSV implements a preconditioned Jacobi SVD algorithm. It uses ZGEQP3,
  ZGEQRF, and ZGELQF as preprocessors and preconditioners. Optionally, an
  additional row pivoting can be used as a preprocessor, which in some
  cases results in much higher accuracy. An example is matrix A with the
  structure A = D1 * C * D2, where D1, D2 are arbitrarily ill-conditioned
  diagonal matrices and C is well-conditioned matrix. In that case, complete
  pivoting in the first QR factorizations provides accuracy dependent on the
  condition number of C, and independent of D1, D2. Such higher accuracy is
  not completely understood theoretically, but it works well in practice.
  Further, if A can be written as A = B*D, with well-conditioned B and some
  diagonal D, then the high accuracy is guaranteed, both theoretically and
  in software, independent of D. For more details see [1], [2].
     The computational range for the singular values can be the full range
  ( UNDERFLOW,OVERFLOW ), provided that the machine arithmetic and the BLAS
  &amp; LAPACK routines called by ZGEJSV are implemented to work in that range.
  If that is not the case, then the restriction for safe computation with
  the singular values in the range of normalized IEEE numbers is that the
  spectral condition number kappa(A)=sigma_max(A)/sigma_min(A) does not
  overflow. This code (ZGEJSV) is best used in this restricted range,
  meaning that singular values of magnitude below ||A||_2 / DLAMCH(&lsquo;O&rsquo;) are
  returned as zeros. See JOBR for details on this.
     Further, this implementation is somewhat slower than the one described
  in [1,2] due to replacement of some non-LAPACK components, and because
  the choice of some tuning parameters in the iterative part (ZGESVJ) is
  left to the implementer on a particular machine.
     The rank revealing QR factorization (in this code: ZGEQP3) should be
  implemented as in [3]. We have a new version of ZGEQP3 under development
  that is more robust than the current one in LAPACK, with a cleaner cut in
  rank deficient cases. It will be available in the SIGMA library [4].
  If M is much larger than N, it is obvious that the initial QRF with
  column pivoting can be preprocessed by the QRF without pivoting. That
  well known trick is not used in ZGEJSV because in some cases heavy row
  weighting can be treated with complete pivoting. The overhead in cases
  M much larger than N is then only due to pivoting, but the benefits in
  terms of accuracy have prevailed. The implementer/user can incorporate
  this extra QRF step easily. The implementer can also improve data movement
  (matrix transpose, matrix copy, matrix transposed copy) - this
  implementation of ZGEJSV uses only the simplest, naive data movement.
 \endverbatim
 \par Contributor:</p>
<p>Zlatko Drmac, Department of Mathematics, Faculty of Science,
  University of Zagreb (Zagreb, Croatia); drmac@math.hr
 \par References:</p>
<p>\verbatim</p>
<p>[1] Z. Drmac and K. Veselic: New fast and accurate Jacobi SVD algorithm I.
     SIAM J. Matrix Anal. Appl. Vol. 35, No. 2 (2008), pp. 1322-1342.
     LAPACK Working note 169.
 [2] Z. Drmac and K. Veselic: New fast and accurate Jacobi SVD algorithm II.
     SIAM J. Matrix Anal. Appl. Vol. 35, No. 2 (2008), pp. 1343-1362.
     LAPACK Working note 170.
 [3] Z. Drmac and Z. Bujanovic: On the failure of rank-revealing QR
     factorization software - a case study.
     ACM Trans. Math. Softw. Vol. 35, No 2 (2008), pp. 1-28.
     LAPACK Working note 176.
 [4] Z. Drmac: SIGMA - mathematical software library for accurate SVD, PSV,
     QSVD, (H,K)-SVD computations.
     Department of Mathematics, University of Zagreb, 2008, 2016.
 \endverbatim
  \par Bugs, examples and comments:</p>
<p>Please report all bugs and send interesting examples and/or comments to
  drmac@math.hr. Thank you.</p>
<p>&ndash;ZGEJSV579
    NOTE: Make sure DLAMCH() does not fail on the target architecture.</p>
<div class="codehilite"><pre><span></span><code>           CALL ZGEQRF( N, NR, V, LDV, CWORK(N+1), CWORK(2*N+1),
 $              LWORK-2*N, IERR )
</code></pre></div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-joba~5"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Joba</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobu~11"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobu</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobv~9"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobr~4"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobr</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobt~2"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobp~4"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobp</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~195"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>M</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~549"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~322"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>A</strong>(Lda,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lda~310"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lda</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sva~3"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Sva</strong>(N)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u~17"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>U</strong>(Ldu,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldu~17"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldu</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-v~32"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>V</strong>(Ldv,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldv~21"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cwork~3"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Cwork</strong>(Lwork)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~165"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rwork~84"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Rwork</strong>(Lrwork)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrwork~17"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lrwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwork~77"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Iwork</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~441"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-cone~60"></span>
              complex(kind=16),
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>CONE</strong></td>
<td> =</td>
                <td>(1.0D0,0.0D0)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-czero~43"></span>
              complex(kind=16),
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>CZERO</strong></td>
<td> =</td>
                <td>(0.0D0,0.0D0)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~368"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~357"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapp~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aaqq~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aaqq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aatmax~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aatmax</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aatmin~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aatmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-almort~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>almort</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-big~7"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>big</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-big1~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>big1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cdummy~3"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cdummy</strong>(1)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cond_ok~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cond_ok</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-condr1~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>condr1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-condr2~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>condr2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ctemp~7"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ctemp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-defr~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>defr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-entra~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>entra</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-entrat~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>entrat</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-epsln~5"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>epsln</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-errest~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>errest</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-goscal~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>goscal</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ierr~33"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ierr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwoff~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iwoff</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jracc~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jracc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kill~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kill</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l2aber~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l2aber</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l2kill~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l2kill</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l2pert~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l2pert</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l2rank~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l2rank</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l2tran~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l2tran</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lquery~153"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lquery</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrwcon~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lrwcon</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrwqp3~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lrwqp3</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrwsvdj~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lrwsvdj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lsvec~5"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwcon~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwcon</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwlqf~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwlqf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwqp3~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwqp3</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwqrf~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwqrf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgelqf~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgelqf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgeqp3~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgeqp3</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgeqp3n"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgeqp3n</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgeqrf~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgeqrf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgesvj"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgesvj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgesvju"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgesvju</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zgesvjv"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zgesvjv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zunmlq~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zunmlq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zunmqr~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zunmqr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_zunmqrm"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_zunmqrm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwsvdj~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwsvdj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwsvdjv~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwsvdjv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwunmlq~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwunmlq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwunmqr~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwunmqr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwunmqrm~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwunmqrm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-maxprj~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>maxprj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-miniwrk~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>miniwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-minrwrk~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>minrwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-minwrk~19"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>minwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n1~33"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>n1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-noscal~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>noscal</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nr~7"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-numrank~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>numrank</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-optwrk~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>optwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~15"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~7"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rdummy~4"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rdummy</strong>(1)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rowpiv~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rowpiv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rsvec~5"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-scalem~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>scalem</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sconda~4"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sconda</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sfmin~22"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sfmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-small~11"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>small</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-temp1~12"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>temp1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-transp~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>transp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-uscal1~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>uscal1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-uscal2~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>uscal2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-warning~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>warning</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xsc~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>xsc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">ZGEJSV</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="n">Jobu</span><span class="p">,</span><span class="n">Jobv</span><span class="p">,</span><span class="n">Jobr</span><span class="p">,</span><span class="n">Jobt</span><span class="p">,</span><span class="n">Jobp</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!  -- LAPACK computational routine (version 3.7.1) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     June 2017</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--ZGEJSV579</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lrwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">Lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">Ldu</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">Ldv</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Cwork</span><span class="p">(</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">Lrwork</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Iwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">1</span><span class="w"> </span><span class="n">Joba</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobv</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  ===========================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Local Parameters ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0D0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0D0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">CZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">CONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">CZERO</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0D0</span><span class="p">,</span><span class="mf">0.0D0</span><span class="p">),</span><span class="n">CONE</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0D0</span><span class="p">,</span><span class="mf">0.0D0</span><span class="p">))</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">aapp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aatmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aatmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">big1</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">cond_ok</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">condr1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">condr2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">epsln</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxprj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">scalem</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sconda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">small</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">uscal1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">uscal2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ierr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">numrank</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">warning</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">almort</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">defr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">goscal</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">kill</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l2aber</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l2kill</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l2rank</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">noscal</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">transp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">optwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">minrwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">lwcon</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwlqf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwqp3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwqrf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwunmlq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwunmqr</span><span class="w"> </span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lwunmqrm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwsvdj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwsvdjv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lrwqp3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lrwcon</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lrwsvdj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">iwoff</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">lwrk_zgelqf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zgeqp3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zgeqp3n</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zgeqrf</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lwrk_zgesvj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zgesvjv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zgesvju</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zunmlq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lwrk_zunmqr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_zunmqrm</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DCMPLX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">CONJG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">DLOG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">DBLE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">NINT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">          </span><span class="nb">SQRT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">DLAMCH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DZNRM2</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">IDAMAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">IZAMAX</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">IDAMAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">IZAMAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">LSAME</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAMCH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DZNRM2</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">DLASSQ</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZCOPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZGELQF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQP3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZGEQRF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLACPY</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">ZLAPMR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASCL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLASCL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASSQ</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASWP</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">ZUNGQR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZUNMLQ</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZUNMQR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZPOCON</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DSCAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZDSCAL</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">ZSWAP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZTRSM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLACGV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">ZGESVJ</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!     Test the input arguments</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">lsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">jracc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">jracc</span><span class="w"></span>
<span class="w">      </span><span class="n">rowpiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">l2rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">l2aber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">errest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">l2tran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobt</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">l2kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobr</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">defr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobr</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">l2pert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobp</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">lquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Lwork</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Lrwork</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2rank</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2aber</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">defr</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobt</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobt</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">l2pert</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobp</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">M</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lda</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldu</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">13</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">15</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!        #:)</span>
<span class="w">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!         .. compute the minimal and the optimal workspace lengths</span>
<span class="c">!         [[The expressions for computing the minimal and the optimal</span>
<span class="c">!         values of LCWORK, LRWORK are written with a lot of redundancy and</span>
<span class="c">!         can be simplified. However, this verbose form is useful for</span>
<span class="c">!         maintenance and modifications of the code.]]</span>
<span class="c">!</span>
<span class="c">!        .. minimal workspace length for ZGEQP3 of an M x N matrix,</span>
<span class="c">!         ZGEQRF of an N x N matrix, ZGELQF of an N x N matrix,</span>
<span class="c">!         ZUNMLQ for computing N x N matrix, ZUNMQR for computing N x N</span>
<span class="c">!         matrix, ZUNMQR for computing M x N matrix, respectively.</span>
<span class="w">         </span><span class="n">lwqp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">lwqrf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">lwlqf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">lwunmlq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">lwunmqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">lwunmqrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="c">!        .. minimal workspace length for ZPOCON of an N x N matrix</span>
<span class="w">         </span><span class="n">lwcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="w"></span>
<span class="c">!        .. minimal workspace length for ZGESVJ of an N x N matrix,</span>
<span class="c">!         without and with explicit accumulation of Jacobi rotations</span>
<span class="w">         </span><span class="n">lwsvdj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">lwsvdjv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!         .. minimal REAL workspace length for ZGEQP3, ZPOCON, ZGESVJ</span>
<span class="w">         </span><span class="n">lrwqp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="n">lrwcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="n">lrwsvdj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            CALL </span><span class="n">ZGEQP3</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">lwrk_zgeqp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">lwrk_zgeqrf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGELQF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">lwrk_zgelqf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!             .. minimal and optimal sizes of the complex workspace if</span>
<span class="c">!             only the singular values are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zgesvj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwrk_zgesvj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="n">lwrk_zgesvj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the complex workspace if the</span>
<span class="c">!            singular values and the right singular vectors are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwlqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmlq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwlqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">N</span><span class="o">+</span><span class="n">lwunmlq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zgesvj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZUNMLQ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zunmlq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgelqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmlq</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgelqf</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmlq</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the complex workspace if the</span>
<span class="c">!            singular values and the left singular vectors are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zgesvj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zunmqrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the complex workspace if the</span>
<span class="c">!            full SVD is requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">jracc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwlqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdjv</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqr</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmlq</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwlqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwsvdjv</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqr</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmlq</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvdj</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvdjv</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqr</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvdjv</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqr</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">miniwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zunmqrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_zunmqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">jracc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZGEQP3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zgeqp3n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zgesvj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zgesvju</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zgesvjv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZUNMLQ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zunmlq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3n</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgelqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvjv</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqr</span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmlq</span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_zgesvju</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3n</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgelqf</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvj</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgesvjv</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqr</span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmlq</span><span class="p">,</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_zgesvju</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ELSE</span>
<span class="k">                  CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zgesvjv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">cdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zunmqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">cdummy</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_zunmqrm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_zgesvjv</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqr</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqp3</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zgeqrf</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_zgesvjv</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqr</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_zunmqrm</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minrwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">lrwqp3</span><span class="p">,</span><span class="n">lrwsvdj</span><span class="p">,</span><span class="n">lrwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">         </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">minwrk</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk</span><span class="p">,</span><span class="n">optwrk</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">&lt;</span><span class="n">minwrk</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">17</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lrwork</span><span class="o">&lt;</span><span class="n">minrwrk</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">19</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!       #:(</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;ZGEJSV&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minrwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">miniwrk</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return for void matrix (Y3K safe)</span>
<span class="c">! #:)</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Determine whether the matrix U should be M x N or M x M</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Set numerical parameters</span>
<span class="c">!</span>
<span class="c">!!    NOTE: Make sure DLAMCH() does not fail on the target architecture.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">epsln</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">sfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;SafeMinimum&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">small</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sfmin</span><span class="o">/</span><span class="n">epsln</span><span class="w"></span>
<span class="w">      </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!     BIG   = ONE / SFMIN</span>
<span class="c">!</span>
<span class="c">!     Initialize SVA(1:N) = diag( ||A e_i||_2 )_1^N</span>
<span class="c">!</span>
<span class="c">!(!)  If necessary, scale SVA() to protect the largest norm from</span>
<span class="c">!     overflow. It is possible that this scaling pushes the smallest</span>
<span class="c">!     column norm left from the underflow threshold (extreme case).</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="n">noscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="n">goscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">big</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;ZGEJSV&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">RETURN</span>
<span class="k">         ENDIF</span>
<span class="k">         </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">noscal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">noscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="p">(</span><span class="n">aaqq</span><span class="o">*</span><span class="n">scalem</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goscal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">goscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">DSCAL</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scalem</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">      ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">noscal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">      </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">aapp</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">aaqq</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return for zero M x N matrix</span>
<span class="c">! #:)</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Issue warning if denormalized column norms detected. Override the</span>
<span class="c">!     high relative accuracy request. Issue licence to kill nonzero columns</span>
<span class="c">!     (set them to zero) whose norm is less than sigma_max / BIG (roughly).</span>
<span class="c">! #:(</span>
<span class="w">      </span><span class="n">warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&lt;=</span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">l2rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">l2kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return for one-column matrix</span>
<span class="c">! #:)</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">scalem</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!           computing all M left singular vectors of the M x 1 matrix</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="o">/=</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZUNGQR</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CONE</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">*</span><span class="n">scalem</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">scalem</span><span class="w"></span>
<span class="w">            </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">scalem</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">scalem</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ELSE</span>
<span class="k">            </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         RETURN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">transp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Compute the row norms, needed to determine row pivoting sequence</span>
<span class="c">!     (in the case of heavily row weighted A, row pivoting is strongly</span>
<span class="c">!     advised) and to collect information needed to compare the</span>
<span class="c">!     structures of A * A^* and A^* * A (in the case L2TRAN.EQ..TRUE.).</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">               </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!              ZLASSQ gets both the ell_2 and the ell_infinity norm</span>
<span class="c">!              in one pass through the vector</span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="n">scalem</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="p">(</span><span class="n">scalem</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">temp1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">aatmax</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">aatmin</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ELSE</span>
<span class="k">            DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scalem</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">IZAMAX</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">)))</span><span class="w"></span>
<span class="w">               </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">aatmax</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">aatmin</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     For square matrix A try to determine whether A^*  would be better</span>
<span class="c">!     input for the preconditioned Jacobi SVD, with faster convergence.</span>
<span class="c">!     The decision is based on an O(N) function of the vector of column</span>
<span class="c">!     and row norms of A, based on the Shannon entropy. This should give</span>
<span class="c">!     the right choice in most cases when the difference actually matters.</span>
<span class="c">!     It may fail and pick the slower converging side.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">      </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">CALL </span><span class="n">DLASSQ</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">big1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">xsc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">big1</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">big1</span><span class="o">*</span><span class="nb">DLOG</span><span class="p">(</span><span class="n">big1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">entra</span><span class="o">/</span><span class="nb">DLOG</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Now, SVA().^2/Trace(A^* * A) is a point in the probability simplex.</span>
<span class="c">!        It is derived from the diagonal of  A^* * A.  Do the same with the</span>
<span class="c">!        diagonal of A * A^*, compute the entropy of the corresponding</span>
<span class="c">!        probability distribution. Note that A * A^* and A^* * A have the</span>
<span class="c">!        same trace.</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">            </span><span class="n">big1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">xsc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">big1</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">big1</span><span class="o">*</span><span class="nb">DLOG</span><span class="p">(</span><span class="n">big1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">entrat</span><span class="o">/</span><span class="nb">DLOG</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Analyze the entropies and decide A or A^*. Smaller entropy</span>
<span class="c">!        usually means better input for the algorithm.</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">transp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">entrat</span><span class="o">&lt;</span><span class="n">entra</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        If A^* is better than A, take the adjoint of A. This is allowed</span>
<span class="c">!        only for square matrices, M=N.</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!           In an optimal implementation, this trivial transpose</span>
<span class="c">!           should be replaced with faster transpose.</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="n">A</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">            </span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="c">!              previously computed row 2-norms are now column 2-norms</span>
<span class="c">!              of the transposed matrix</span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aatmax</span><span class="w"></span>
<span class="w">            </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="w"></span>
<span class="w">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aatmin</span><span class="w"></span>
<span class="w">            </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="nb">kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsvec</span><span class="w"></span>
<span class="w">            </span><span class="n">lsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rsvec</span><span class="w"></span>
<span class="w">            </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">kill</span>
<span class="nb">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">rowpiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!     END IF L2TRAN</span>
<span class="c">!</span>
<span class="c">!     Scale the matrix so that its maximal singular value remains less</span>
<span class="c">!     than SQRT(BIG) -- the matrix is scaled so that its maximal column</span>
<span class="c">!     has Euclidean norm equal to SQRT(BIG/N). The only reason to keep</span>
<span class="c">!     SQRT(BIG) instead of BIG is the fact that ZGEJSV uses LAPACK and</span>
<span class="c">!     BLAS routines that, in some implementations, are not capable of</span>
<span class="c">!     working in the full interval [SFMIN,BIG] and that they may provoke</span>
<span class="c">!     overflows in the intermediate results. If the singular values spread</span>
<span class="c">!     from SFMIN to BIG, then ZGESVJ will compute them. So, in that case,</span>
<span class="c">!     one should use ZGESVJ instead of ZGEJSV.</span>
<span class="c">!     &gt;&gt; change in the April 2016 update: allow bigger range, i.e. the</span>
<span class="c">!     largest column is allowed up to BIG/N and ZGESVJ will do the rest.</span>
<span class="w">      </span><span class="n">big1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">big</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="c">!      TEMP1  = BIG/DBLE(N)</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">CALL </span><span class="n">DLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="p">(</span><span class="n">aapp</span><span class="o">*</span><span class="n">sfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">/</span><span class="n">aapp</span><span class="p">)</span><span class="o">*</span><span class="n">temp1</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">*</span><span class="n">temp1</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="o">*</span><span class="n">scalem</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     To undo scaling at the end of this procedure, multiply the</span>
<span class="c">!     computed singular values with USCAL2 / USCAL1.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">uscal1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">      </span><span class="n">uscal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2kill</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        L2KILL enforces computation of nonzero singular values in</span>
<span class="c">!        the restricted range of condition number of the initial A,</span>
<span class="c">!        sigma_max(A) / sigma_min(A) approx. SQRT(BIG)/SQRT(SFMIN).</span>
<span class="w">         </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">small</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Now, if the condition number of A is too big,</span>
<span class="c">!        sigma_max(A) / sigma_min(A) .GT. SQRT(BIG/N) * EPSLN / SFMIN,</span>
<span class="c">!        as a precaution measure, the full SVD is computed using ZGESVJ</span>
<span class="c">!        with accumulated Jacobi rotations. This provides numerically</span>
<span class="c">!        more robust computation, at the cost of slightly increased run</span>
<span class="c">!        time. Depending on the concrete implementation of BLAS and LAPACK</span>
<span class="c">!        (i.e. how they behave in presence of extreme ill-conditioning) the</span>
<span class="c">!        implementor may decide to remove this switch.</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">jracc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&lt;</span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&lt;</span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Preconditioning using QR factorization with pivoting</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        Optional row permutation (Bjoerck row pivoting):</span>
<span class="c">!        A result by Cox and Higham shows that the Bjoerck&#39;s</span>
<span class="c">!        row pivoting combined with standard column pivoting</span>
<span class="c">!        has similar effect as Powell-Reid complete pivoting.</span>
<span class="c">!        The ell-infinity norms of A are made nonincreasing.</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">jracc</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">iwoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">iwoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IDAMAX</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">         CALL </span><span class="n">ZLASWP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     End of the preparation phase (scaling, optional sorting and</span>
<span class="c">!     transposing, optional flushing of small columns).</span>
<span class="c">!</span>
<span class="c">!     Preconditioning</span>
<span class="c">!</span>
<span class="c">!     If the full SVD is needed, the right singular vectors are computed</span>
<span class="c">!     from a matrix equation, and for that we need theoretical analysis</span>
<span class="c">!     of the Businger-Golub pivoting. So we use ZGEQP3 as the first RR QRF.</span>
<span class="c">!     In all other cases the first RR QRF can be chosen by other criteria</span>
<span class="c">!     (eg speed by replacing global with restricted window pivoting, such</span>
<span class="c">!     as in xGEQPX from TOMS # 782). Good results will be obtained using</span>
<span class="c">!     xGEQPX with properly (!) chosen numerical parameters.</span>
<span class="c">!     Any improvement of ZGEQP3 improves overall performance of ZGEJSV.</span>
<span class="c">!</span>
<span class="c">!     A * P1 = Q1 * [ R1^* 0]^*:</span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!        .. all columns are free columns</span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      CALL </span><span class="n">ZGEQP3</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     The upper triangular matrix R1 from the first QRF is inspected for</span>
<span class="c">!     rank deficiency and possibilities for deflation, or possible</span>
<span class="c">!     ill-conditioning. Depending on the user specified flag L2RANK,</span>
<span class="c">!     the procedure explores possibilities to reduce the numerical</span>
<span class="c">!     rank by inspecting the computed upper triangular factor. If</span>
<span class="c">!     L2RANK or L2ABER are up, then ZGEJSV will compute the SVD of</span>
<span class="c">!     A + dA, where ||dA|| &lt;= f(M,N)*EPSLN.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2aber</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        Standard absolute error bound suffices. All sigma_i with</span>
<span class="c">!        sigma_i &lt; N*EPSLN*||A|| are flushed to zero. This is an</span>
<span class="c">!        aggressive enforcement of lower numerical rank by introducing a</span>
<span class="c">!        backward error of the order of N*EPSLN*||A||.</span>
<span class="w">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="p">(</span><span class="n">temp1</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2rank</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        .. similarly as above, only slightly more gentle (less aggressive).</span>
<span class="c">!        Sudden drop on the diagonal of R1 is used as the criterion for</span>
<span class="c">!        close-to-rank-deficient.</span>
<span class="w">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="p">(</span><span class="n">epsln</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="n">small</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">                               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">(</span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!        The goal is high relative accuracy. However, if the matrix</span>
<span class="c">!        has high scaled condition number the relative accuracy is in</span>
<span class="c">!        general not feasible. Later on, a condition number estimator</span>
<span class="c">!        will be deployed to estimate the scaled condition number.</span>
<span class="c">!        Here we just remove the underflowed part of the triangular</span>
<span class="c">!        factor. This prevents the situation in which the code is</span>
<span class="c">!        working hard to get the accuracy not warranted by the data.</span>
<span class="w">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="n">small</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">                               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">(</span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">almort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">maxprj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">Sva</span><span class="p">(</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">maxprj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">maxprj</span><span class="p">,</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">maxprj</span><span class="o">**</span><span class="mi">2</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="o">-</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">epsln</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="n">condr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="n">nr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              .. V is available as workspace</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Rwork</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              .. U is available as workspace</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">![]            CALL ZLACPY( &#39;U&#39;, N, N, A, LDA, CWORK(N+1), N )</span>
<span class="c">!              Change: here index shifted by N to the left, CWORK(1:N)</span>
<span class="c">!              not needed for SIGMA only computation</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="c">![]               CALL ZDSCAL( p, ONE/TEMP1, CWORK(N+(p-1)*N+1), 1 )</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!           .. the columns of R are scaled to have unit Euclidean lengths.</span>
<span class="c">![]               CALL ZPOCON( &#39;U&#39;, N, CWORK(N+1), N, ONE, TEMP1,</span>
<span class="c">![]     $              CWORK(N+N*N+1), RWORK, IERR )</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Rwork</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!           SCONDA is an estimate of SQRT(||(R^* * R)^(-1)||_1).</span>
<span class="c">!           N^(-1/4) * SCONDA &lt;= ||R^(-1)||_2 &lt;= N^(1/4) * SCONDA</span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">l2pert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">A</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span><span class="o">&gt;</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">big1</span><span class="p">))</span><span class="w"></span>
<span class="c">!     If there is no violent scaling, artificial perturbation is not needed.</span>
<span class="c">!</span>
<span class="c">!     Phase 3:</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!         Singular Values only</span>
<span class="c">!</span>
<span class="c">!         .. transpose A(1:NR,1:N)</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        The following two DO-loops introduce small relative perturbation</span>
<span class="c">!        into the strict upper triangle of the lower triangular matrix.</span>
<span class="c">!        Small entries below the main diagonal are also changed.</span>
<span class="c">!        This modification is useful if the computing environment does not</span>
<span class="c">!        provide/allow FLUSH TO ZERO underflow, for it prevents many</span>
<span class="c">!        annoying denormalized numbers in case of strongly scaled matrices.</span>
<span class="c">!        The perturbation is structured so that it does not introduce any</span>
<span class="c">!        new perturbation of the singular values, and it does not destroy</span>
<span class="c">!        the job done by the preconditioner.</span>
<span class="c">!        The licence for this perturbation is in the variable L2PERT, which</span>
<span class="c">!        should be .FALSE. if FLUSH TO ZERO underflow is active.</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              XSC = SQRT(SMALL)</span>
<span class="w">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsln</span><span class="o">/</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)),</span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     $                     A(p,q) = TEMP1 * ( A(p,q) / ABS(A(p,q)) )</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!            .. second preconditioning using the QR factorization</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. and transpose upper to lower triangular</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Row-cyclic Jacobi SVD algorithm with column pivoting</span>
<span class="c">!</span>
<span class="c">!           .. again some perturbation (a &quot;background noise&quot;) is added</span>
<span class="c">!           to drown denormals</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              XSC = SQRT(SMALL)</span>
<span class="w">            </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsln</span><span class="o">/</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)),</span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="c">!     $                   A(p,q) = TEMP1 * ( A(p,q) / ABS(A(p,q)) )</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">         ELSE</span>
<span class="k">            CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. and one-sided Jacobi rotations are started on a lower</span>
<span class="c">!           triangular matrix (plus perturbation which is ignored in</span>
<span class="c">!           the part which destroys triangular form (confusing?!))</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">               </span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">jracc</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="p">(</span><span class="n">jracc</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">/=</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        -&gt; Singular Values and Right Singular Vectors &lt;-</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. in this case NR equals N</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w"> </span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        .. two more QR factorizations ( one QRF is not enough, two require</span>
<span class="c">!        accumulated product of Jacobi rotations, three are perfect )</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGELQF</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZUNMLQ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!         .. permute the rows of V</span>
<span class="c">!         DO 8991 p = 1, N</span>
<span class="c">!            CALL ZCOPY( N, V(p,1), LDV, A(IWORK(p),1), LDA )</span>
<span class="c">! 8991    CONTINUE</span>
<span class="c">!         CALL ZLACPY( &#39;All&#39;, N, N, A, LDA, V, LDV )</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZLAPMR</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">               </span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZLAPMR</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        .. Singular Values and Left Singular Vectors                 ..</span>
<span class="c">!</span>
<span class="c">!        .. second preconditioning step to avoid need to accumulate</span>
<span class="c">!        Jacobi rotations in the Jacobi iterations.</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">               </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">               </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="w"></span>
<span class="w">            </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        .. Full SVD ..</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        This branch deploys a preconditioned Jacobi SVD with explicitly</span>
<span class="c">!        accumulated rotations. It is included as optional, mainly for</span>
<span class="c">!        experimental purposes. It does perform well, and can also be used.</span>
<span class="c">!        In this implementation, this branch will be automatically activated</span>
<span class="c">!        if the  condition number sigma_max(A) / sigma_min(A) is predicted</span>
<span class="c">!        to be greater than the overflow threshold. This is because the</span>
<span class="c">!        a posteriori computation of the singular vectors assumes robust</span>
<span class="c">!        implementation of BLAS and some LAPACK procedures, capable of working</span>
<span class="c">!        in presence of extreme values, e.g. when the singular values spread from</span>
<span class="c">!        the underflow to the overflow threshold.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">epsln</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)),</span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     $                V(p,q) = TEMP1 * ( V(p,q) / ABS(V(p,q)) )</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k"> </span>
<span class="k">            CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k"> </span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">epsln</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">MIN</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="c">!                  U(p,q) = - TEMP1 * ( U(q,p) / ABS(U(q,p)) )</span>
<span class="w">                     </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k"> </span>
<span class="k">            CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w"> </span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k"> </span>
<span class="k">            CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Permute the rows of V using the (column) permutation from the</span>
<span class="c">!           first QRF. Also, scale the columns to make them unit in</span>
<span class="c">!           Euclidean norm. This applies to all cases.</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           At this moment, V contains the right singular vectors of A.</span>
<span class="c">!           Next, assemble the left singular vector matrix U (M x N).</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Second Preconditioning Step (QRF [with pivoting])</span>
<span class="c">!           Note that the composition of TRANSPOSE, QRF and TRANSPOSE is</span>
<span class="c">!           equivalent to an LQF CALL. Since in many libraries the QRF</span>
<span class="c">!           seems to be better optimized than the LQF, we do explicit</span>
<span class="c">!           transpose and use the QRF. This is subject to changes in an</span>
<span class="c">!           optimized implementation of ZGEJSV.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. the following two loops perturb small entries to avoid</span>
<span class="c">!           denormals in the second QR factorization, where they are</span>
<span class="c">!           as good as zeros. This is done to avoid painfully slow</span>
<span class="c">!           computation with denormals. The relative size of the perturbation</span>
<span class="c">!           is a parameter that can be changed by the implementer.</span>
<span class="c">!           This perturbation device will be obsolete on machines with</span>
<span class="c">!           properly implemented arithmetic.</span>
<span class="c">!           To switch it off, set L2PERT=.FALSE. To remove it from  the</span>
<span class="c">!           code, remove the action under L2PERT=.TRUE., leave the ELSE part.</span>
<span class="c">!           The following two loops should be blocked and fused with the</span>
<span class="c">!           transposed copy above.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)),</span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     $                   V(p,q) = TEMP1 * ( V(p,q) / ABS(V(p,q)) )</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Estimate the row scaled condition number of R1</span>
<span class="c">!           (If R1 is rectangular, N &gt; NR, then the condition number</span>
<span class="c">!           of the leading NR x NR submatrix is estimated.)</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">condr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!           .. here need a second opinion on the condition number</span>
<span class="c">!           .. then assume worst case scenario</span>
<span class="c">!           R1 is OK for inverse &lt;=&gt; CONDR1 .LT. DBLE(N)</span>
<span class="c">!           more conservative    &lt;=&gt; CONDR1 .LT. SQRT(DBLE(N))</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">cond_ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">nr</span><span class="p">)))</span><span class="w"></span>
<span class="c">![TP]       COND_OK is a tuning parameter.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr1</span><span class="o">&lt;</span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              .. the second QRF without pivoting. Note: in an optimized</span>
<span class="c">!              implementation, this QRF should be implemented as the QRF</span>
<span class="c">!              of a lower triangular matrix.</span>
<span class="c">!              R1^* = Q2 * R2</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="o">/</span><span class="n">epsln</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">MIN</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="c">!     $                     V(q,p) = TEMP1 * ( V(q,p) / ABS(V(q,p)) )</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">/=</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. save ...</span>
<span class="c">!</span>
<span class="c">!           .. this transposed copy should be better than naive</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               </span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              .. ill-conditioned case: second QRF with pivoting</span>
<span class="c">!              Note that windowed pivoting would be equally good</span>
<span class="c">!              numerically, and more run-time efficient. So, in</span>
<span class="c">!              an optimal implementation, the next call to ZGEQP3</span>
<span class="c">!              should be replaced with eg. CALL ZGEQPX (ACM TOMS #782)</span>
<span class="c">!              with properly (carefully) chosen parameters.</span>
<span class="c">!</span>
<span class="c">!              R1^* * P2 = Q2 * R2</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               CALL </span><span class="n">ZGEQP3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="p">,</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!*               CALL ZGEQRF( N, NR, V, LDV, CWORK(N+1), CWORK(2*N+1),</span>
<span class="c">!*     $              LWORK-2*N, IERR )</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">MIN</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="c">!     $                     V(q,p) = TEMP1 * ( V(q,p) / ABS(V(q,p)) )</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DCMPLX</span><span class="p">(</span><span class="n">xsc</span><span class="o">*</span><span class="nb">MIN</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">ZERO</span><span class="p">)</span><span class="w"></span>
<span class="c">!                        V(p,q) = - TEMP1*( V(q,p) / ABS(V(q,p)) )</span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">               ELSE</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!              Now, compute R2 = L3 * Q3, the LQ factorization.</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZGELQF</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. and estimate the condition number</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               CALL </span><span class="n">ZPOCON</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Rwork</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!                 .. save the Householder vectors used for Q3</span>
<span class="c">!                 (this overwrites the copy of R2, as it will not be</span>
<span class="c">!                 needed in this branch, but it does not overwritte the</span>
<span class="c">!                 Huseholder vectors of Q2.).</span>
<span class="c">!                 .. and the rest of the information on Q3 is in</span>
<span class="c">!                 WORK(2*N+N*NR+1:2*N+N*NR+N)</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr2</span><span class="o">&gt;=</span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w">                                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!                     V(p,q) = - TEMP1*( V(p,q) / ABS(V(p,q)) )</span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Second preconditioning finished; continue with Jacobi SVD</span>
<span class="c">!        The input matrix is lower trinagular.</span>
<span class="c">!</span>
<span class="c">!        Recover the right singular vectors as solution of a well</span>
<span class="c">!        conditioned triangular matrix equation.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr1</span><span class="o">&lt;</span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="w"> </span>
<span class="c">!        .. pick the right matrix equation and solve it</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">! :))             .. best case, R1 is inverted. The solution of this matrix</span>
<span class="c">!                 equation is Q2*V2 = the product of the Jacobi rotations</span>
<span class="c">!                 used in ZGESVJ, premultiplied with the orthogonal matrix</span>
<span class="c">!                 from the second QR factorization.</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZTRSM</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!                 .. R1 is well conditioned, but non-square. Adjoint of R2</span>
<span class="c">!                 is inverted to get the product of the Jacobi rotations</span>
<span class="c">!                 used in ZGESVJ. The Q-factor from the second QR</span>
<span class="c">!                 factorization is then built in explicitly.</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZTRSM</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr2</span><span class="o">&lt;</span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              The matrix R2 is inverted. The solution of the matrix equation</span>
<span class="c">!              is Q3^* * V3 = the product of the Jacobi rotations (appplied to</span>
<span class="c">!              the lower triangular L3 from the LQ factorization of</span>
<span class="c">!              R2=L3*Q3), pre-multiplied with the transposed Q3.</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               CALL </span><span class="n">ZTRSM</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. apply the permutation from the second QR factorization</span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">                  DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">V</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!              Last line of defense.</span>
<span class="c">! #:(          This is a rather pathological case: no scaled condition</span>
<span class="c">!              improvement after two pivoted QR factorizations. Other</span>
<span class="c">!              possibility is that the rank revealing QR factorization</span>
<span class="c">!              or the condition estimator has failed, or the COND_OK</span>
<span class="c">!              is set very close to ONE (which is unnecessary). Normally,</span>
<span class="c">!              this branch should never be executed, but in rare cases of</span>
<span class="c">!              failure of the RRQR or condition estimator, the last line of</span>
<span class="c">!              defense ensures that ZGEJSV completes the task.</span>
<span class="c">!              Compute the full SVD of L3 using ZGESVJ with explicit</span>
<span class="c">!              accumulation of Jacobi rotations.</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">V</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Ldv</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZUNMLQ</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">                  DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Permute the rows of V using the (column) permutation from the</span>
<span class="c">!           first QRF. Also, scale the columns to make them unit in</span>
<span class="c">!           Euclidean norm. This applies to all cases.</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!           At this moment, V contains the right singular vectors of A.</span>
<span class="c">!           Next, assemble the left singular vector matrix U (M x N).</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           The Q matrix from the first QRF is built into the left singular</span>
<span class="c">!           matrix U. This applies to all cases.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span>
<span class="c">!           The columns of U are normalized. The cost is O(M*N) flops.</span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           If the initial QRF is computed with row pivoting, the left</span>
<span class="c">!           singular vectors must be adjusted.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        .. the initial matrix A has almost orthogonal columns and</span>
<span class="c">!        the second QRF is not needed</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">ctemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!                     CWORK(N+(q-1)*N+p)=-TEMP1 * ( CWORK(N+(p-1)*N+q) /</span>
<span class="c">!     $                                        ABS(CWORK(N+(p-1)*N+q)) )</span>
<span class="w">                     </span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ctemp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZGESVJ</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NINT</span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZTRSM</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Assemble the left singular vector matrix U (M x N).</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            CALL </span><span class="n">ZUNMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Cwork</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Cwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="w"></span>
<span class="w">               </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&lt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">xsc</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">iwoff</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!        end of the  &gt;&gt; almost orthogonal case &lt;&lt;  in the full SVD</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!           .. swap U and V because the procedure worked on A^*</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZSWAP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!     end of the full SVD</span>
<span class="c">!</span>
<span class="c">!     Undo scaling, if necessary (and possible)</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">uscal2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">uscal1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">DLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">uscal1</span><span class="p">,</span><span class="n">uscal2</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">uscal1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="n">uscal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uscal2</span><span class="o">*</span><span class="n">scalem</span><span class="w"></span>
<span class="w">      </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uscal1</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sconda</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr1</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr2</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entra</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entrat</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">      </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numrank</span><span class="w"></span>
<span class="w">      </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">warning</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="w"> </span>
<span class="c">!</span>
<span class="c">!     ..</span>
<span class="c">!     .. END OF ZGEJSV</span>
<span class="c">!     ..</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">ZGEJSV</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>