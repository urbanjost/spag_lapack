<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>ZGSVJ0 &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>ZGSVJ0
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.2% of total for procedures.">385 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/zgsvj0.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/zgsvj0.f90.html'>zgsvj0.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">ZGSVJ0</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-half~40">HALF</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-one~503">ONE</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-zero~475">ZERO</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aapp~5">aapp</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aapp0~3">aapp0</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aapq~3">aapq</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aapq1">aapq1</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aaqq~5">aaqq</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-apoaq~3">apoaq</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-applv~3">applv</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-aqoap~3">aqoap</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-big~10">big</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-bigtheta~3">bigtheta</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-blskip~3">blskip</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-cs~15">cs</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-emptsw~3">emptsw</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-i~544">i</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-ibr~3">ibr</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-ierr~44">ierr</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-igl~3">igl</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-ijblsk~3">ijblsk</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-ir1~3">ir1</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-iswrot~3">iswrot</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-jbc~3">jbc</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-jgl~3">jgl</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-kbl~3">kbl</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-lkahead~3">lkahead</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-mvl~3">mvl</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-mxaapq~3">mxaapq</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-mxsinj~3">mxsinj</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-nbl~4">nbl</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-notrot~3">notrot</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-ompq">ompq</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-p~21">p</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-pskipped~3">pskipped</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-q~11">q</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rootbig~3">rootbig</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rooteps~3">rooteps</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rootsfmin~3">rootsfmin</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-roottol~3">roottol</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rotok~3">rotok</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rowskip~3">rowskip</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-rsvec~8">rsvec</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-small~16">small</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-sn~18">sn</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-swband~3">swband</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-t~38">t</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-temp1~18">temp1</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-theta~3">theta</a>
            <a class="list-group-item" href="../proc/zgsvj0.html#variable-thsign~3">thsign</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/zgsvj0.html#src">ZGSVJ0</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine ZGSVJ0(Jobv, M, N, A, Lda, D, Sva, Mv, V, Ldv, Eps, Sfmin, Tol, Nsweep, Work, Lwork, Info)  
</h2>
    

    <p>\brief <b> ZGSVJ0 pre-processor for the routine zgesvj. </b>
 \htmlonly
 Download ZGSVJ0 + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/zgsvj0.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/zgsvj0.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/zgsvj0.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>ZGSVJ0 is called from ZGESVJ as a pre-processor and that is its main
 purpose. It applies Jacobi rotations in the same way as ZGESVJ does, but
 it does not check convergence (stopping criterion). Few tuning
 parameters (marked by [TP]) are available for the implementer.
 \endverbatim
 \param[in] JOBV
 \verbatim
          JOBV is CHARACTER*1
          Specifies whether the output from this procedure is used
          to compute the matrix V:
          = &lsquo;V&rsquo;: the product of the Jacobi rotations is accumulated
                 by postmulyiplying the N-by-N array V.
                (See the description of V.)
          = &lsquo;A&rsquo;: the product of the Jacobi rotations is accumulated
                 by postmulyiplying the MV-by-N array V.
                (See the descriptions of MV and V.)
          = &lsquo;N&rsquo;: the Jacobi rotations are not accumulated.
 \endverbatim</p>
<p>\param[in] M
 \verbatim
          M is INTEGER
          The number of rows of the input matrix A.  M &gt;= 0.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          The number of columns of the input matrix A.
          M &gt;= N &gt;= 0.
 \endverbatim</p>
<p>\param[in,out] A
 \verbatim
          A is COMPLEX<em>16 array, dimension (LDA,N)
          On entry, M-by-N matrix A, such that A</em>diag(D) represents
          the input matrix.
          On exit,
          A_onexit * diag(D_onexit) represents the input matrix A*diag(D)
          post-multiplied by a sequence of Jacobi rotations, where the
          rotation threshold and the total number of sweeps are given in
          TOL and NSWEEP, respectively.
          (See the descriptions of D, TOL and NSWEEP.)
 \endverbatim</p>
<p>\param[in] LDA
 \verbatim
          LDA is INTEGER
          The leading dimension of the array A.  LDA &gt;= max(1,M).
 \endverbatim</p>
<p>\param[in,out] D
 \verbatim
          D is COMPLEX<em>16 array, dimension (N)
          The array D accumulates the scaling factors from the complex scaled
          Jacobi rotations.
          On entry, A</em>diag(D) represents the input matrix.
          On exit, A_onexit*diag(D_onexit) represents the input matrix
          post-multiplied by a sequence of Jacobi rotations, where the
          rotation threshold and the total number of sweeps are given in
          TOL and NSWEEP, respectively.
          (See the descriptions of A, TOL and NSWEEP.)
 \endverbatim</p>
<p>\param[in,out] SVA
 \verbatim
          SVA is DOUBLE PRECISION array, dimension (N)
          On entry, SVA contains the Euclidean norms of the columns of
          the matrix A<em>diag(D).
          On exit, SVA contains the Euclidean norms of the columns of
          the matrix A_onexit</em>diag(D_onexit).
 \endverbatim</p>
<p>\param[in] MV
 \verbatim
          MV is INTEGER
          If JOBV = &lsquo;A&rsquo;, then MV rows of V are post-multipled by a
                           sequence of Jacobi rotations.
          If JOBV = &lsquo;N&rsquo;,   then MV is not referenced.
 \endverbatim</p>
<p>\param[in,out] V
 \verbatim
          V is COMPLEX*16 array, dimension (LDV,N)
          If JOBV = &lsquo;V&rsquo; then N rows of V are post-multipled by a
                           sequence of Jacobi rotations.
          If JOBV = &lsquo;A&rsquo; then MV rows of V are post-multipled by a
                           sequence of Jacobi rotations.
          If JOBV = &lsquo;N&rsquo;,   then V is not referenced.
 \endverbatim</p>
<p>\param[in] LDV
 \verbatim
          LDV is INTEGER
          The leading dimension of the array V,  LDV &gt;= 1.
          If JOBV = &lsquo;V&rsquo;, LDV &gt;= N.
          If JOBV = &lsquo;A&rsquo;, LDV &gt;= MV.
 \endverbatim</p>
<p>\param[in] EPS
 \verbatim
          EPS is DOUBLE PRECISION
          EPS = DLAMCH(&lsquo;Epsilon&rsquo;)
 \endverbatim</p>
<p>\param[in] SFMIN
 \verbatim
          SFMIN is DOUBLE PRECISION
          SFMIN = DLAMCH(&lsquo;Safe Minimum&rsquo;)
 \endverbatim</p>
<p>\param[in] TOL
 \verbatim
          TOL is DOUBLE PRECISION
          TOL is the threshold for Jacobi rotations. For a pair
          A(:,p), A(:,q) of pivot columns, the Jacobi rotation is
          applied only if ABS(COS(angle(A(:,p),A(:,q)))) &gt; TOL.
 \endverbatim</p>
<p>\param[in] NSWEEP
 \verbatim
          NSWEEP is INTEGER
          NSWEEP is the number of sweeps of Jacobi rotations to be
          performed.
 \endverbatim</p>
<p>\param[out] WORK
 \verbatim
          WORK is COMPLEX*16 array, dimension (LWORK)
 \endverbatim</p>
<p>\param[in] LWORK
 \verbatim
          LWORK is INTEGER
          LWORK is the dimension of WORK. LWORK &gt;= M.
 \endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          = 0:  successful exit.
          &lt; 0:  if INFO = -i, then the i-th argument had an illegal value
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date June 2016
 \ingroup complex16OTHERcomputational</p>
<p>\par Further Details:</p>
<p>ZGSVJ0 is used just to enable ZGESVJ to call a simplified version of
 itself to work on a submatrix of the original matrix.</p>
<p>Contributor:</p>
<p>Zlatko Drmac (Zagreb, Croatia)</p>
<p>\par Bugs, Examples and Comments:</p>
<p>Please report all bugs and send interesting test examples and comments to
 drmac@math.hr. Thank you.</p>
<p>&ndash;ZGSVJ0228
     .. Scalar Arguments ..
*</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-jobv~14"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~273"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>M</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~759"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~459"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>A</strong>(Lda,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lda~443"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lda</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-d~107"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>D</strong>(N)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sva~5"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Sva</strong>(N)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mv~3"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Mv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-v~46"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>V</strong>(Ldv,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldv~33"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-eps~2"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Eps</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sfmin~2"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Sfmin</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tol~4"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Tol</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nsweep~2"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Nsweep</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~442"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(Lwork)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~210"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~601"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-half~40"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>HALF</strong></td>
<td> =</td>
                <td>0.5D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~503"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~475"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapp~5"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapp0~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapp0</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapq~3"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapq1"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapq1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aaqq~5"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aaqq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-apoaq~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>apoaq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-applv~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>applv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aqoap~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aqoap</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-big~10"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>big</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bigtheta~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bigtheta</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-blskip~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>blskip</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cs~15"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cs</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-emptsw~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>emptsw</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i~544"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ibr~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ibr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ierr~44"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ierr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-igl~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>igl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ijblsk~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ijblsk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ir1~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ir1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iswrot~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iswrot</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jbc~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jbc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jgl~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jgl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kbl~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kbl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lkahead~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lkahead</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mvl~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mvl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mxaapq~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mxaapq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mxsinj~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mxsinj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nbl~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nbl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-notrot~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>notrot</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ompq"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ompq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~21"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pskipped~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>pskipped</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~11"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rootbig~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rootbig</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rooteps~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rooteps</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rootsfmin~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rootsfmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-roottol~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>roottol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rotok~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rotok</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rowskip~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rowskip</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rsvec~8"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-small~16"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>small</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sn~18"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sn</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-swband~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>swband</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~38"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>t</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-temp1~18"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>temp1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-theta~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>theta</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-thsign~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>thsign</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">ZGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">Mv</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Eps</span><span class="p">,</span><span class="n">Sfmin</span><span class="p">,</span><span class="n">Tol</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Nsweep</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!  -- LAPACK computational routine (version 3.8.0) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     June 2016</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--ZGSVJ0228</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Mv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Nsweep</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">Eps</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Sfmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Tol</span><span class="w"></span>
<span class="w">      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">1</span><span class="w"> </span><span class="n">Jobv</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">Lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">Ldv</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Local Parameters ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">HALF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0D0</span><span class="p">,</span><span class="n">HALF</span><span class="o">=</span><span class="mf">0.5D0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0D0</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">aapq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ompq</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">aapp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aapp0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aapq1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">apoaq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aqoap</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">big</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bigtheta</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cs</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mxaapq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mxsinj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rootbig</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">rooteps</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rootsfmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">roottol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">temp1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">thsign</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">blskip</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">emptsw</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ibr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ir1</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">iswrot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jbc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kbl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lkahead</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mvl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nbl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rowskip</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">swband</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">applv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rsvec</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">CONJG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">DBLE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SIGN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SQRT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">DZNRM2</span><span class="w"></span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">ZDOTC</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">IDAMAX</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">IDAMAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">LSAME</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZDOTC</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DZNRM2</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="c">!     ..</span>
<span class="c">!     from BLAS</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">ZCOPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZROT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZSWAP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZAXPY</span><span class="w"></span>
<span class="c">!     from LAPACK</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">ZLASCL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASSQ</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Test the input parameters.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">applv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">M</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lda</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Mv</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">applv</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">Mv</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Tol</span><span class="o">&lt;=</span><span class="n">Eps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">13</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Nsweep</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">14</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">16</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     #:(</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;ZGSVJ0&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">mvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">mvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mv</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="w"></span>
<span class="w"> </span>
<span class="w">      </span><span class="n">rooteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">Eps</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rootsfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">Sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">small</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sfmin</span><span class="o">/</span><span class="n">Eps</span><span class="w"></span>
<span class="w">      </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">Sfmin</span><span class="w"></span>
<span class="w">      </span><span class="n">rootbig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">rootsfmin</span><span class="w"></span>
<span class="w">      </span><span class="n">bigtheta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">rooteps</span><span class="w"></span>
<span class="w">      </span><span class="n">roottol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">Tol</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. Row-cyclic Jacobi SVD algorithm with column pivoting ..</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">emptsw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. Row-cyclic pivot strategy with de Rijk&#39;s pivoting ..</span>
<span class="c">!</span>
<span class="w"> </span>
<span class="w">      </span><span class="n">swband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">![TP] SWBAND is a tuning parameter [TP]. It is meaningful and effective</span>
<span class="c">!     if ZGESVJ is used as a computational routine in the preconditioned</span>
<span class="c">!     Jacobi SVD algorithm ZGEJSV. For sweeps i=1:SWBAND the procedure</span>
<span class="c">!     works on pivots inside a band-like region around the diagonal.</span>
<span class="c">!     The boundaries are determined dynamically, based on the number of</span>
<span class="c">!     pivots above a threshold.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">kbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">![TP] KBL is a tuning parameter that defines the tile size in the</span>
<span class="c">!     tiling of the p-q loops of pivot pairs. In general, an optimal</span>
<span class="c">!     value of KBL depends on the matrix dimensions and on the</span>
<span class="c">!     parameters of the computer&#39;s memory.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">nbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="n">kbl</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nbl</span><span class="o">*</span><span class="n">kbl</span><span class="p">)</span><span class="o">/=</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">nbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">blskip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbl</span><span class="o">**</span><span class="mi">2</span><span class="w"></span>
<span class="c">![TP] BLKSKIP is a tuning parameter that depends on SWBAND and KBL.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">rowskip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">kbl</span><span class="p">)</span><span class="w"></span>
<span class="c">![TP] ROWSKIP is a tuning parameter.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">lkahead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![TP] LKAHEAD is a tuning parameter.</span>
<span class="c">!</span>
<span class="c">!     Quasi block transformations, using the lower (upper) triangular</span>
<span class="c">!     structure of the input matrix. The quasi-block-cycling usually</span>
<span class="c">!     invokes cubic convergence. Big part of this cycle is done inside</span>
<span class="c">!     canonical subspaces of dimensions less than M.</span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!     .. Row-cyclic pivot strategy with de Rijk&#39;s pivoting ..</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Nsweep</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. go go go ...</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Each sweep is unrolled using KBL-by-KBL tiles over the pivot pairs</span>
<span class="c">!     1 &lt;= p &lt; q &lt;= N. This is the first step toward a blocked implementation</span>
<span class="c">!     of the rotations. New implementation, based on block transformations,</span>
<span class="c">!     is under development.</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">ibr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ibr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">ir1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">lkahead</span><span class="p">,</span><span class="n">nbl</span><span class="o">-</span><span class="n">ibr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ir1</span><span class="o">*</span><span class="n">kbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. de Rijk&#39;s pivoting</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IDAMAX</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">ZSWAP</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZSWAP</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">                     </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapq</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Column norms are periodically updated by explicit</span>
<span class="c">!        norm computation.</span>
<span class="c">!        Caveat:</span>
<span class="c">!        Unfortunately, some BLAS implementations compute SNCRM2(M,A(1,p),1)</span>
<span class="c">!        as SQRT(S=ZDOTC(M,A(1,p),1,A(1,p),1)), which may cause the result to</span>
<span class="c">!        overflow for ||A(:,p)||_2 &gt; SQRT(overflow_threshold), and to</span>
<span class="c">!        underflow for ||A(:,p)||_2 &lt; SQRT(underflow_threshold).</span>
<span class="c">!        Hence, DZNRM2 cannot be trusted, not even in the case when</span>
<span class="c">!        the true norm is far from the under(over)flow boundaries.</span>
<span class="c">!        If properly implemented DZNRM2 is available, the IF-THEN-ELSE-END IF</span>
<span class="c">!        below should be replaced with &quot;AAPP = DZNRM2( M, A(1,p), 1 )&quot;.</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ELSE</span>
<span class="k">                        </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                     </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="n">aapp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aapp</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ELSE</span>
<span class="k">                              </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aaqq</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">/</span><span class="n">aapp</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                           AAPQ = AAPQ * CONJG( CWORK(p) ) * CWORK(q)</span>
<span class="w">                           </span><span class="n">aapq1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxaapq</span><span class="p">,</span><span class="o">-</span><span class="n">aapq1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        TO rotate or NOT to rotate, THAT is the question ...</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">Tol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">ompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapq</span><span class="o">/</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. rotate</span>
<span class="c">![RTD]      ROTATED = ROTATED + ONE</span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                                 </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                                 </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iswrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                                 </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                                 </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">HALF</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aqoap</span><span class="o">-</span><span class="n">apoaq</span><span class="p">)</span><span class="o">/</span><span class="n">aapq1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">&gt;</span><span class="n">bigtheta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HALF</span><span class="o">/</span><span class="n">theta</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w"> </span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">cs</span><span class="p">,</span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 .. choose correct signum for THETA and rotate</span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">SIGN</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapq1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">thsign</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">theta</span><span class="o">*</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">cs</span><span class="p">,</span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">ompq</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!              .. have to use modified Gram-Schmidt like transformation</span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">aapq</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq1</span><span class="o">*</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">Sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!           END IF ROTOK THEN ... ELSE</span>
<span class="c">!</span>
<span class="c">!           In the case of cancellation in updating SVA(q), SVA(p)</span>
<span class="c">!           recompute SVA(q), SVA(p).</span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                              ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">aapp0</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!        A(:,p) and A(:,q) already numerically orthogonal</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![RTD]      SKIPPED  = SKIPPED  + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ELSE</span><span class="w"></span>
<span class="c">!        A(:,q) is zero column</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pskipped</span><span class="o">&gt;</span><span class="n">rowskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">EXIT</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     END q-LOOP</span>
<span class="c">!</span>
<span class="c">!     bailed out of q-loop</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the p-loop</span>
<span class="c">!     end of doing the block ( ibr, ibr )</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of ir1-loop</span>
<span class="c">!</span>
<span class="c">! ... go to the off diagonal blocks</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ibr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">jbc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ibr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">jgl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">jbc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        doing the block at ( ibr, jbc )</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">jgl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">aapp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. M x 2 Jacobi SVD ..</span>
<span class="c">!</span>
<span class="c">!        Safe Gram matrix computation</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aapp</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aaqq</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ELSE</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aaqq</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">/</span><span class="nb">MAX</span><span class="p">(</span><span class="n">aaqq</span><span class="p">,</span><span class="n">aapp</span><span class="p">))</span><span class="o">/</span><span class="nb">MIN</span><span class="p">(</span><span class="n">aaqq</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZDOTC</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                           AAPQ = AAPQ * CONJG(CWORK(p))*CWORK(q)</span>
<span class="w">                           </span><span class="n">aapq1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxaapq</span><span class="p">,</span><span class="o">-</span><span class="n">aapq1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        TO rotate or NOT to rotate, THAT is the question ...</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">Tol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">ompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapq</span><span class="o">/</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">![RTD]      ROTATED  = ROTATED + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                              </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iswrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                                 </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                                 </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">HALF</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aqoap</span><span class="o">-</span><span class="n">apoaq</span><span class="p">)</span><span class="o">/</span><span class="n">aapq1</span><span class="w"></span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">aapp0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">theta</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">&gt;</span><span class="n">bigtheta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HALF</span><span class="o">/</span><span class="n">theta</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">cs</span><span class="p">,</span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 .. choose correct signum for THETA and rotate</span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">SIGN</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapq1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">aapp0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">thsign</span><span class="w"></span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">thsign</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">theta</span><span class="o">*</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">cs</span><span class="p">,</span><span class="nb">CONJG</span><span class="p">(</span><span class="n">ompq</span><span class="p">)</span><span class="o">*</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">ompq</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              .. have to use modified Gram-Schmidt like transformation</span>
<span class="w">                              </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">aapq</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq1</span><span class="o">*</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">Sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">ZCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="nb">CONJG</span><span class="p">(</span><span class="n">aapq</span><span class="p">),</span><span class="n">Work</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">ZLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq1</span><span class="o">*</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">aapq1</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">Sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!           END IF ROTOK THEN ... ELSE</span>
<span class="c">!</span>
<span class="c">!           In the case of cancellation in updating SVA(q), SVA(p)</span>
<span class="c">!           .. recompute SVA(q), SVA(p)</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                              ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">aapp0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!              end of OK rotation</span>
<span class="w">                           </span><span class="k">ELSE</span>
<span class="k">                              </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![RTD]      SKIPPED  = SKIPPED  + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                              </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ELSE</span>
<span class="k">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ijblsk</span><span class="o">&gt;=</span><span class="n">blskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span>
<span class="k">                        IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pskipped</span><span class="o">&gt;</span><span class="n">rowskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">EXIT</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!        end of the q-loop</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="nb">MIN</span><span class="p">(</span><span class="n">jgl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the p-loop</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the jbc-loop</span>
<span class="c">!2011 bailed out of the jbc-loop</span>
<span class="w"> </span><span class="mi">20</span><span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!**</span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!2000 :: end of the ibr-loop</span>
<span class="c">!</span>
<span class="c">!     .. update SVA(N)</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DZNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Additional steering devices</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">mxaapq</span><span class="o">&lt;=</span><span class="n">roottol</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">iswrot</span><span class="o">&lt;=</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">swband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">swband</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">mxaapq</span><span class="o">&lt;</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">Tol</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">mxaapq</span><span class="o">*</span><span class="n">mxsinj</span><span class="o">&lt;</span><span class="n">Tol</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">notrot</span><span class="o">&gt;=</span><span class="n">emptsw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end i=1:NSWEEP loop</span>
<span class="c">!</span>
<span class="c">! #:( Reaching this point means that the procedure has not converged.</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nsweep</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="c">!</span>
<span class="c">! #:) Reaching this point means numerical convergence after the i-th</span>
<span class="c">!     sweep.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">! #:) INFO = 0 confirms successful iterations.</span>
<span class="c">!</span>
<span class="c">!     Sort the vector SVA() of column norms.</span>
<span class="w"> </span><span class="mi">200</span><span class="w">  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IDAMAX</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">D</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">D</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapq</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">ZSWAP</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZSWAP</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ..</span>
<span class="c">!     .. END OF ZGSVJ0</span>
<span class="c">!     ..</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">ZGSVJ0</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>