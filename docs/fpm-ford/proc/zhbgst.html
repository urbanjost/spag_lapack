<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>ZHBGST &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>ZHBGST
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.2% of total for procedures.">632 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/zhbgst.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/zhbgst.f90.html'>zhbgst.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">ZHBGST</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/zhbgst.html#variable-cone~141">CONE</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-czero~105">CZERO</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-one~1017">ONE</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-bii~3">bii</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-i~1106">i</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-i0~5">i0</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-i1~81">i1</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-i2~77">i2</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-inca~8">inca</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-j~862">j</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-j1~40">j1</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-j1t~3">j1t</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-j2~31">j2</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-j2t~3">j2t</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-k~385">k</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-ka1~3">ka1</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-kb1~4">kb1</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-kbt~3">kbt</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-l~93">l</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-m~51">m</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-nr~23">nr</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-nrt~8">nrt</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-nx~55">nx</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-ra~8">ra</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-ra1~3">ra1</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-t~97">t</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-update~3">update</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-upper~396">upper</a>
            <a class="list-group-item" href="../proc/zhbgst.html#variable-wantx~3">wantx</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/zhbgst.html#src">ZHBGST</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine ZHBGST(Vect, Uplo, N, Ka, Kb, Ab, Ldab, Bb, Ldbb, X, Ldx, Work, Rwork, Info)  
</h2>
    

    <p>\brief \b ZHBGST
 \htmlonly
 Download ZHBGST + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/zhbgst.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/zhbgst.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/zhbgst.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>ZHBGST reduces a complex Hermitian-definite banded generalized
 eigenproblem  A<em>x = lambda</em>B<em>x  to standard form  C</em>y = lambda*y,
 such that C has the same bandwidth as A.</p>
<p>B must have been previously factorized as S<strong>H*S by ZPBSTF, using a
 split Cholesky factorization. A is overwritten by C = X</strong>H<em>A</em>X, where
 X = S<em><em>(-1)</em>Q and Q is a unitary matrix chosen to preserve the
 bandwidth of A.
 \endverbatim
 \param[in] VECT
 \verbatim
          VECT is CHARACTER</em>1
          = &lsquo;N&rsquo;:  do not form the transformation matrix X;
          = &lsquo;V&rsquo;:  form X.
 \endverbatim</p>
<p>\param[in] UPLO
 \verbatim
          UPLO is CHARACTER*1
          = &lsquo;U&rsquo;:  Upper triangle of A is stored;
          = &lsquo;L&rsquo;:  Lower triangle of A is stored.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          The order of the matrices A and B.  N &gt;= 0.
 \endverbatim</p>
<p>\param[in] KA
 \verbatim
          KA is INTEGER
          The number of superdiagonals of the matrix A if UPLO = &lsquo;U&rsquo;,
          or the number of subdiagonals if UPLO = &lsquo;L&rsquo;.  KA &gt;= 0.
 \endverbatim</p>
<p>\param[in] KB
 \verbatim
          KB is INTEGER
          The number of superdiagonals of the matrix B if UPLO = &lsquo;U&rsquo;,
          or the number of subdiagonals if UPLO = &lsquo;L&rsquo;.  KA &gt;= KB &gt;= 0.
 \endverbatim</p>
<p>\param[in,out] AB
 \verbatim
          AB is COMPLEX*16 array, dimension (LDAB,N)
          On entry, the upper or lower triangle of the Hermitian band
          matrix A, stored in the first ka+1 rows of the array.  The
          j-th column of A is stored in the j-th column of the array AB
          as follows:
          if UPLO = &lsquo;U&rsquo;, AB(ka+1+i-j,j) = A(i,j) for max(1,j-ka)&lt;=i&lt;=j;
          if UPLO = &lsquo;L&rsquo;, AB(1+i-j,j)    = A(i,j) for j&lt;=i&lt;=min(n,j+ka).</p>
<div class="codehilite"><pre><span></span><code>      <span class="nv">On</span> <span class="k">exit</span>, <span class="nv">the</span> <span class="nv">transformed</span> <span class="nv">matrix</span> <span class="nv">X</span><span class="o">**</span><span class="nv">H</span><span class="o">*</span><span class="nv">A</span><span class="o">*</span><span class="nv">X</span>, <span class="nv">stored</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">same</span>
      <span class="nv">format</span> <span class="nv">as</span> <span class="nv">A</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] LDAB
 \verbatim
          LDAB is INTEGER
          The leading dimension of the array AB.  LDAB &gt;= KA+1.
 \endverbatim</p>
<p>\param[in] BB
 \verbatim
          BB is COMPLEX*16 array, dimension (LDBB,N)
          The banded factor S from the split Cholesky factorization of
          B, as returned by ZPBSTF, stored in the first kb+1 rows of
          the array.
 \endverbatim</p>
<p>\param[in] LDBB
 \verbatim
          LDBB is INTEGER
          The leading dimension of the array BB.  LDBB &gt;= KB+1.
 \endverbatim</p>
<p>\param[out] X
 \verbatim
          X is COMPLEX*16 array, dimension (LDX,N)
          If VECT = &lsquo;V&rsquo;, the n-by-n matrix X.
          If VECT = &lsquo;N&rsquo;, the array X is not referenced.
 \endverbatim</p>
<p>\param[in] LDX
 \verbatim
          LDX is INTEGER
          The leading dimension of the array X.
          LDX &gt;= max(1,N) if VECT = &lsquo;V&rsquo;; LDX &gt;= 1 otherwise.
 \endverbatim</p>
<p>\param[out] WORK
 \verbatim
          WORK is COMPLEX*16 array, dimension (N)
 \endverbatim</p>
<p>\param[out] RWORK
 \verbatim
          RWORK is DOUBLE PRECISION array, dimension (N)
 \endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          = 0:  successful exit
          &lt; 0:  if INFO = -i, the i-th argument had an illegal value.
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date December 2016
 \ingroup complex16OTHERcomputational
&ndash;ZHBGST169</p>
<p>&ndash; LAPACK computational routine (version 3.7.0) &ndash;
  &ndash; LAPACK is a software package provided by Univ. of Tennessee,    &ndash;
  &ndash; Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..&ndash;
     December 2016</p>
<div class="codehilite"><pre><span></span><code> .. Scalar Arguments ..
</code></pre></div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-vect~20"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Vect</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-uplo~674"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Uplo</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~1516"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ka~12"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ka</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kb~19"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Kb</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ab~148"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ab</strong>(Ldab,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldab~147"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldab</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bb~12"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Bb</strong>(Ldbb,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldbb~12"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldbb</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-x~266"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>X</strong>(Ldx,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldx~124"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldx</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~901"></span>
              complex(kind=16)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rwork~202"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Rwork</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~1181"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-cone~141"></span>
              complex(kind=16),
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>CONE</strong></td>
<td> =</td>
                <td>(1.0D+0,0.0D+0)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-czero~105"></span>
              complex(kind=16),
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>CZERO</strong></td>
<td> =</td>
                <td>(0.0D+0,0.0D+0)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~1017"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0D+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bii~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bii</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i~1106"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i0~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i0</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i1~81"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i2~77"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-inca~8"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>inca</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j~862"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j1~40"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j1t~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j1t</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j2~31"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j2t~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j2t</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-k~385"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>k</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ka1~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ka1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kb1~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kb1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kbt~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kbt</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-l~93"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~51"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>m</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nr~23"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nrt~8"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nrt</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nx~55"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nx</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ra~8"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ra</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ra1~3"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ra1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~97"></span>
              complex(kind=16),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>t</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-update~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>update</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-upper~396"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>upper</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wantx~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wantx</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">ZHBGST</span><span class="p">(</span><span class="n">Vect</span><span class="p">,</span><span class="n">Uplo</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ka</span><span class="p">,</span><span class="n">Kb</span><span class="p">,</span><span class="n">Ab</span><span class="p">,</span><span class="n">Ldab</span><span class="p">,</span><span class="n">Bb</span><span class="p">,</span><span class="n">Ldbb</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Ldx</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Rwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--ZHBGST169</span>
<span class="c">!</span>
<span class="c">!  -- LAPACK computational routine (version 3.7.0) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     December 2016</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">CHARACTER </span><span class="n">Uplo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Vect</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldab</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldbb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldx</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">Rwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">Ldab</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">Ldbb</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">(</span><span class="n">Ldx</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Parameters ..</span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">CZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">CONE</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">CZERO</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0D+0</span><span class="p">,</span><span class="mf">0.0D+0</span><span class="p">),</span><span class="n">CONE</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0D+0</span><span class="p">,</span><span class="mf">0.0D+0</span><span class="p">),</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0D+0</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">update</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wantx</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">inca</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ka1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kb1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nrt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nx</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">bii</span><span class="w"></span>
<span class="w">      </span><span class="kt">COMPLEX</span><span class="o">*</span><span class="mi">16</span><span class="w"> </span><span class="n">ra</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ra1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">XERBLA</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZDSCAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZGERC</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZGERU</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLACGV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLAR2V</span><span class="w"> </span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">ZLARGV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLARTG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLARTV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZROT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">DBLE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DCONJG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Test the input parameters</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">wantx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Vect</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Uplo</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">ka1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">kb1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wantx</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Vect</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">upper</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Uplo</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ka</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Kb</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">Kb</span><span class="o">&gt;</span><span class="n">Ka</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldab</span><span class="o">&lt;</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldbb</span><span class="o">&lt;</span><span class="n">Kb</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldx</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldx</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">11</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;ZHBGST&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return if possible</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">inca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ldab</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Initialize X to the unit matrix, if needed</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLASET</span><span class="p">(</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">CZERO</span><span class="p">,</span><span class="n">CONE</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Ldx</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Set M to the splitting point m. It must be the same value as is</span>
<span class="c">!     used in ZPBSTF. The chosen value allows the arrays WORK and RWORK</span>
<span class="c">!     to be of dimension (N).</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">Kb</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     The routine works in two phases, corresponding to the two halves</span>
<span class="c">!     of the split Cholesky factorization of B as S**H*S where</span>
<span class="c">!</span>
<span class="c">!     S = ( U    )</span>
<span class="c">!         ( M  L )</span>
<span class="c">!</span>
<span class="c">!     with U upper triangular of order m, and L lower triangular of</span>
<span class="c">!     order n-m. S has the same bandwidth as B.</span>
<span class="c">!</span>
<span class="c">!     S is treated as a product of elementary matrices:</span>
<span class="c">!</span>
<span class="c">!     S = S(m)*S(m-1)*...*S(2)*S(1)*S(m+1)*S(m+2)*...*S(n-1)*S(n)</span>
<span class="c">!</span>
<span class="c">!     where S(i) is determined by the i-th row of S.</span>
<span class="c">!</span>
<span class="c">!     In phase 1, the index i takes the values n, n-1, ... , m+1;</span>
<span class="c">!     in phase 2, it takes the values 1, 2, ... , m.</span>
<span class="c">!</span>
<span class="c">!     For each value of i, the current matrix A is updated by forming</span>
<span class="c">!     inv(S(i))**H*A*inv(S(i)). This creates a triangular bulge outside</span>
<span class="c">!     the band of A. The bulge is then pushed down toward the bottom of</span>
<span class="c">!     A in phase 1, and up toward the top of A in phase 2, by applying</span>
<span class="c">!     plane rotations.</span>
<span class="c">!</span>
<span class="c">!     There are kb*(kb+1)/2 elements in the bulge, but at most 2*kb-1</span>
<span class="c">!     of them are linearly independent, so annihilating a bulge requires</span>
<span class="c">!     only 2*kb-1 plane rotations. The rotations are divided into a 1st</span>
<span class="c">!     set of kb-1 rotations, and a 2nd set of kb rotations.</span>
<span class="c">!</span>
<span class="c">!     Wherever possible, rotations are generated and applied in vector</span>
<span class="c">!     operations of length NR between the indices J1 and J2 (sometimes</span>
<span class="c">!     replaced by modified values NRT, J1T or J2T).</span>
<span class="c">!</span>
<span class="c">!     The real cosines and complex sines of the rotations are stored in</span>
<span class="c">!     the arrays RWORK and WORK, those of the 1st set in elements</span>
<span class="c">!     2:m-kb-1, and those of the 2nd set in elements m-kb+1:n.</span>
<span class="c">!</span>
<span class="c">!     The bulges are not formed explicitly; nonzero elements outside the</span>
<span class="c">!     band are created only when they are required for generating new</span>
<span class="c">!     rotations; they are stored in the array WORK, in positions where</span>
<span class="c">!     they are later overwritten by the sines of the rotations which</span>
<span class="c">!     annihilate them.</span>
<span class="c">!</span>
<span class="c">!     **************************** Phase 1 *****************************</span>
<span class="c">!</span>
<span class="c">!     The logical structure of this phase is:</span>
<span class="c">!</span>
<span class="c">!     UPDATE = .TRUE.</span>
<span class="c">!     DO I = N, M + 1, -1</span>
<span class="c">!        use S(i) to update A and create a new bulge</span>
<span class="c">!        apply rotations to push all bulges KA positions downward</span>
<span class="c">!     END DO</span>
<span class="c">!     UPDATE = .FALSE.</span>
<span class="c">!     DO I = M + KA + 1, N - 1</span>
<span class="c">!        apply rotations to push all bulges KA positions downward</span>
<span class="c">!     END DO</span>
<span class="c">!</span>
<span class="c">!     To avoid duplicating code, the two loops are merged.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="k">DO WHILE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">kbt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">Kb</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">i0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">i0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ka</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CYCLE</span>
<span class="k">            GOTO</span><span class="w"> </span><span class="mi">300</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Ka</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">300</span><span class="w"></span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">200</span><span class="w">  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Transform A, working with the upper triangle</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Form  inv(S(i))**H * A * inv(S(i))</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">bii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">bii</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">+</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">Bb</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by inv(S(i))</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">bii</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZGERC</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">kbt</span><span class="p">,</span><span class="o">-</span><span class="n">CONE</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="o">-</span><span class="n">kbt</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">),</span><span class="n">Ldx</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           store a(i,i1) in RA1 for use in next loop over K</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">i1</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Generate and apply vectors of rotations to chase all the</span>
<span class="c">!        existing bulges KA positions down toward the bottom of the</span>
<span class="c">!        band</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Determine the rotations which would annihilate the bulge</span>
<span class="c">!              which has in theory just been created</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 generate rotation to annihilate a(i,i-k+ka+1)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">ra1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ra</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 create nonzero element a(i-k,i-k+ka+1) outside the</span>
<span class="c">!                 band and store it in WORK(i-k)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">))&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ra</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Ka</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2t</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j-ka,j+1) outside the band</span>
<span class="c">!              and store it in WORK(j-m)</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           generate rotations in 1st set to annihilate elements which</span>
<span class="c">!           have been created outside the band</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2t</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2t</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2t</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 1st set</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(i-kbt,i-kbt+ka+1) outside the</span>
<span class="c">!              band and store it in WORK(i-kbt)</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i2</span><span class="o">&lt;=</span><span class="n">N</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="o">-</span><span class="n">kbt</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j-ka,j+1) outside the band</span>
<span class="c">!              and store it in WORK(j)</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">&lt;</span><span class="n">N</span><span class="o">-</span><span class="n">Ka</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;=</span><span class="n">kbt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              generate rotations in 2nd set to annihilate elements</span>
<span class="c">!              which have been created outside the band</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 2nd set</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Kb</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Transform A, working with the lower triangle</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Form  inv(S(i))**H * A * inv(S(i))</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">bii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">bii</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">+</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by inv(S(i))</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">bii</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZGERU</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">kbt</span><span class="p">,</span><span class="o">-</span><span class="n">CONE</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Bb</span><span class="p">(</span><span class="n">kbt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">),</span><span class="n">Ldbb</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">),</span><span class="n">Ldx</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           store a(i1,i) in RA1 for use in next loop over K</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Generate and apply vectors of rotations to chase all the</span>
<span class="c">!        existing bulges KA positions down toward the bottom of the</span>
<span class="c">!        band</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Determine the rotations which would annihilate the bulge</span>
<span class="c">!              which has in theory just been created</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 generate rotation to annihilate a(i-k+ka+1,i)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="n">ra1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ra</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 create nonzero element a(i-k+ka+1,i-k) outside the</span>
<span class="c">!                 band and store it in WORK(i-k)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">))&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ra</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Ka</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2t</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j+1,j-ka) outside the band</span>
<span class="c">!              and store it in WORK(j-m)</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           generate rotations in 1st set to annihilate elements which</span>
<span class="c">!           have been created outside the band</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2t</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2t</span><span class="o">-</span><span class="n">m</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="p">,</span><span class="n">ka1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2t</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 1st set</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(i-kbt+ka+1,i-kbt) outside the</span>
<span class="c">!              band and store it in WORK(i-kbt)</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i2</span><span class="o">&lt;=</span><span class="n">N</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kbt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">kbt</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j+1,j-ka) outside the band</span>
<span class="c">!              and store it in WORK(j)</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">&lt;</span><span class="n">N</span><span class="o">-</span><span class="n">Ka</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;=</span><span class="n">kbt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              generate rotations in 2nd set to annihilate elements</span>
<span class="c">!              which have been created outside the band</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j2</span><span class="o">-</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 2nd set</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="n">i0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j2</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j2</span><span class="o">-</span><span class="n">m</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Kb</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">Ka</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!     **************************** Phase 2 *****************************</span>
<span class="c">!</span>
<span class="c">!     The logical structure of this phase is:</span>
<span class="c">!</span>
<span class="c">!     UPDATE = .TRUE.</span>
<span class="c">!     DO I = 1, M</span>
<span class="c">!        use S(i) to update A and create a new bulge</span>
<span class="c">!        apply rotations to push all bulges KA positions upward</span>
<span class="c">!     END DO</span>
<span class="c">!     UPDATE = .FALSE.</span>
<span class="c">!     DO I = M - KA - 1, 2, -1</span>
<span class="c">!        apply rotations to push all bulges KA positions upward</span>
<span class="c">!     END DO</span>
<span class="c">!</span>
<span class="c">!     To avoid duplicating code, the two loops are merged.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">300</span><span class="w">  </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">DO</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">kbt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">Kb</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">i0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">i1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">i2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">i0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ka</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span>
<span class="k">               CYCLE</span>
<span class="k">            ENDIF</span>
<span class="k">         ELSE</span>
<span class="k">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Ka</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="o">-</span><span class="n">kbt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">nx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Transform A, working with the upper triangle</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Form  inv(S(i))**H * A * inv(S(i))</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">bii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">bii</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">                  DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w">                      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">kbt</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="n">kb1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by inv(S(i))</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">bii</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">                                          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="k">CALL </span><span class="n">ZGERU</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">kbt</span><span class="p">,</span><span class="o">-</span><span class="n">CONE</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Bb</span><span class="p">(</span><span class="n">Kb</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Ldbb</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldx</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           store a(i1,i) in RA1 for use in next loop over K</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i1</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Generate and apply vectors of rotations to chase all the</span>
<span class="c">!        existing bulges KA positions up toward the top of the band</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Determine the rotations which would annihilate the bulge</span>
<span class="c">!              which has in theory just been created</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">ka1</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">&lt;</span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 generate rotation to annihilate a(i+k-ka-1,i)</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="n">ra1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">ra</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 create nonzero element a(i+k-ka-1,i+k) outside the</span>
<span class="c">!                 band and store it in WORK(m-kb+i+k)</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">))</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ra</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Ka</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2t</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j-1,j+ka) outside the band</span>
<span class="c">!              and store it in WORK(j)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           generate rotations in 1st set to annihilate elements which</span>
<span class="c">!           have been created outside the band</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">ka1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">                                          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 1st set</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(i+kbt-ka-1,i+kbt) outside the</span>
<span class="c">!              band and store it in WORK(m-kb+i+kbt)</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i2</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">kbt</span><span class="p">)</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kb1</span><span class="o">-</span><span class="n">kbt</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">kbt</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">                                          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j-1,j+ka) outside the band</span>
<span class="c">!              and store it in WORK(m-kb+j)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">&gt;</span><span class="n">ka1</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;=</span><span class="n">kbt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              generate rotations in 2nd set to annihilate elements</span>
<span class="c">!              which have been created outside the band</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="n">Ka</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">                                          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 2nd set</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w">                                          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Kb</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Ka</span><span class="w"></span>
<span class="w">                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Transform A, working with the lower triangle</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Form  inv(S(i))**H * A * inv(S(i))</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">bii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">/</span><span class="n">bii</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">bii</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">+</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">Bb</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">*</span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">                  DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kbt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">))</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">kbt</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by inv(S(i))</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZDSCAL</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">bii</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZGERC</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">kbt</span><span class="p">,</span><span class="o">-</span><span class="n">CONE</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Bb</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldx</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           store a(i,i1) in RA1 for use in next loop over K</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ab</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">i1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Generate and apply vectors of rotations to chase all the</span>
<span class="c">!        existing bulges KA positions up toward the top of the band</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Determine the rotations which would annihilate the bulge</span>
<span class="c">!              which has in theory just been created</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">ka1</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">&lt;</span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 generate rotation to annihilate a(i,i+k-ka-1)</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTG</span><span class="p">(</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">ra1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">),</span><span class="n">ra</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 create nonzero element a(i+k,i+k-ka-1) outside the</span>
<span class="c">!                 band and store it in WORK(m-kb+i+k)</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">))</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">ra1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ra</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j2</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">Ka</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">j2t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2t</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j+ka,j-1) outside the band</span>
<span class="c">!              and store it in WORK(j)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           generate rotations in 1st set to annihilate elements which</span>
<span class="c">!           have been created outside the band</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">ka1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from the right</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 1st set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Work</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 1st set</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(i+kbt,i+kbt-ka-1) outside the</span>
<span class="c">!              band and store it in WORK(m-kb+i+kbt)</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i2</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">kbt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">kbt</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Bb</span><span class="p">(</span><span class="n">kbt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="o">*</span><span class="n">ra1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="o">+</span><span class="n">Ka</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              create nonzero element a(j+ka,j-1) outside the band</span>
<span class="c">!              and store it in WORK(m-kb+j)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">&gt;</span><span class="n">ka1</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;=</span><span class="n">kbt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="n">Ka</span><span class="p">)</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">Ka</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="n">j1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              generate rotations in 2nd set to annihilate elements</span>
<span class="c">!              which have been created outside the band</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLARGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from the right</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              apply rotations in 2nd set from both sides to diagonal</span>
<span class="c">!              blocks</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLAR2V</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ab</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j1</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">ZLACGV</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           start applying rotations in 2nd set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ka</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wantx</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              post-multiply X by product of rotations in 2nd set</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ka1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">ZROT</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">DCONJG</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">Kb</span><span class="o">+</span><span class="n">j</span><span class="p">)))</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">j2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">i0</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           finish applying rotations in 1st set from the left</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Kb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">nrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j2</span><span class="o">+</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="n">j1t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">nrt</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ka1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nrt</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">ZLARTV</span><span class="p">(</span><span class="n">nrt</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">inca</span><span class="p">,</span><span class="n">Ab</span><span class="p">(</span><span class="n">ka1</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="n">j1t</span><span class="o">-</span><span class="n">ka1</span><span class="o">+</span><span class="n">l</span><span class="p">),</span><span class="n">inca</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Work</span><span class="p">(</span><span class="n">j1t</span><span class="p">),</span><span class="n">ka1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Kb</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Ka</span><span class="w"></span>
<span class="w">                  </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="n">Ka</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     End of ZHBGST</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">ZHBGST</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>