<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>SGESVDQ &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>SGESVDQ
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.2% of total for procedures.">604 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/sgesvdq.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/sgesvdq.f90.html'>sgesvdq.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">SGESVDQ</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-one~397">ONE</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-zero~387">ZERO</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-accla~3">accla</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-acclh~3">acclh</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-acclm~3">acclm</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-ascaled~3">ascaled</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-big~8">big</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-conda~3">conda</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-dntwu~3">dntwu</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-dntwv~3">dntwv</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-epsln~6">epsln</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-ierr~35">ierr</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-iminwrk~3">iminwrk</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-iwoff~7">iwoff</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lquery~160">lquery</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lsvc0~3">lsvc0</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lsvec~6">lsvec</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwcon~5">lwcon</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwlqf~5">lwlqf</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lworq~2">lworq</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lworq2~2">lworq2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwqp3~5">lwqp3</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwqrf~5">lwqrf</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sgelqf">lwrk_sgelqf</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sgeqp3">lwrk_sgeqp3</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sgeqrf">lwrk_sgeqrf</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sgesvd">lwrk_sgesvd</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sgesvd2">lwrk_sgesvd2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sormlq">lwrk_sormlq</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sormqr">lwrk_sormqr</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwrk_sormqr2">lwrk_sormqr2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwsvd~3">lwsvd</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwsvd2~3">lwsvd2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-lwunlq~2">lwunlq</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-minwrk~20">minwrk</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-minwrk2~3">minwrk2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-n1~34">n1</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-nr~10">nr</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-optratio~3">optratio</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-optwrk~5">optwrk</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-optwrk2~3">optwrk2</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-p~16">p</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-q~8">q</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rdummy~5">rdummy</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rminwrk~3">rminwrk</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rowprm~3">rowprm</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rsvec~6">rsvec</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rtmp~3">rtmp</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-rtrans~3">rtrans</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-sconda~5">sconda</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-sfmin~24">sfmin</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntua~4">wntua</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntuf~3">wntuf</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntur~3">wntur</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntus~4">wntus</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntva~4">wntva</a>
            <a class="list-group-item" href="../proc/sgesvdq.html#variable-wntvr~3">wntvr</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/sgesvdq.html#src">SGESVDQ</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine SGESVDQ(Joba, Jobp, Jobr, Jobu, Jobv, M, N, A, Lda, S, U, Ldu, V, Ldv, Numrank, Iwork, Liwork, Work, Lwork, Rwork, Lrwork, Info)  
</h2>
    

    <p>\brief <b> SGESVDQ computes the singular value decomposition (SVD) with a QR-Preconditioned QR SVD Method for GE matrices</b>
 \htmlonly
 Download SGESVDQ + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/sgesvdq.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/sgesvdq.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/sgesvdq.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>SGESVDQ computes the singular value decomposition (SVD) of a real
 M-by-N matrix A, where M &gt;= N. The SVD of A is written as
                                    [++]   [xx]   [x0]   [xx]
              A = U * SIGMA * V^<em>,  [++] = [xx] * [ox] * [xx]
                                    [++]   [xx]
 where SIGMA is an N-by-N diagonal matrix, U is an M-by-N orthonormal
 matrix, and V is an N-by-N orthogonal matrix. The diagonal elements
 of SIGMA are the singular values of A. The columns of U and V are the
 left and the right singular vectors of A, respectively.
 \endverbatim
 \param[in] JOBA
 \verbatim
  JOBA is CHARACTER</em>1
  Specifies the level of accuracy in the computed SVD
  = &lsquo;A&rsquo; The requested accuracy corresponds to having the backward
        error bounded by || delta A ||_F &lt;= f(m,n) * EPS * || A ||_F,
        where EPS = SLAMCH(&lsquo;Epsilon&rsquo;). This authorises CGESVDQ to
        truncate the computed triangular factor in a rank revealing
        QR factorization whenever the truncated part is below the
        threshold of the order of EPS * ||A||_F. This is aggressive
        truncation level.
  = &lsquo;M&rsquo; Similarly as with &lsquo;A&rsquo;, but the truncation is more gentle: it
        is allowed only when there is a drop on the diagonal of the
        triangular factor in the QR factorization. This is medium
        truncation level.
  = &lsquo;H&rsquo; High accuracy requested. No numerical rank determination based
        on the rank revealing QR factorization is attempted.
  = &lsquo;E&rsquo; Same as &lsquo;H&rsquo;, and in addition the condition number of column
        scaled A is estimated and returned in  RWORK(1).
        N^(-1/4)<em>RWORK(1) &lt;= ||pinv(A_scaled)||_2 &lt;= N^(1/4)</em>RWORK(1)
 \endverbatim</p>
<p>\param[in] JOBP
 \verbatim
  JOBP is CHARACTER*1
  = &lsquo;P&rsquo; The rows of A are ordered in decreasing order with respect to
        ||A(i,:)||_\infty. This enhances numerical accuracy at the cost
        of extra data movement. Recommended for numerical robustness.
  = &lsquo;N&rsquo; No row pivoting.
 \endverbatim</p>
<p>\param[in] JOBR
 \verbatim
          JOBR is CHARACTER<em>1
          = &lsquo;T&rsquo; After the initial pivoted QR factorization, SGESVD is applied to
          the transposed R</em>*T of the computed triangular factor R. This involves
          some extra data movement (matrix transpositions). Useful for
          experiments, research and development.
          = &lsquo;N&rsquo; The triangular factor R is given as input to SGESVD. This may be
          preferred as it involves less data movement.
 \endverbatim</p>
<p>\param[in] JOBU
 \verbatim
          JOBU is CHARACTER<em>1
          = &lsquo;A&rsquo; All M left singular vectors are computed and returned in the
          matrix U. See the description of U.
          = &lsquo;S&rsquo; or &lsquo;U&rsquo; N = min(M,N) left singular vectors are computed and returned
          in the matrix U. See the description of U.
          = &lsquo;R&rsquo; Numerical rank NUMRANK is determined and only NUMRANK left singular
          vectors are computed and returned in the matrix U.
          = &lsquo;F&rsquo; The N left singular vectors are returned in factored form as the
          product of the Q factor from the initial QR factorization and the
          N left singular vectors of (R</em><em>T , 0)</em>*T. If row pivoting is used,
          then the necessary information on the row pivoting is stored in
          IWORK(N+1:N+M-1).
          = &lsquo;N&rsquo; The left singular vectors are not computed.
 \endverbatim</p>
<p>\param[in] JOBV
 \verbatim
          JOBV is CHARACTER*1
          = &lsquo;A&rsquo;, &lsquo;V&rsquo; All N right singular vectors are computed and returned in
          the matrix V.
          = &lsquo;R&rsquo; Numerical rank NUMRANK is determined and only NUMRANK right singular
          vectors are computed and returned in the matrix V. This option is
          allowed only if JOBU = &lsquo;R&rsquo; or JOBU = &lsquo;N&rsquo;; otherwise it is illegal.
          = &lsquo;N&rsquo; The right singular vectors are not computed.
 \endverbatim</p>
<p>\param[in] M
 \verbatim
          M is INTEGER
          The number of rows of the input matrix A.  M &gt;= 0.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          The number of columns of the input matrix A.  M &gt;= N &gt;= 0.
 \endverbatim</p>
<p>\param[in,out] A
 \verbatim
          A is REAL array of dimensions LDA x N
          On entry, the input matrix A.
          On exit, if JOBU .NE. &lsquo;N&rsquo; or JOBV .NE. &lsquo;N&rsquo;, the lower triangle of A contains
          the Householder vectors as stored by SGEQP3. If JOBU = &lsquo;F&rsquo;, these Householder
          vectors together with WORK(1:N) can be used to restore the Q factors from
          the initial pivoted QR factorization of A. See the description of U.
 \endverbatim</p>
<p>\param[in] LDA
 \verbatim
          LDA is INTEGER.
          The leading dimension of the array A.  LDA &gt;= max(1,M).
 \endverbatim</p>
<p>\param[out] S
 \verbatim
          S is REAL array of dimension N.
          The singular values of A, ordered so that S(i) &gt;= S(i+1).
 \endverbatim</p>
<p>\param[out] U
 \verbatim
          U is REAL array, dimension
          LDU x M if JOBU = &lsquo;A&rsquo;; see the description of LDU. In this case,
          on exit, U contains the M left singular vectors.
          LDU x N if JOBU = &lsquo;S&rsquo;, &lsquo;U&rsquo;, &lsquo;R&rsquo; ; see the description of LDU. In this
          case, U contains the leading N or the leading NUMRANK left singular vectors.
          LDU x N if JOBU = &lsquo;F&rsquo; ; see the description of LDU. In this case U
          contains N x N orthogonal matrix that can be used to form the left
          singular vectors.
          If JOBU = &lsquo;N&rsquo;, U is not referenced.
 \endverbatim</p>
<p>\param[in] LDU
 \verbatim
          LDU is INTEGER.
          The leading dimension of the array U.
          If JOBU = &lsquo;A&rsquo;, &lsquo;S&rsquo;, &lsquo;U&rsquo;, &lsquo;R&rsquo;,  LDU &gt;= max(1,M).
          If JOBU = &lsquo;F&rsquo;,                 LDU &gt;= max(1,N).
          Otherwise,                     LDU &gt;= 1.
 \endverbatim</p>
<p>\param[out] V
 \verbatim
          V is REAL array, dimension
          LDV x N if JOBV = &lsquo;A&rsquo;, &lsquo;V&rsquo;, &lsquo;R&rsquo; or if JOBA = &lsquo;E&rsquo; .
          If JOBV = &lsquo;A&rsquo;, or &lsquo;V&rsquo;,  V contains the N-by-N orthogonal matrix  V<strong>T;
          If JOBV = &lsquo;R&rsquo;, V contains the first NUMRANK rows of V</strong>T (the right
          singular vectors, stored rowwise, of the NUMRANK largest singular values).
          If JOBV = &lsquo;N&rsquo; and JOBA = &lsquo;E&rsquo;, V is used as a workspace.
          If JOBV = &lsquo;N&rsquo;, and JOBA.NE.&rsquo;E&rsquo;, V is not referenced.
 \endverbatim</p>
<p>\param[in] LDV
 \verbatim
          LDV is INTEGER
          The leading dimension of the array V.
          If JOBV = &lsquo;A&rsquo;, &lsquo;V&rsquo;, &lsquo;R&rsquo;,  or JOBA = &lsquo;E&rsquo;, LDV &gt;= max(1,N).
          Otherwise,                               LDV &gt;= 1.
 \endverbatim</p>
<p>\param[out] NUMRANK
 \verbatim
          NUMRANK is INTEGER
          NUMRANK is the numerical rank first determined after the rank
          revealing QR factorization, following the strategy specified by the
          value of JOBA. If JOBV = &lsquo;R&rsquo; and JOBU = &lsquo;R&rsquo;, only NUMRANK
          leading singular values and vectors are then requested in the call
          of SGESVD. The final value of NUMRANK might be further reduced if
          some singular values are computed as zeros.
 \endverbatim</p>
<p>\param[out] IWORK
 \verbatim
          IWORK is INTEGER array, dimension (max(1, LIWORK)).
          On exit, IWORK(1:N) contains column pivoting permutation of the
          rank revealing QR factorization.
          If JOBP = &lsquo;P&rsquo;, IWORK(N+1:N+M-1) contains the indices of the sequence
          of row swaps used in row pivoting. These can be used to restore the
          left singular vectors in the case JOBU = &lsquo;F&rsquo;.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LIWORK</span>, <span class="nv">LWORK</span>, <span class="nv">or</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">on</span> <span class="k">exit</span>, <span class="k">if</span> <span class="nv">INFO</span> <span class="o">=</span> <span class="mi">0</span>,
      <span class="nv">IWORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">minimal</span> <span class="nv">LIWORK</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] LIWORK
 \verbatim
          LIWORK is INTEGER
          The dimension of the array IWORK.
          LIWORK &gt;= N + M - 1,     if JOBP = &lsquo;P&rsquo; and JOBA .NE. &lsquo;E&rsquo;;
          LIWORK &gt;= N              if JOBP = &lsquo;N&rsquo; and JOBA .NE. &lsquo;E&rsquo;;
          LIWORK &gt;= N + M - 1 + N, if JOBP = &lsquo;P&rsquo; and JOBA = &lsquo;E&rsquo;;
          LIWORK &gt;= N + N          if JOBP = &lsquo;N&rsquo; and JOBA = &lsquo;E&rsquo;.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LIWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span> <span class="nv">is</span> <span class="nv">assumed</span><span class="c1">; the routine</span>
      <span class="nv">only</span> <span class="nv">calculates</span> <span class="nv">and</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">optimal</span> <span class="nv">and</span> <span class="nv">minimal</span> <span class="nv">sizes</span>
      <span class="k">for</span> <span class="nv">the</span> <span class="nv">WORK</span>, <span class="nv">IWORK</span>, <span class="nv">and</span> <span class="nv">RWORK</span> <span class="nv">arrays</span>, <span class="nv">and</span> <span class="nv">no</span> <span class="nv">error</span>
      <span class="nv">message</span> <span class="nv">related</span> <span class="nv">to</span> <span class="nv">LWORK</span> <span class="nv">is</span> <span class="nv">issued</span> <span class="nv">by</span> <span class="nv">XERBLA</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] WORK
 \verbatim
          WORK is REAL array, dimension (max(2, LWORK)), used as a workspace.
          On exit, if, on entry, LWORK.NE.-1, WORK(1:N) contains parameters
          needed to recover the Q factor from the QR factorization computed by
          SGEQP3.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LIWORK</span>, <span class="nv">LWORK</span>, <span class="nv">or</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">on</span> <span class="k">exit</span>, <span class="k">if</span> <span class="nv">INFO</span> <span class="o">=</span> <span class="mi">0</span>,
      <span class="nv">WORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">optimal</span> <span class="nv">LWORK</span>, <span class="nv">and</span>
      <span class="nv">WORK</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">minimal</span> <span class="nv">LWORK</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in,out] LWORK
 \verbatim
          LWORK is INTEGER
          The dimension of the array WORK. It is determined as follows:
          Let  LWQP3 = 3<em>N+1,  LWCON = 3</em>N, and let
          LWORQ = { MAX( N, 1 ),  if JOBU = &lsquo;R&rsquo;, &lsquo;S&rsquo;, or &lsquo;U&rsquo;
                  { MAX( M, 1 ),  if JOBU = &lsquo;A&rsquo;
          LWSVD = MAX( 5<em>N, 1 )
          LWLQF = MAX( N/2, 1 ), LWSVD2 = MAX( 5</em>(N/2), 1 ), LWORLQ = MAX( N, 1 ),
          LWQRF = MAX( N/2, 1 ), LWORQ2 = MAX( N, 1 )
          Then the minimal value of LWORK is:
          = MAX( N + LWQP3, LWSVD )        if only the singular values are needed;
          = MAX( N + LWQP3, LWCON, LWSVD ) if only the singular values are needed,
                                   and a scaled condition estimate requested;</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">left</span><span class="w"></span>
<span class="w">                               </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="o">;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">left</span><span class="w"></span>
<span class="w">                               </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">also</span><span class="w"></span>
<span class="w">                               </span><span class="nt">a</span><span class="w"> </span><span class="nt">scaled</span><span class="w"> </span><span class="nt">condition</span><span class="w"> </span><span class="nt">estimate</span><span class="w"> </span><span class="nt">requested</span><span class="o">;</span><span class="w"></span>

<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="w"> </span><span class="o">)</span><span class="w">        </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">right</span><span class="w"></span>
<span class="w">                               </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="o">;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">singular</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">right</span><span class="w"></span>
<span class="w">                               </span><span class="nt">singular</span><span class="w"> </span><span class="nt">vectors</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">requested</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">also</span><span class="w"></span>
<span class="w">                               </span><span class="nt">a</span><span class="w"> </span><span class="nt">scaled</span><span class="w"> </span><span class="nt">condition</span><span class="w"> </span><span class="nt">etimate</span><span class="w"> </span><span class="nt">requested</span><span class="o">;</span><span class="w"></span>

<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="o">;</span><span class="w"></span>
<span class="w">                               </span><span class="nt">independent</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">JOBR</span><span class="o">;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="o">,</span><span class="w"></span>
<span class="w">                               </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="w"> </span><span class="nt">and</span><span class="o">,</span><span class="w"> </span><span class="nt">also</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">scaled</span><span class="w"> </span><span class="nt">condition</span><span class="w"></span>
<span class="w">                               </span><span class="nt">estimate</span><span class="w"> </span><span class="nt">requested</span><span class="o">;</span><span class="w"> </span><span class="nt">independent</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">JOBR</span><span class="o">;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">),</span><span class="w"></span>
<span class="w">     </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWLQF</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWSVD2</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWORLQ</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"></span>
<span class="w">                     </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="nt">or</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"></span>
<span class="w">                     </span><span class="nt">JOBR</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">),</span><span class="w"></span>
<span class="w">     </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWLQF</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWSVD2</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWORLQ</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">                     </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="nt">or</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"></span>
<span class="w">                     </span><span class="nt">JOBR</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">also</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">scaled</span><span class="w"> </span><span class="nt">condition</span><span class="w"> </span><span class="nt">number</span><span class="w"> </span><span class="nt">estimate</span><span class="w"></span>
<span class="w">                     </span><span class="nt">requested</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">),</span><span class="w"></span>
<span class="w">     </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWQRF</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWSVD2</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWORQ2</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"></span>
<span class="w">                     </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="o">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">JOBR</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="w"></span>
<span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">LWSVD</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">),</span><span class="w"></span>
<span class="w">     </span><span class="nt">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">LWQP3</span><span class="o">,</span><span class="w"> </span><span class="nt">LWCON</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWQRF</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWSVD2</span><span class="o">,</span><span class="w"> </span><span class="nt">N</span><span class="o">/</span><span class="nt">2</span><span class="o">+</span><span class="nt">LWORQ2</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORQ</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"></span>
<span class="w">                     </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">full</span><span class="w"> </span><span class="nt">SVD</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">requested</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">JOBV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="nt">or</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"></span>
<span class="w">                     </span><span class="nt">JOBR</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">also</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">scaled</span><span class="w"> </span><span class="nt">condition</span><span class="w"> </span><span class="nt">number</span><span class="w"> </span><span class="nt">estimate</span><span class="w"></span>
<span class="w">                     </span><span class="nt">requested</span><span class="o">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">Finally</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="nt">must</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">least</span><span class="w"> </span><span class="nt">two</span><span class="o">:</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">MAX</span><span class="o">(</span><span class="w"> </span><span class="nt">2</span><span class="o">,</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="o">).</span><span class="w"></span>

<span class="w">      </span><span class="nt">If</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">-1</span><span class="o">,</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">workspace</span><span class="w"> </span><span class="nt">query</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">assumed</span><span class="o">;</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">routine</span><span class="w"></span>
<span class="w">      </span><span class="nt">only</span><span class="w"> </span><span class="nt">calculates</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">returns</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">optimal</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">minimal</span><span class="w"> </span><span class="nt">sizes</span><span class="w"></span>
<span class="w">      </span><span class="nt">for</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">WORK</span><span class="o">,</span><span class="w"> </span><span class="nt">IWORK</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">RWORK</span><span class="w"> </span><span class="nt">arrays</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">no</span><span class="w"> </span><span class="nt">error</span><span class="w"></span>
<span class="w">      </span><span class="nt">message</span><span class="w"> </span><span class="nt">related</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">LWORK</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">issued</span><span class="w"> </span><span class="nt">by</span><span class="w"> </span><span class="nt">XERBLA</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] RWORK
 \verbatim
          RWORK is REAL array, dimension (max(1, LRWORK)).
          On exit,
          1. If JOBA = &lsquo;E&rsquo;, RWORK(1) contains an estimate of the condition
          number of column scaled A. If A = C * D where D is diagonal and C
          has unit columns in the Euclidean norm, then, assuming full column rank,
          N^(-1/4) * RWORK(1) &lt;= ||pinv(C)||_2 &lt;= N^(1/4) * RWORK(1).
          Otherwise, RWORK(1) = -1.
          2. RWORK(2) contains the number of singular values computed as
          exact zeros in SGESVD applied to the upper triangular or trapezoidal
          R (from the initial QR factorization). In case of early exit (no call to
          SGESVD, such as in the case of zero matrix) RWORK(2) = -1.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LIWORK</span>, <span class="nv">LWORK</span>, <span class="nv">or</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">on</span> <span class="k">exit</span>, <span class="k">if</span> <span class="nv">INFO</span> <span class="o">=</span> <span class="mi">0</span>,
      <span class="nv">RWORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">minimal</span> <span class="nv">LRWORK</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] LRWORK
 \verbatim
          LRWORK is INTEGER.
          The dimension of the array RWORK.
          If JOBP =&rsquo;P&rsquo;, then LRWORK &gt;= MAX(2, M).
          Otherwise, LRWORK &gt;= 2</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LRWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span> <span class="nv">is</span> <span class="nv">assumed</span><span class="c1">; the routine</span>
      <span class="nv">only</span> <span class="nv">calculates</span> <span class="nv">and</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">optimal</span> <span class="nv">and</span> <span class="nv">minimal</span> <span class="nv">sizes</span>
      <span class="k">for</span> <span class="nv">the</span> <span class="nv">WORK</span>, <span class="nv">IWORK</span>, <span class="nv">and</span> <span class="nv">RWORK</span> <span class="nv">arrays</span>, <span class="nv">and</span> <span class="nv">no</span> <span class="nv">error</span>
      <span class="nv">message</span> <span class="nv">related</span> <span class="nv">to</span> <span class="nv">LWORK</span> <span class="nv">is</span> <span class="nv">issued</span> <span class="nv">by</span> <span class="nv">XERBLA</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          = 0:  successful exit.
          &lt; 0:  if INFO = -i, the i-th argument had an illegal value.
          &gt; 0:  if SBDSQR did not converge, INFO specifies how many superdiagonals
          of an intermediate bidiagonal form B (computed in SGESVD) did not
          converge to zero.
 \endverbatim
 \par Further Details:</p>
<p>\verbatim</p>
<ol>
<li>The data movement (matrix transpose) is coded using simple nested
   DO-loops because BLAS and LAPACK do not provide corresponding subroutines.
   Those DO-loops are easily identified in this source code - by the CONTINUE
   statements labeled with 11**. In an optimized version of this code, the
   nested DO loops should be replaced with calls to an optimized subroutine.</li>
<li>This code scales A by 1/SQRT(M) if the largest ABS(A(i,j)) could cause
   column norm overflow. This is the minial precaution and it is left to the
   SVD routine (CGESVD) to do its own preemptive scaling if potential over-
   or underflows are detected. To avoid repeated scanning of the array A,
   an optimal implementation would do all necessary scaling before calling
   CGESVD and the scaling in CGESVD can be switched off.</li>
<li>Other comments related to code optimization are given in comments in the
   code, enlosed in [[double brackets]].
 \endverbatim
 \par Bugs, examples and comments
 \verbatim
  Please report all bugs and send interesting examples and/or comments to
  drmac@math.hr. Thank you.
 \endverbatim
 \par References
 \verbatim
  [1] Zlatko Drmac, Algorithm 977: A QR-Preconditioned QR SVD Method for
      Computing the SVD with High Accuracy. ACM Trans. Math. Softw.
      44(1): 11:1-11:30 (2017)</li>
</ol>
<p>SIGMA library, xGESVDQ section updated February 2016.
  Developed and coded by Zlatko Drmac, Department of Mathematics
  University of Zagreb, Croatia, drmac@math.hr
 \endverbatim
 \par Contributors:</p>
<p>\verbatim
 Developed and coded by Zlatko Drmac, Department of Mathematics
  University of Zagreb, Croatia, drmac@math.hr
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date November 2018
 \ingroup realGEsing</p>
<p>&ndash;SGESVDQ420</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-joba~6"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Joba</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobp~5"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobp</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobr~5"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobr</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobu~12"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobu</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobv~10"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~211"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>M</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~590"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~348"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>A</strong>(Lda,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lda~336"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lda</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-s~45"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>S</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u~19"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>U</strong>(Ldu,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldu~19"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldu</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-v~34"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>V</strong>(Ldv,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldv~22"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-numrank~3"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Numrank</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwork~83"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Iwork</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-liwork~24"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Liwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~344"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~172"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rwork~90"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Rwork</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lrwork~19"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lrwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~470"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-one~397"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0E0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~387"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0E0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-accla~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>accla</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-acclh~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>acclh</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-acclm~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>acclm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ascaled~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ascaled</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-big~8"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>big</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-conda~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>conda</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-dntwu~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>dntwu</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-dntwv~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>dntwv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-epsln~6"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>epsln</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ierr~35"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ierr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iminwrk~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iminwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwoff~7"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iwoff</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lquery~160"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lquery</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lsvc0~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lsvc0</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lsvec~6"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwcon~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwcon</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwlqf~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwlqf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lworq~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lworq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lworq2~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lworq2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwqp3~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwqp3</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwqrf~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwqrf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sgelqf"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sgelqf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sgeqp3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sgeqp3</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sgeqrf"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sgeqrf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sgesvd"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sgesvd</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sgesvd2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sgesvd2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sormlq"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sormlq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sormqr"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sormqr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwrk_sormqr2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwrk_sormqr2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwsvd~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwsvd</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwsvd2~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwsvd2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwunlq~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwunlq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-minwrk~20"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>minwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-minwrk2~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>minwrk2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n1~34"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>n1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nr~10"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-optratio~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>optratio</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-optwrk~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>optwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-optwrk2~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>optwrk2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~16"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~8"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rdummy~5"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rdummy</strong>(1)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rminwrk~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rminwrk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rowprm~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rowprm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rsvec~6"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rtmp~3"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rtmp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rtrans~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rtrans</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sconda~5"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sconda</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sfmin~24"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sfmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntua~4"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntua</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntuf~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntuf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntur~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntur</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntus~4"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntus</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntva~4"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntva</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wntvr~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wntvr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">SGESVDQ</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="n">Jobp</span><span class="p">,</span><span class="n">Jobr</span><span class="p">,</span><span class="n">Jobu</span><span class="p">,</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                   </span><span class="n">Ldv</span><span class="p">,</span><span class="n">Numrank</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">Liwork</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="n">Rwork</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                   </span><span class="n">Lrwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--SGESVDQ420</span>
<span class="w">      </span><span class="kt">CHARACTER </span><span class="n">Joba</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobv</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">M</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Numrank</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Liwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">Lrwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">A</span><span class="p">(</span><span class="n">Lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">Ldu</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">Ldv</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">S</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Iwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Parameters ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0E0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0E0</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ierr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iwoff</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">optratio</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">lwcon</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwqp3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sgelqf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sgesvd2</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lwrk_sgeqp3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sgeqrf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sormlq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwrk_sormqr</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lwrk_sormqr2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwlqf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwqrf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwsvd</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwsvd2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lworq</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lworq2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwunlq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">minwrk2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">optwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">optwrk2</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">iminwrk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rminwrk</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">accla</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">acclm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">acclh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ascaled</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">dntwu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">dntwv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">lquery</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lsvc0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wntua</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">wntuf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wntvr</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">big</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">epsln</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rtmp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sconda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sfmin</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines (BLAS, LAPACK)</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SGELQF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGEQP3</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGEQRF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGESVD</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLACPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLAPMT</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">SLASCL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLASWP</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SSCAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SPOCON</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SORMLQ</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">SORMQR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions (BLAS, LAPACK)</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ISAMAX</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">SLANGE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SNRM2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLAMCH</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SLANGE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">LSAME</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ISAMAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SNRM2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLAMCH</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">REAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SQRT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Test the input arguments</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">wntus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wntur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wntua</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wntuf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">lsvc0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntua</span><span class="w"></span>
<span class="w">      </span><span class="n">lsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lsvc0</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntuf</span><span class="w"></span>
<span class="w">      </span><span class="n">dntwu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">wntvr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wntva</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wntvr</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntva</span><span class="w"></span>
<span class="w">      </span><span class="n">dntwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">accla</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">acclm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">conda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">acclh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">conda</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">rowprm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobp</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rtrans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobr</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">iminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">iminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">rminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">iminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">iminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">rminwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      </span><span class="n">lquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Liwork</span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">Lwork</span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">Lrwork</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">accla</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">acclm</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">acclh</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rowprm</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobp</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rtrans</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobr</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">dntwu</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">dntwv</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">M</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lda</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldu</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">lsvc0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldu</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">wntuf</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldu</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldv</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">conda</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">14</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Liwork</span><span class="o">&lt;</span><span class="n">iminwrk</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">17</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        .. compute the minimal and the optimal workspace lengths</span>
<span class="c">!        [[The expressions for computing the minimal and the optimal</span>
<span class="c">!        values of LWORK are written with a lot of redundancy and</span>
<span class="c">!        can be simplified. However, this detailed form is easier for</span>
<span class="c">!        maintenance and modifications of the code.]]</span>
<span class="c">!</span>
<span class="c">!        .. minimal workspace length for SGEQP3 of an M x N matrix</span>
<span class="w">         </span><span class="n">lwqp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!        .. minimal workspace length for SORMQR to build left singular vectors</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">lworq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntua</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">lworq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!        .. minimal workspace length for SPOCON of an N x N matrix</span>
<span class="w">         </span><span class="n">lwcon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">N</span><span class="w"></span>
<span class="c">!        .. SGESVD of an N x N matrix</span>
<span class="w">         </span><span class="n">lwsvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            CALL </span><span class="n">SGEQP3</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">lwrk_sgeqp3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_sormqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntua</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_sormqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">lwrk_sormqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">         </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the workspace if</span>
<span class="c">!            only the singular values are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the workspace if the</span>
<span class="c">!            singular values and the left singular vectors are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">,</span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">,</span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">lwrk_sormqr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">,</span><span class="n">lwrk_sormqr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the workspace if the</span>
<span class="c">!            singular values and the right singular vectors are requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwcon</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         ELSE</span><span class="w"></span>
<span class="c">!            .. minimal and optimal sizes of the workspace if the</span>
<span class="c">!            full SVD is requested</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">,</span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!                   .. minimal workspace length for N x N/2 SGEQRF</span>
<span class="w">                  </span><span class="n">lwqrf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!                   .. minimal workspace length for N/2 x N/2 SGESVD</span>
<span class="w">                  </span><span class="n">lwsvd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lworq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwqrf</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvd2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lworq2</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk2</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">minwrk2</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk</span><span class="p">,</span><span class="n">minwrk2</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ELSE</span>
<span class="k">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">lwsvd</span><span class="p">,</span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minwrk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!                   .. minimal workspace length for N/2 x N SGELQF</span>
<span class="w">                  </span><span class="n">lwlqf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwsvd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwunlq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwqp3</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwlqf</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwsvd2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwunlq</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">lworq</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk2</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">minwrk2</span><span class="w"></span>
<span class="w">                  </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">minwrk</span><span class="p">,</span><span class="n">minwrk2</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">,</span><span class="n">lwrk_sormqr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">optwrk</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sgeqrf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sgesvd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sormqr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sgeqrf</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sgesvd2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sormqr2</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk2</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">optwrk2</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk</span><span class="p">,</span><span class="n">optwrk2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ELSE</span>
<span class="k">                  CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">lwrk_sgesvd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">lwrk_sgesvd</span><span class="p">,</span><span class="n">lwrk_sormqr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">optwrk</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGELQF</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sgelqf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sgesvd2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SORMLQ</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">rdummy</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">rdummy</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">lwrk_sormlq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="n">rdummy</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">lwrk_sgeqp3</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sgelqf</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sgesvd2</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">lwrk_sormlq</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk2</span><span class="p">,</span><span class="n">lwcon</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">optwrk2</span><span class="w"></span>
<span class="w">                     </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">optwrk</span><span class="p">,</span><span class="n">optwrk2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">minwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">minwrk</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">optwrk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">optwrk</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">&lt;</span><span class="n">minwrk</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">19</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Lrwork</span><span class="o">&lt;</span><span class="n">rminwrk</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">21</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVDQ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Return optimal workspace</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iminwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minwrk</span><span class="w"></span>
<span class="w">         </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rminwrk</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return if the matrix is void.</span>
<span class="c">!</span>
<span class="c">!     .. all output is void.</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">ascaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="n">iwoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">iwoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="c">!           .. reordering the rows in decreasing sequence in the</span>
<span class="c">!           ell-infinity norm - this enhances numerical robustness in</span>
<span class="c">!           the case of differently scaled rows.</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="c">!               RWORK(p) = ABS( A(p,ICAMAX(N,A(p,1),LDA)) )</span>
<span class="c">!               [[SLANGE will return NaN if an entry of the p-th row is Nan]]</span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLANGE</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">rdummy</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. check for NaN&#39;s and Inf&#39;s</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/=</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">ZERO</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVDQ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">RETURN</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISAMAX</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Rwork</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!              Quick return: A is the M x N zero matrix.</span>
<span class="w">            </span><span class="n">Numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntua</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntva</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">RETURN</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">big</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!               .. to prevent overflow in the QR factorization, scale the</span>
<span class="c">!               matrix by 1/sqrt(M) if too large entry detected</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">ascaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         CALL </span><span class="n">SLASWP</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!    .. At this stage, preemptive scaling is done only to avoid column</span>
<span class="c">!    norms overflows during the QR factorization. The SVD procedure should</span>
<span class="c">!    have its own scaling to save the singular values from overflows and</span>
<span class="c">!    underflows. That depends on the SVD procedure.</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">rowprm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLANGE</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">rdummy</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">rtmp</span><span class="o">/=</span><span class="n">rtmp</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">rtmp</span><span class="o">*</span><span class="n">ZERO</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVDQ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">RETURN</span>
<span class="k">         ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtmp</span><span class="o">&gt;</span><span class="n">big</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!             .. to prevent overflow in the QR factorization, scale the</span>
<span class="c">!             matrix by 1/sqrt(M) if too large entry detected</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">ascaled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. QR factorization with column pivoting</span>
<span class="c">!</span>
<span class="c">!     A * P = Q * [ R ]</span>
<span class="c">!                 [ 0 ]</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!        .. all columns are free columns</span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      CALL </span><span class="n">SGEQP3</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!    If the user requested accuracy level allows truncation in the</span>
<span class="c">!    computed upper triangular factor, the matrix R is examined and,</span>
<span class="c">!    if possible, replaced with its leading upper trapezoidal part.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">epsln</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">sfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!     SMALL = SFMIN / EPSLN</span>
<span class="w">      </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">accla</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Standard absolute error bound suffices. All sigma_i with</span>
<span class="c">!        sigma_i &lt; N*EPS*||A||_F are flushed to zero. This is an</span>
<span class="c">!        aggressive enforcement of lower numerical rank by introducing a</span>
<span class="c">!        backward error of the order of N*EPS*||A||_F.</span>
<span class="w">         </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="p">(</span><span class="n">rtmp</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">acclm</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        .. similarly as above, only slightly more gentle (less aggressive).</span>
<span class="c">!        Sudden drop on the diagonal of R is used as the criterion for being</span>
<span class="c">!        close-to-rank-deficient. The threshold is set to EPSLN=SLAMCH(&#39;E&#39;).</span>
<span class="c">!        [[This can be made more flexible by replacing this hard-coded value</span>
<span class="c">!        with a user specified threshold.]] Also, the values that underflow</span>
<span class="c">!        will be truncated.</span>
<span class="w">         </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="p">(</span><span class="n">epsln</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">&lt;</span><span class="n">sfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!        .. RRQR not authorized to determine numerical rank except in the</span>
<span class="c">!        obvious case of zero pivots.</span>
<span class="c">!        .. inspect R for exact zeros on the diagonal;</span>
<span class="c">!        R(i,i)=0 =&gt; R(i:N,i:N)=0.</span>
<span class="w">         </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">            </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!           Estimate the scaled condition number of A. Use the fact that it is</span>
<span class="c">!           the same as the scaled condition number of R.</span>
<span class="c">!              .. V is used as workspace</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!              Only the leading NR x NR submatrix of the triangular factor</span>
<span class="c">!              is considered. Only if NR=N will this give a reliable error</span>
<span class="c">!              bound. However, even for NR &lt; N, this can be used on an</span>
<span class="c">!              expert level and obtain useful information in the sense of</span>
<span class="c">!              perturbation theory.</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ONE</span><span class="o">/</span><span class="n">rtmp</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rtmp</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">iwoff</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               CALL </span><span class="n">SPOCON</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rtmp</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">iwoff</span><span class="p">),</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">rtmp</span><span class="p">)</span><span class="w"></span>
<span class="c">!           For NR=N, SCONDA is an estimate of SQRT(||(R^* * R)^(-1)||_1),</span>
<span class="c">!           N^(-1/4) * SCONDA &lt;= ||R^(-1)||_2 &lt;= N^(1/4) * SCONDA</span>
<span class="c">!           See the reference [1] for more details.</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntur</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntus</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntua</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!.......................................................................</span>
<span class="c">!        .. only the singular values are requested</span>
<span class="c">!.......................................................................</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!         .. compute the singular values of R**T = [A](1:NR,1:N)**T</span>
<span class="c">!           .. set the lower triangle of [A] to [A](1:NR,1:N)**T and</span>
<span class="c">!           the upper triangle of [A] to zero.</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">A</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">q</span><span class="o">&lt;=</span><span class="n">nr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. compute the singular values of R = [A](1:NR,1:N)</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!.......................................................................</span>
<span class="c">!       .. the singular values and the left singular vectors requested</span>
<span class="c">!.......................................................................&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. apply SGESVD to R**T</span>
<span class="c">!            .. copy R**T into [U] and overwrite [U] with the right singular</span>
<span class="c">!            vectors of R</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!           .. the left singular vectors not computed, the NR right singular</span>
<span class="c">!           vectors overwrite [U](1:NR,1:NR) as transposed. These</span>
<span class="c">!           will be pre-multiplied by Q to build the left singular vectors of A.</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!            .. apply SGESVD to R</span>
<span class="c">!            .. copy R into [U] and overwrite [U] with the left singular vectors</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="c">!            .. the right singular vectors not computed, the NR left singular</span>
<span class="c">!            vectors overwrite [U](1:NR,1:NR)</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. now [U](1:NR,1:NR) contains the NR left singular vectors of</span>
<span class="c">!               R. These will be pre-multiplied by Q to build the left singular</span>
<span class="c">!               vectors of A.</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!              (M x NR) or (M x N) or (M x M).</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           The Q matrix from the first QRF is built into the left singular</span>
<span class="c">!           vectors matrix U.</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="k">CALL </span><span class="n">SLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!.......................................................................</span>
<span class="c">!       .. the singular values and the right singular vectors requested</span>
<span class="c">!.......................................................................</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. apply SGESVD to R**T</span>
<span class="c">!            .. copy R**T into V and overwrite V with the left singular vectors</span>
<span class="w">            </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDDO</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!           .. the left singular vectors of R**T overwrite V, the right singular</span>
<span class="c">!           vectors not computed</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntvr</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">               CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!               .. need all N right singular vectors and NR &lt; N</span>
<span class="c">!               [!] This is simple implementation that augments [V](1:N,1:NR)</span>
<span class="c">!               by padding a zero block. In the case NR &lt;&lt; N, a more efficient</span>
<span class="c">!               way is to first use the QR factorization. For more details</span>
<span class="c">!               how to implement this, see the &quot; FULL SVD &quot; branch.</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!            .. aply SGESVD to R</span>
<span class="c">!            .. copy R into V and overwrite V with the right singular vectors</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!            .. the right singular vectors overwrite V, the NR left singular</span>
<span class="c">!            vectors stored in U(1:NR,1:NR)</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntvr</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. now [V](1:NR,1:N) contains V(1:N,1:NR)**T</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!               .. need all N right singular vectors and NR &lt; N</span>
<span class="c">!               [!] This is simple implementation that augments [V](1:NR,1:N)</span>
<span class="c">!               by padding a zero block. In the case NR &lt;&lt; N, a more efficient</span>
<span class="c">!               way is to first use the LQ factorization. For more details</span>
<span class="c">!               how to implement this, see the &quot; FULL SVD &quot; branch.</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!            .. now [V] contains the transposed matrix of the right singular</span>
<span class="c">!            vectors of A.</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!.......................................................................</span>
<span class="c">!       .. FULL SVD requested</span>
<span class="c">!.......................................................................</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rtrans</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!            .. apply SGESVD to R**T [[this option is left for R&amp;D&amp;T]]</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntvr</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!            .. copy R**T into [V] and overwrite [V] with the left singular</span>
<span class="c">!            vectors of R**T</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. the left singular vectors of R**T overwrite [V], the NR right</span>
<span class="c">!           singular vectors of R**T stored in [U](1:NR,1:NR) as transposed</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. assemble V</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">               CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!               .. need all N right singular vectors and NR &lt; N</span>
<span class="c">!            .. copy R**T into [V] and overwrite [V] with the left singular</span>
<span class="c">!            vectors of R**T</span>
<span class="c">!               [[The optimal ratio N/NR for using QRF instead of padding</span>
<span class="c">!                 with zeros. Here hard coded to 2; it must be at least</span>
<span class="c">!                 two due to work space constraints.]]</span>
<span class="c">!               OPTRATIO = ILAENV(6, &#39;SGESVD&#39;, &#39;S&#39; // &#39;O&#39;, NR,N,0,0)</span>
<span class="c">!               OPTRATIO = MAX( OPTRATIO, 2 )</span>
<span class="w">               </span><span class="n">optratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">optratio</span><span class="o">*</span><span class="n">nr</span><span class="o">&gt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">                  CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!              (M x N1), i.e. (M x N) or (M x M).</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">rtmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtmp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ENDIF</span>
<span class="k">               ELSE</span><span class="w"></span>
<span class="c">!                  .. copy R**T into [U] and overwrite [U] with the right</span>
<span class="c">!                  singular vectors of R</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">U</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGEQRF</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="n">V</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDDO</span>
<span class="k">                  CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                        </span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!                 .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!                 (M x NR) or (M x N) or (M x M).</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!            .. apply SGESVD to R [[this is the recommended option]]</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wntvr</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">==</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!                .. copy R into [V] and overwrite V with the right singular vectors</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. the right singular vectors of R overwrite [V], the NR left</span>
<span class="c">!               singular vectors of R stored in [U](1:NR,1:NR)</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. now [V](1:NR,1:N) contains V(1:N,1:NR)**T</span>
<span class="c">!               .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!              (M x NR) or (M x N) or (M x M).</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!              .. need all N right singular vectors and NR &lt; N</span>
<span class="c">!              .. the requested number of the left singular vectors</span>
<span class="c">!               is then N1 (N or M)</span>
<span class="c">!               [[The optimal ratio N/NR for using LQ instead of padding</span>
<span class="c">!                 with zeros. Here hard coded to 2; it must be at least</span>
<span class="c">!                 two due to work space constraints.]]</span>
<span class="c">!               OPTRATIO = ILAENV(6, &#39;SGESVD&#39;, &#39;S&#39; // &#39;O&#39;, NR,N,0,0)</span>
<span class="c">!               OPTRATIO = MAX( OPTRATIO, 2 )</span>
<span class="w">            </span><span class="n">optratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">optratio</span><span class="o">*</span><span class="n">nr</span><span class="o">&gt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="c">!              .. the right singular vectors of R overwrite [V], the NR left</span>
<span class="c">!                 singular vectors of R stored in [U](1:NR,1:NR)</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!                 .. now [V] contains the transposed matrix of the right</span>
<span class="c">!                 singular vectors of A. The leading N left singular vectors</span>
<span class="c">!                 are in [U](1:N,1:N)</span>
<span class="c">!                 .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!                 (M x N1), i.e. (M x N) or (M x M).</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">            ELSE</span>
<span class="k">               CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">,</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGELQF</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLACPY</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SGESVD</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SORMLQ</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SLAPMT</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Iwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!               .. assemble the left singular vector matrix U of dimensions</span>
<span class="c">!              (M x NR) or (M x N) or (M x M).</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nr</span><span class="o">&lt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">wntuf</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">U</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Ldu</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!        .. end of the &quot;R**T or R&quot; branch</span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           The Q matrix from the first QRF is built into the left singular</span>
<span class="c">!           vectors matrix U.</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SORMQR</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowprm</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">wntuf</span><span class="w"> </span><span class="p">)</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="k">CALL </span><span class="n">SLASWP</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">Ldu</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">Iwork</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ... end of the &quot;full SVD&quot; branch</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Check whether some singular values are returned as zeros, e.g.</span>
<span class="c">!     due to underflow, and update the numerical rank.</span>
<span class="w">      </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">S</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">         </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. if numerical rank deficiency is detected, the truncated</span>
<span class="c">!     singular values are set to zero.</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">S</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!     .. undo scaling; this may cause overflow in the largest singular</span>
<span class="c">!     values.</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ascaled</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="nb">SQRT</span><span class="p">(</span><span class="kt">REAL</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">conda</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sconda</span><span class="w"></span>
<span class="w">      </span><span class="n">Rwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="c">!     .. p-NR is the number of singular values that are computed as</span>
<span class="c">!     exact zeros in SGESVD() applied to the (possibly truncated)</span>
<span class="c">!     full row rank triangular (trapezoidal) factor of A.</span>
<span class="w">      </span><span class="n">Numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!     End of SGESVDQ</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">SGESVDQ</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>