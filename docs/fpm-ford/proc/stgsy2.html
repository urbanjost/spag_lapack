<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>STGSY2 &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>STGSY2
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.2% of total for procedures.">495 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/stgsy2.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/stgsy2.f90.html'>stgsy2.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">STGSY2</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/stgsy2.html#variable-ldz~2">LDZ</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-one~740">ONE</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-zero~712">ZERO</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-alpha~51">alpha</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-i~815">i</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-ie~17">ie</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-ierr~65">ierr</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-ii~48">ii</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-ipiv~2">ipiv</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-is~12">is</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-isp1">isp1</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-j~618">j</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-je~10">je</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-jj~39">jj</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-jpiv~2">jpiv</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-js~5">js</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-jsp1">jsp1</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-k~266">k</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-mb~16">mb</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-nb~156">nb</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-notran~97">notran</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-p~37">p</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-q~24">q</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-rhs~2">rhs</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-scaloc~7">scaloc</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-z~20">z</a>
            <a class="list-group-item" href="../proc/stgsy2.html#variable-zdim">zdim</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/stgsy2.html#src">STGSY2</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine STGSY2(Trans, Ijob, M, N, A, Lda, B, Ldb, C, Ldc, D, Ldd, E, Lde, F, Ldf, Scale, Rdsum, Rdscal, Iwork, Pq, Info)  
</h2>
    

    <p>\brief \b STGSY2 solves the generalized Sylvester equation (unblocked algorithm).
 \htmlonly
 Download STGSY2 + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/stgsy2.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/stgsy2.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/stgsy2.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>STGSY2 solves the generalized Sylvester equation:</p>
<div class="codehilite"><pre><span></span><code>         A * R - L * B = scale * C                (1)
         D * R - L * E = scale * F,
</code></pre></div>

<p>using Level 1 and 2 BLAS. where R and L are unknown M-by-N matrices,
 (A, D), (B, E) and (C, F) are given matrix pairs of size M-by-M,
 N-by-N and M-by-N, respectively, with real entries. (A, D) and (B, E)
 must be in generalized Schur canonical form, i.e. A, B are upper
 quasi triangular and D, E are upper triangular. The solution (R, L)
 overwrites (C, F). 0 &lt;= SCALE &lt;= 1 is an output scaling factor
 chosen to avoid overflow.</p>
<p>In matrix notation solving equation (1) corresponds to solve
 Z<em>x = scale</em>b, where Z is defined as</p>
<div class="codehilite"><pre><span></span><code>    Z = [ kron(In, A)  -kron(B**T, Im) ]             (2)
        [ kron(In, D)  -kron(E**T, Im) ],
</code></pre></div>

<p>Ik is the identity matrix of size k and X**T is the transpose of X.
 kron(X, Y) is the Kronecker product between the matrices X and Y.
 In the process of solving (1), we solve a number of such systems
 where Dim(In), Dim(In) = 1 or 2.</p>
<p>If TRANS = &lsquo;T&rsquo;, solve the transposed system Z<em><em>T</em>y = scale</em>b for y,
 which is equivalent to solve for R and L in</p>
<div class="codehilite"><pre><span></span><code>         A**T * R  + D**T * L   = scale * C           (3)
         R  * B**T + L  * E**T  = scale * -F
</code></pre></div>

<p>This case is used to compute an estimate of Dif[(A, D), (B, E)] =
 sigma_min(Z) using reverse communication with SLACON.</p>
<p>STGSY2 also (IJOB &gt;= 1) contributes to the computation in STGSYL
 of an upper bound on the separation between to matrix pairs. Then
 the input (A, D), (B, E) are sub-pencils of the matrix pair in
 STGSYL. See STGSYL for details.
 \endverbatim
 \param[in] TRANS
 \verbatim
          TRANS is CHARACTER*1
          = &lsquo;N&rsquo;: solve the generalized Sylvester equation (1).
          = &lsquo;T&rsquo;: solve the &lsquo;transposed&rsquo; system (3).
 \endverbatim</p>
<p>\param[in] IJOB
 \verbatim
          IJOB is INTEGER
          Specifies what kind of functionality to be performed.
          = 0: solve (1) only.
          = 1: A contribution from this subsystem to a Frobenius
               norm-based estimate of the separation between two matrix
               pairs is computed. (look ahead strategy is used).
          = 2: A contribution from this subsystem to a Frobenius
               norm-based estimate of the separation between two matrix
               pairs is computed. (SGECON on sub-systems is used.)
          Not referenced if TRANS = &lsquo;T&rsquo;.
 \endverbatim</p>
<p>\param[in] M
 \verbatim
          M is INTEGER
          On entry, M specifies the order of A and D, and the row
          dimension of C, F, R and L.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          On entry, N specifies the order of B and E, and the column
          dimension of C, F, R and L.
 \endverbatim</p>
<p>\param[in] A
 \verbatim
          A is REAL array, dimension (LDA, M)
          On entry, A contains an upper quasi triangular matrix.
 \endverbatim</p>
<p>\param[in] LDA
 \verbatim
          LDA is INTEGER
          The leading dimension of the matrix A. LDA &gt;= max(1, M).
 \endverbatim</p>
<p>\param[in] B
 \verbatim
          B is REAL array, dimension (LDB, N)
          On entry, B contains an upper quasi triangular matrix.
 \endverbatim</p>
<p>\param[in] LDB
 \verbatim
          LDB is INTEGER
          The leading dimension of the matrix B. LDB &gt;= max(1, N).
 \endverbatim</p>
<p>\param[in,out] C
 \verbatim
          C is REAL array, dimension (LDC, N)
          On entry, C contains the right-hand-side of the first matrix
          equation in (1).
          On exit, if IJOB = 0, C has been overwritten by the
          solution R.
 \endverbatim</p>
<p>\param[in] LDC
 \verbatim
          LDC is INTEGER
          The leading dimension of the matrix C. LDC &gt;= max(1, M).
 \endverbatim</p>
<p>\param[in] D
 \verbatim
          D is REAL array, dimension (LDD, M)
          On entry, D contains an upper triangular matrix.
 \endverbatim</p>
<p>\param[in] LDD
 \verbatim
          LDD is INTEGER
          The leading dimension of the matrix D. LDD &gt;= max(1, M).
 \endverbatim</p>
<p>\param[in] E
 \verbatim
          E is REAL array, dimension (LDE, N)
          On entry, E contains an upper triangular matrix.
 \endverbatim</p>
<p>\param[in] LDE
 \verbatim
          LDE is INTEGER
          The leading dimension of the matrix E. LDE &gt;= max(1, N).
 \endverbatim</p>
<p>\param[in,out] F
 \verbatim
          F is REAL array, dimension (LDF, N)
          On entry, F contains the right-hand-side of the second matrix
          equation in (1).
          On exit, if IJOB = 0, F has been overwritten by the
          solution L.
 \endverbatim</p>
<p>\param[in] LDF
 \verbatim
          LDF is INTEGER
          The leading dimension of the matrix F. LDF &gt;= max(1, M).
 \endverbatim</p>
<p>\param[out] SCALE
 \verbatim
          SCALE is REAL
          On exit, 0 &lt;= SCALE &lt;= 1. If 0 &lt; SCALE &lt; 1, the solutions
          R and L (C and F on entry) will hold the solutions to a
          slightly perturbed system but the input matrices A, B, D and
          E have not been changed. If SCALE = 0, R and L will hold the
          solutions to the homogeneous system with C = F = 0. Normally,
          SCALE = 1.
 \endverbatim</p>
<p>\param[in,out] RDSUM
 \verbatim
          RDSUM is REAL
          On entry, the sum of squares of computed contributions to
          the Dif-estimate under computation by STGSYL, where the
          scaling factor RDSCAL (see below) has been factored out.
          On exit, the corresponding sum of squares updated with the
          contributions from the current sub-system.
          If TRANS = &lsquo;T&rsquo; RDSUM is not touched.
          NOTE: RDSUM only makes sense when STGSY2 is called by STGSYL.
 \endverbatim</p>
<p>\param[in,out] RDSCAL
 \verbatim
          RDSCAL is REAL
          On entry, scaling factor used to prevent overflow in RDSUM.
          On exit, RDSCAL is updated w.r.t. the current contributions
          in RDSUM.
          If TRANS = &lsquo;T&rsquo;, RDSCAL is not touched.
          NOTE: RDSCAL only makes sense when STGSY2 is called by
                STGSYL.
 \endverbatim</p>
<p>\param[out] IWORK
 \verbatim
          IWORK is INTEGER array, dimension (M+N+2)
 \endverbatim</p>
<p>\param[out] PQ
 \verbatim
          PQ is INTEGER
          On exit, the number of subsystems (of size 2-by-2, 4-by-4 and
          8-by-8) solved by this routine.
 \endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          On exit, if INFO is set to
            =0: Successful exit
            &lt;0: If INFO = -i, the i-th argument had an illegal value.
            &gt;0: The matrix pairs (A, D) and (B, E) have common or very
                close eigenvalues.
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date December 2016
 \ingroup realSYauxiliary
 \par Contributors:</p>
<div class="codehilite"><pre><span></span><code> Bo Kagstrom and Peter Poromaa, Department of Computing Science,
 Umea University, S-901 87 Umea, Sweden.
</code></pre></div>

<p>&ndash;STGSY2277</p>
<p>&ndash; LAPACK auxiliary routine (version 3.7.0) &ndash;
  &ndash; LAPACK is a software package provided by Univ. of Tennessee,    &ndash;
  &ndash; Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..&ndash;
     December 2016</p>
<div class="codehilite"><pre><span></span><code> .. Scalar Arguments ..
</code></pre></div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-trans~174"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Trans</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ijob~11"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ijob</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~408"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>M</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~1107"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~683"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>A</strong>(Lda,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lda~657"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lda</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b~325"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>B</strong>(Ldb,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldb~312"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldb</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c~154"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>C</strong>(Ldc,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldc~83"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldc</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-d~157"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>D</strong>(Ldd,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldd~4"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldd</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-e~119"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>E</strong>(Lde,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lde~4"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lde</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-f~10"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>F</strong>(Ldf,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldf~5"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldf</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-scale~31"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Scale</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rdsum~5"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Rdsum</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rdscal~5"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Rdscal</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iwork~156"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Iwork</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pq"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Pq</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~858"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-ldz~2"></span>
              integer,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>LDZ</strong></td>
<td> =</td>
                <td>8</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~740"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0E+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~712"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0E+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-alpha~51"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>alpha</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i~815"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ie~17"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ie</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ierr~65"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ierr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ii~48"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ii</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ipiv~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ipiv</strong>(LDZ)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-is~12"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>is</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-isp1"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>isp1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j~618"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-je~10"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>je</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jj~39"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jpiv~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jpiv</strong>(LDZ)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-js~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>js</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jsp1"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jsp1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-k~266"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>k</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mb~16"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mb</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nb~156"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nb</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-notran~97"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>notran</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~37"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~24"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rhs~2"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rhs</strong>(LDZ)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-scaloc~7"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>scaloc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-z~20"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>z</strong>(LDZ,LDZ)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zdim"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>zdim</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">STGSY2</span><span class="p">(</span><span class="n">Trans</span><span class="p">,</span><span class="n">Ijob</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">Ldb</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">Ldc</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">Ldd</span><span class="p">,</span><span class="n">E</span><span class="p">,</span><span class="n">Lde</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Ldf</span><span class="p">,</span><span class="nb">Scale</span><span class="p">,</span><span class="n">Rdsum</span><span class="p">,</span><span class="n">Rdscal</span><span class="p">,</span><span class="n">Iwork</span><span class="p">,</span><span class="n">Pq</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--STGSY2277</span>
<span class="c">!</span>
<span class="c">!  -- LAPACK auxiliary routine (version 3.7.0) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     December 2016</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">CHARACTER </span><span class="n">Trans</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Ijob</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldd</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lde</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">Pq</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">Rdscal</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Rdsum</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">Scale</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Iwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">A</span><span class="p">(</span><span class="n">Lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">(</span><span class="n">Ldb</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">Ldc</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">Ldd</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">(</span><span class="n">Lde</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="n">F</span><span class="p">(</span><span class="n">Ldf</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!  Replaced various illegal calls to SCOPY by calls to SLASET.</span>
<span class="c">!  Sven Hammarling, 27/5/02.</span>
<span class="c">!</span>
<span class="c">!     .. Parameters ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">LDZ</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">LDZ</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0E+0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0E+0</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">notran</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ie</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">isp1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">je</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">js</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jsp1</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">zdim</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">alpha</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">scaloc</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ipiv</span><span class="p">(</span><span class="n">LDZ</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jpiv</span><span class="p">(</span><span class="n">LDZ</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">rhs</span><span class="p">(</span><span class="n">LDZ</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="n">LDZ</span><span class="p">,</span><span class="n">LDZ</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SAXPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SCOPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGEMM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGEMV</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGER</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGESC2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGETC2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">         </span><span class="n">SSCAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLATDF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">MAX</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Decode and test input parameters</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">notran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Trans</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">notran</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">LSAME</span><span class="p">(</span><span class="n">Trans</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">notran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Ijob</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ijob</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">M</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lda</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldb</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldc</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldd</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lde</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">14</span><span class="w"></span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldf</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">16</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;STGSY2&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Determine block structure of A</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Pq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">DO WHILE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">==</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      </span><span class="n">Iwork</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Determine block structure of B</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">DO WHILE</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;=</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">Iwork</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">==</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">B</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      </span><span class="n">Iwork</span><span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">Pq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">notran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Solve (I, J) - subsystem</span>
<span class="c">!           A(I, I) * R(I, J) - L(I, J) * B(J, J) = C(I, J)</span>
<span class="c">!           D(I, I) * R(I, J) - L(I, J) * E(J, J) = F(I, J)</span>
<span class="c">!        for I = P, P - 1, ..., 1; J = 1, 2, ..., Q</span>
<span class="c">!</span>
<span class="w">         </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="n">scaloc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"></span>
<span class="w">            </span><span class="n">js</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">jsp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">js</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">je</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">nb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">je</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">js</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">isp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">ie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">mb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ie</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">zdim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="o">*</span><span class="mi">2</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 2-by-2 system Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ijob</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ELSE</span>
<span class="k">                     CALL </span><span class="n">SLATDF</span><span class="p">(</span><span class="n">Ijob</span><span class="p">,</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">Rdsum</span><span class="p">,</span><span class="n">Rdscal</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">jpiv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 4-by-4 system Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ijob</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ELSE</span>
<span class="k">                     CALL </span><span class="n">SLATDF</span><span class="p">(</span><span class="n">Ijob</span><span class="p">,</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">Rdsum</span><span class="p">,</span><span class="n">Rdscal</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">jpiv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGER</span><span class="p">(</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGER</span><span class="p">(</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 4-by-4 system Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ijob</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ELSE</span>
<span class="k">                     CALL </span><span class="n">SLATDF</span><span class="p">(</span><span class="n">Ijob</span><span class="p">,</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">Rdsum</span><span class="p">,</span><span class="n">Rdscal</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">jpiv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEMV</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMV</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build an 8-by-8 system Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                     </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ijob</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ELSE</span>
<span class="k">                     CALL </span><span class="n">SLATDF</span><span class="p">(</span><span class="n">Ijob</span><span class="p">,</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">Rdsum</span><span class="p">,</span><span class="n">Rdscal</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">jpiv</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                     </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">mb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">is</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="k">is</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">mb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&lt;</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">mb</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">je</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">mb</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">je</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDDO</span>
<span class="k">      ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Solve (I, J) - subsystem</span>
<span class="c">!             A(I, I)**T * R(I, J) + D(I, I)**T * L(J, J)  =  C(I, J)</span>
<span class="c">!             R(I, I)  * B(J, J) + L(I, J)  * E(J, J)  = -F(I, J)</span>
<span class="c">!        for I = 1, 2, ..., P, J = Q, Q - 1, ..., 1</span>
<span class="c">!</span>
<span class="w">         </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="n">scaloc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">isp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">ie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">mb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ie</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">js</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">jsp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">js</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">je</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Iwork</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">je</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">js</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">zdim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="o">*</span><span class="mi">2</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 2-by-2 system Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 4-by-4 system Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build a 4-by-4 system Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Solve Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">C</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">F</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGER</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEMV</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="mi">1</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMV</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="mi">1</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">mb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Build an 8-by-8 system Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">B</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">js</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="k">is</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">isp1</span><span class="p">,</span><span class="n">isp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">js</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">z</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">E</span><span class="p">(</span><span class="n">jsp1</span><span class="p">,</span><span class="n">jsp1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Set up right hand side(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                     </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!                 Solve Z**T * x = RHS</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGETC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ierr</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">SGESC2</span><span class="p">(</span><span class="n">zdim</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">LDZ</span><span class="p">,</span><span class="n">rhs</span><span class="p">,</span><span class="n">ipiv</span><span class="p">,</span><span class="n">jpiv</span><span class="p">,</span><span class="n">scaloc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">scaloc</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">scaloc</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     </span><span class="nb">Scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Scale</span><span class="o">*</span><span class="n">scaloc</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Unpack solution vector(s)</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mb</span><span class="o">*</span><span class="n">nb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span><span class="n">rhs</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="o">+</span><span class="n">jj</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                     </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mb</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Substitute R(I, J) and L(I, J) into remaining</span>
<span class="c">!                 equation.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="n">js</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldf</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">E</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Lde</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldf</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">C</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">SGEMM</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">ie</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">mb</span><span class="p">,</span><span class="o">-</span><span class="n">ONE</span><span class="p">,</span><span class="n">D</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldd</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">F</span><span class="p">(</span><span class="k">is</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldf</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">C</span><span class="p">(</span><span class="n">ie</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">js</span><span class="p">),</span><span class="n">Ldc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     End of STGSY2</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">STGSY2</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>