<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>DLAQR4 &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>DLAQR4
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.1% of total for procedures.">203 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/dlaqr4.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/dlaqr4.f90.html'>dlaqr4.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">DLAQR4</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kexnw~3">KEXNW</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kexsh~3">KEXSH</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ntiny~3">NTINY</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-one~189">ONE</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-wilk1~3">WILK1</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-wilk2~2">WILK2</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-zero~171">ZERO</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-aa~3">aa</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-bb~3">bb</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-cc~3">cc</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-cs~6">cs</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-dd~3">dd</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-i~185">i</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-inf~3">inf</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-it~3">it</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-itmax~3">itmax</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-jbcmpz~3">jbcmpz</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-k~69">k</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kacc22~4">kacc22</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kbot~3">kbot</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kdu~4">kdu</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ks~5">ks</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kt~3">kt</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ktop~3">ktop</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ku~3">ku</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kv~3">kv</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kwh~3">kwh</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kwtop~4">kwtop</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-kwv~3">kwv</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ld~3">ld</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ls~3">ls</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-lwkopt~39">lwkopt</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ndec~3">ndec</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ndfl~3">ndfl</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nh~5">nh</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nho~3">nho</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nibble~3">nibble</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nmin~4">nmin</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ns~5">ns</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nsmax~3">nsmax</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nsr~3">nsr</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nve~3">nve</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nw~8">nw</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nwmax~3">nwmax</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nwr~3">nwr</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-nwupbd~3">nwupbd</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-sn~8">sn</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-sorted~3">sorted</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-ss~3">ss</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-swap~4">swap</a>
            <a class="list-group-item" href="../proc/dlaqr4.html#variable-zdum~22">zdum</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/dlaqr4.html#src">DLAQR4</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine DLAQR4(Wantt, Wantz, N, Ilo, Ihi, H, Ldh, Wr, Wi, Iloz, Ihiz, Z, Ldz, Work, Lwork, Info)  
</h2>
    

    <p>\brief \b DLAQR4 computes the eigenvalues of a Hessenberg matrix, and optionally the matrices from the Schur decomposition.
 \htmlonly
 Download DLAQR4 + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/dlaqr4.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/dlaqr4.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/dlaqr4.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<div class="codehilite"><pre><span></span><code><span class="nv">DLAQR4</span> <span class="nv">implements</span> <span class="nv">one</span> <span class="nv">level</span> <span class="nv">of</span> <span class="nv">recursion</span> <span class="k">for</span> <span class="nv">DLAQR0</span>.
<span class="nv">It</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">complete</span> <span class="nv">implementation</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">small</span> <span class="nv">bulge</span> <span class="nv">multi</span><span class="o">-</span><span class="nv">shift</span>
<span class="nv">QR</span> <span class="nv">algorithm</span>.  <span class="nv">It</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">called</span> <span class="nv">by</span> <span class="nv">DLAQR0</span> <span class="nv">and</span>, <span class="k">for</span> <span class="nv">large</span> <span class="nv">enough</span>
<span class="nv">deflation</span> <span class="nv">window</span> <span class="nv">size</span>, <span class="nv">it</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">called</span> <span class="nv">by</span> <span class="nv">DLAQR3</span>.  <span class="nv">This</span>
<span class="nv">subroutine</span> <span class="nv">is</span> <span class="nv">identical</span> <span class="nv">to</span> <span class="nv">DLAQR0</span> <span class="nv">except</span> <span class="nv">that</span> <span class="nv">it</span> <span class="nv">calls</span> <span class="nv">DLAQR2</span>
<span class="nv">instead</span> <span class="nv">of</span> <span class="nv">DLAQR3</span>.

<span class="nv">DLAQR4</span> <span class="nv">computes</span> <span class="nv">the</span> <span class="nv">eigenvalues</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">Hessenberg</span> <span class="nv">matrix</span> <span class="nv">H</span>
<span class="nv">and</span>, <span class="nv">optionally</span>, <span class="nv">the</span> <span class="nv">matrices</span> <span class="nv">T</span> <span class="nv">and</span> <span class="nv">Z</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">Schur</span> <span class="nv">decomposition</span>
<span class="nv">H</span> <span class="o">=</span> <span class="nv">Z</span> <span class="nv">T</span> <span class="nv">Z</span><span class="o">**</span><span class="nv">T</span>, <span class="nv">where</span> <span class="nv">T</span> <span class="nv">is</span> <span class="nv">an</span> <span class="nv">upper</span> <span class="nv">quasi</span><span class="o">-</span><span class="nv">triangular</span> <span class="nv">matrix</span> <span class="ss">(</span><span class="nv">the</span>
<span class="nv">Schur</span> <span class="nv">form</span><span class="ss">)</span>, <span class="nv">and</span> <span class="nv">Z</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">orthogonal</span> <span class="nv">matrix</span> <span class="nv">of</span> <span class="nv">Schur</span> <span class="nv">vectors</span>.

<span class="nv">Optionally</span> <span class="nv">Z</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">postmultiplied</span> <span class="nv">into</span> <span class="nv">an</span> <span class="nv">input</span> <span class="nv">orthogonal</span>
<span class="nv">matrix</span> <span class="nv">Q</span> <span class="nv">so</span> <span class="nv">that</span> <span class="nv">this</span> <span class="nv">routine</span> <span class="nv">can</span> <span class="nv">give</span> <span class="nv">the</span> <span class="nv">Schur</span> <span class="nv">factorization</span>
<span class="nv">of</span> <span class="nv">a</span> <span class="nv">matrix</span> <span class="nv">A</span> <span class="nv">which</span> <span class="nv">has</span> <span class="nv">been</span> <span class="nv">reduced</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">Hessenberg</span> <span class="nv">form</span> <span class="nv">H</span>
<span class="nv">by</span> <span class="nv">the</span> <span class="nv">orthogonal</span> <span class="nv">matrix</span> <span class="nv">Q</span>:  <span class="nv">A</span> <span class="o">=</span> <span class="nv">Q</span><span class="o">*</span><span class="nv">H</span><span class="o">*</span><span class="nv">Q</span><span class="o">**</span><span class="nv">T</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">QZ</span><span class="ss">)</span><span class="o">*</span><span class="nv">T</span><span class="o">*</span><span class="ss">(</span><span class="nv">QZ</span><span class="ss">)</span><span class="o">**</span><span class="nv">T</span>.
</code></pre></div>

<p>\endverbatim
 \param[in] WANTT
 \verbatim
          WANTT is LOGICAL
          = .TRUE. : the full Schur form T is required;
          = .FALSE.: only eigenvalues are required.
 \endverbatim</p>
<p>\param[in] WANTZ
 \verbatim
          WANTZ is LOGICAL
          = .TRUE. : the matrix of Schur vectors Z is required;
          = .FALSE.: Schur vectors are not required.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
           The order of the matrix H.  N &gt;= 0.
 \endverbatim</p>
<p>\param[in] ILO
 \verbatim
          ILO is INTEGER
 \endverbatim</p>
<p>\param[in] IHI
 \verbatim
          IHI is INTEGER
           It is assumed that H is already upper triangular in rows
           and columns 1:ILO-1 and IHI+1:N and, if ILO &gt; 1,
           H(ILO,ILO-1) is zero. ILO and IHI are normally set by a
           previous call to DGEBAL, and then passed to DGEHRD when the
           matrix output by DGEBAL is reduced to Hessenberg form.
           Otherwise, ILO and IHI should be set to 1 and N,
           respectively.  If N &gt; 0, then 1 &lt;= ILO &lt;= IHI &lt;= N.
           If N = 0, then ILO = 1 and IHI = 0.
 \endverbatim</p>
<p>\param[in,out] H
 \verbatim
          H is DOUBLE PRECISION array, dimension (LDH,N)
           On entry, the upper Hessenberg matrix H.
           On exit, if INFO = 0 and WANTT is .TRUE., then H contains
           the upper quasi-triangular matrix T from the Schur
           decomposition (the Schur form); 2-by-2 diagonal blocks
           (corresponding to complex conjugate pairs of eigenvalues)
           are returned in standard form, with H(i,i) = H(i+1,i+1)
           and H(i+1,i)*H(i,i+1) &lt; 0. If INFO = 0 and WANTT is
           .FALSE., then the contents of H are unspecified on exit.
           (The output value of H when INFO &gt; 0 is given under the
           description of INFO below.)</p>
<div class="codehilite"><pre><span></span><code>       <span class="nv">This</span> <span class="nv">subroutine</span> <span class="nv">may</span> <span class="nv">explicitly</span> <span class="nv">set</span> <span class="nv">H</span><span class="ss">(</span><span class="nv">i</span>,<span class="nv">j</span><span class="ss">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="nv">i</span> <span class="o">&gt;</span> <span class="nv">j</span> <span class="nv">and</span>
       <span class="nv">j</span> <span class="o">=</span> <span class="mi">1</span>, <span class="mi">2</span>, ... <span class="nv">ILO</span><span class="o">-</span><span class="mi">1</span> <span class="nv">or</span> <span class="nv">j</span> <span class="o">=</span> <span class="nv">IHI</span><span class="o">+</span><span class="mi">1</span>, <span class="nv">IHI</span><span class="o">+</span><span class="mi">2</span>, ... <span class="nv">N</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] LDH
 \verbatim
          LDH is INTEGER
           The leading dimension of the array H. LDH &gt;= max(1,N).
 \endverbatim</p>
<p>\param[out] WR
 \verbatim
          WR is DOUBLE PRECISION array, dimension (IHI)
 \endverbatim</p>
<p>\param[out] WI
 \verbatim
          WI is DOUBLE PRECISION array, dimension (IHI)
           The real and imaginary parts, respectively, of the computed
           eigenvalues of H(ILO:IHI,ILO:IHI) are stored in WR(ILO:IHI)
           and WI(ILO:IHI). If two eigenvalues are computed as a
           complex conjugate pair, they are stored in consecutive
           elements of WR and WI, say the i-th and (i+1)th, with
           WI(i) &gt; 0 and WI(i+1) &lt; 0. If WANTT is .TRUE., then
           the eigenvalues are stored in the same order as on the
           diagonal of the Schur form returned in H, with
           WR(i) = H(i,i) and, if H(i:i+1,i:i+1) is a 2-by-2 diagonal
           block, WI(i) = sqrt(-H(i+1,i)*H(i,i+1)) and
           WI(i+1) = -WI(i).
 \endverbatim</p>
<p>\param[in] ILOZ
 \verbatim
          ILOZ is INTEGER
 \endverbatim</p>
<p>\param[in] IHIZ
 \verbatim
          IHIZ is INTEGER
           Specify the rows of Z to which transformations must be
           applied if WANTZ is .TRUE..
           1 &lt;= ILOZ &lt;= ILO; IHI &lt;= IHIZ &lt;= N.
 \endverbatim</p>
<p>\param[in,out] Z
 \verbatim
          Z is DOUBLE PRECISION array, dimension (LDZ,IHI)
           If WANTZ is .FALSE., then Z is not referenced.
           If WANTZ is .TRUE., then Z(ILO:IHI,ILOZ:IHIZ) is
           replaced by Z(ILO:IHI,ILOZ:IHIZ)*U where U is the
           orthogonal Schur factor of H(ILO:IHI,ILO:IHI).
           (The output value of Z when INFO &gt; 0 is given under
           the description of INFO below.)
 \endverbatim</p>
<p>\param[in] LDZ
 \verbatim
          LDZ is INTEGER
           The leading dimension of the array Z.  if WANTZ is .TRUE.
           then LDZ &gt;= MAX(1,IHIZ).  Otherwise, LDZ &gt;= 1.
 \endverbatim</p>
<p>\param[out] WORK
 \verbatim
          WORK is DOUBLE PRECISION array, dimension LWORK
           On exit, if LWORK = -1, WORK(1) returns an estimate of
           the optimal value for LWORK.
 \endverbatim</p>
<p>\param[in] LWORK
 \verbatim
          LWORK is INTEGER
           The dimension of the array WORK.  LWORK &gt;= max(1,N)
           is sufficient, but LWORK typically as large as 6*N may
           be required for optimal performance.  A workspace query
           to determine the optimal workspace size is recommended.</p>
<div class="codehilite"><pre><span></span><code>       <span class="k">If</span> <span class="nv">LWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">DLAQR4</span> <span class="nv">does</span> <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span>.
       <span class="nv">In</span> <span class="nv">this</span> <span class="nv">case</span>, <span class="nv">DLAQR4</span> <span class="nv">checks</span> <span class="nv">the</span> <span class="nv">input</span> <span class="nv">parameters</span> <span class="nv">and</span>
       <span class="nv">estimates</span> <span class="nv">the</span> <span class="nv">optimal</span> <span class="nv">workspace</span> <span class="nv">size</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">given</span>
       <span class="nv">values</span> <span class="nv">of</span> <span class="nv">N</span>, <span class="nv">ILO</span> <span class="nv">and</span> <span class="nv">IHI</span>.  <span class="nv">The</span> <span class="nv">estimate</span> <span class="nv">is</span> <span class="nv">returned</span>
       <span class="nv">in</span> <span class="nv">WORK</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>.  <span class="nv">No</span> <span class="nv">error</span> <span class="nv">message</span> <span class="nv">related</span> <span class="nv">to</span> <span class="nv">LWORK</span> <span class="nv">is</span>
       <span class="nv">issued</span> <span class="nv">by</span> <span class="nv">XERBLA</span>.  <span class="nv">Neither</span> <span class="nv">H</span> <span class="nv">nor</span> <span class="nv">Z</span> <span class="nv">are</span> <span class="nv">accessed</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
             = 0:  successful exit
             &gt; 0:  if INFO = i, DLAQR4 failed to compute all of
                the eigenvalues.  Elements 1:ilo-1 and i+1:n of WR
                and WI contain those eigenvalues which have been
                successfully computed.  (Failures are rare.)</p>
<div class="codehilite"><pre><span></span><code><span class="w">            </span><span class="n">If</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">WANT</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">exit</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">the</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">unconverged</span><span class="w"> </span><span class="n">eigenvalues</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">eigen</span><span class="o">-</span><span class="w"></span>
<span class="w">            </span><span class="n">values</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="n">Hessenberg</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="k">and</span><span class="w"></span>
<span class="w">            </span><span class="n">columns</span><span class="w"> </span><span class="n">ILO</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">final</span><span class="p">,</span><span class="w"> </span><span class="k">output</span><span class="w"></span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">H</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">If</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">WANTT</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">exit</span><span class="w"></span>

<span class="w">       </span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">  </span><span class="p">(</span><span class="k">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">U</span><span class="o">*</span><span class="p">(</span><span class="k">final</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">H</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">where</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">orthogonal</span><span class="w"> </span><span class="n">matrix</span><span class="p">.</span><span class="w">  </span><span class="n">The</span><span class="w"> </span><span class="k">final</span><span class="w"></span>
<span class="w">            </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w">  </span><span class="n">H</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="n">Hessenberg</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">triangular</span><span class="w"> </span><span class="n">in</span><span class="w"></span>
<span class="w">            </span><span class="n">rows</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="n">INFO</span><span class="o">+</span><span class="mh">1</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">IHI</span><span class="p">.</span><span class="w"></span>

<span class="w">            </span><span class="n">If</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">WANTZ</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">exit</span><span class="w"></span>

<span class="w">              </span><span class="p">(</span><span class="k">final</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="nl">ILO:</span><span class="n">IHI</span><span class="p">,</span><span class="nl">ILOZ:</span><span class="n">IHIZ</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="o">=</span><span class="w">  </span><span class="p">(</span><span class="k">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="nl">ILO:</span><span class="n">IHI</span><span class="p">,</span><span class="nl">ILOZ:</span><span class="n">IHIZ</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="w"></span>

<span class="w">            </span><span class="n">where</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">orthogonal</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">regard</span><span class="o">-</span><span class="w"></span>
<span class="w">            </span><span class="n">less</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">WANTT</span><span class="p">.)</span><span class="w"></span>

<span class="w">            </span><span class="n">If</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">WANTZ</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.,</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">not</span><span class="w"></span>
<span class="w">            </span><span class="n">accessed</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<p>\endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date December 2016
 \ingroup doubleOTHERauxiliary
 \par Contributors:</p>
<div class="codehilite"><pre><span></span><code>   Karen Braman and Ralph Byers, Department of Mathematics,
   University of Kansas, USA
</code></pre></div>

<p>\par References:</p>
<div class="codehilite"><pre><span></span><code>   K. Braman, R. Byers and R. Mathias, The Multi-Shift QR
   Algorithm Part I: Maintaining Well Focused Shifts, and Level 3
   Performance, SIAM Journal of Matrix Analysis, volume 23, pages
   929--947, 2002.
</code></pre></div>

<p>\n
       K. Braman, R. Byers and R. Mathias, The Multi-Shift QR
       Algorithm Part II: Aggressive Early Deflation, SIAM Journal
       of Matrix Analysis, volume 23, pages 948&ndash;973, 2002.</p>
<p>&ndash;DLAQR4267</p>
<p>&ndash; LAPACK auxiliary routine (version 3.7.0) &ndash;
  &ndash; LAPACK is a software package provided by Univ. of Tennessee,    &ndash;
  &ndash; Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..&ndash;
     December 2016</p>
<div class="codehilite"><pre><span></span><code> .. Scalar Arguments ..
</code></pre></div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-wantt~5"></span>
              logical
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Wantt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wantz~7"></span>
              logical
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Wantz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~271"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilo~10"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ilo</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ihi~10"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ihi</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-h~8"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>H</strong>(Ldh,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldh~8"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldh</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wr~6"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Wr</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wi~7"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Wi</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iloz~5"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Iloz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ihiz~5"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ihiz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-z~36"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Z</strong>(Ldz,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldz~27"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~168"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~86"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~228"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-kexnw~3"></span>
              integer,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>KEXNW</strong></td>
<td> =</td>
                <td>5</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kexsh~3"></span>
              integer,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>KEXSH</strong></td>
<td> =</td>
                <td>6</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ntiny~3"></span>
              integer,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>NTINY</strong></td>
<td> =</td>
                <td>15</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~189"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wilk1~3"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>WILK1</strong></td>
<td> =</td>
                <td>0.75D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wilk2~2"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>WILK2</strong></td>
<td> =</td>
                <td>-0.4375D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~171"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0D0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aa~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aa</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bb~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bb</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cc~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cs~6"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cs</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-dd~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>dd</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i~185"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-inf~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>inf</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-it~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>it</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-itmax~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>itmax</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jbcmpz~3"></span>
              character(len=1),
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jbcmpz</strong>*2</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-k~69"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>k</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kacc22~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kacc22</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kbot~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kbot</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kdu~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kdu</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ks~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ks</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kt~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kt</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ktop~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ktop</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ku~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ku</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kv~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kwh~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kwh</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kwtop~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kwtop</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kwv~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kwv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ld~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ld</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ls~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ls</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwkopt~39"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lwkopt</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ndec~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ndec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ndfl~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ndfl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nh~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nh</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nho~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nho</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nibble~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nibble</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nmin~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ns~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ns</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nsmax~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nsmax</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nsr~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nsr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nve~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nve</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nw~8"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nw</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nwmax~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nwmax</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nwr~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nwr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nwupbd~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nwupbd</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sn~8"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sn</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sorted~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sorted</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ss~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ss</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-swap~4"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>swap</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zdum~22"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>zdum</strong>(1,1)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">DLAQR4</span><span class="p">(</span><span class="n">Wantt</span><span class="p">,</span><span class="n">Wantz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Wr</span><span class="p">,</span><span class="n">Wi</span><span class="p">,</span><span class="n">Iloz</span><span class="p">,</span><span class="n">Ihiz</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Ldz</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--DLAQR4267</span>
<span class="c">!</span>
<span class="c">!  -- LAPACK auxiliary routine (version 3.7.0) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     December 2016</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Ihi</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ihiz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ilo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Iloz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">Wantt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Wantz</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">H</span><span class="p">(</span><span class="n">Ldh</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="n">Ldz</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  ================================================================</span>
<span class="c">!     .. Parameters ..</span>
<span class="c">!</span>
<span class="c">!     ==== Matrices of order NTINY or smaller must be processed by</span>
<span class="c">!     .    DLAHQR because of insufficient subdiagonal scratch space.</span>
<span class="c">!     .    (This is a hard limit.) ====</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">NTINY</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">NTINY</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== Exceptional deflation windows:  try to cure rare</span>
<span class="c">!     .    slow convergence by varying the size of the</span>
<span class="c">!     .    deflation window after KEXNW iterations. ====</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">KEXNW</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">KEXNW</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== Exceptional shifts: try to cure rare slow convergence</span>
<span class="c">!     .    with ad-hoc exceptional shifts every KEXSH iterations.</span>
<span class="c">!     .    ====</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">KEXSH</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">KEXSH</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== The constants WILK1 and WILK2 are used to form the</span>
<span class="c">!     .    exceptional shifts. ====</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">WILK1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">WILK2</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">WILK1</span><span class="o">=</span><span class="mf">0.75D0</span><span class="p">,</span><span class="n">WILK2</span><span class="o">=-</span><span class="mf">0.4375D0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0D0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0D0</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">aa</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cs</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">swap</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">inf</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">itmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kacc22</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kt</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ktop</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ku</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kwh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kwtop</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kwv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ld</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lwkopt</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ndec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ndfl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nho</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nibble</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nsmax</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">nsr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nve</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nwmax</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nwupbd</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">sorted</span><span class="w"></span>
<span class="w">      </span><span class="kt">CHARACTER </span><span class="n">jbcmpz</span><span class="o">*</span><span class="mi">2</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ILAENV</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">ILAENV</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">zdum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">DLACPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAHQR</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLANV2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAQR2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAQR5</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">DBLE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MOD</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== Quick return for N = 0: nothing to do. ====</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;=</span><span class="n">NTINY</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Tiny matrices must use DLAHQR. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">lwkopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">/=-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DLAHQR</span><span class="p">(</span><span class="n">Wantt</span><span class="p">,</span><span class="n">Wantz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Wr</span><span class="p">,</span><span class="n">Wi</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="n">Iloz</span><span class="p">,</span><span class="n">Ihiz</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Ldz</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Use small bulge multi-shift QR with aggressive early</span>
<span class="c">!        .    deflation on larger-than-tiny matrices. ====</span>
<span class="c">!</span>
<span class="c">!        ==== Hope for the best. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Set up job flags for ILAENV. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Wantt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">jbcmpz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">jbcmpz</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Wantz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">jbcmpz</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">jbcmpz</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== NWR = recommended deflation window size.  At this</span>
<span class="c">!        .    point,  N .GT. NTINY = 15, so there is enough</span>
<span class="c">!        .    subdiagonal workspace for NWR.GE.2 as required.</span>
<span class="c">!        .    (In fact, there is enough subdiagonal space for</span>
<span class="c">!        .    NWR.GE.4.) ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ILAENV</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="n">jbcmpz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nwr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">Ihi</span><span class="o">-</span><span class="n">Ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">nwr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== NSR = recommended number of simultaneous shifts.</span>
<span class="c">!        .    At this point N .GT. NTINY = 15, so there is at</span>
<span class="c">!        .    enough subdiagonal workspace for NSR to be even</span>
<span class="c">!        .    and greater than or equal to two as required. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ILAENV</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="n">jbcmpz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">nsr</span><span class="p">,(</span><span class="n">N</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="n">Ihi</span><span class="o">-</span><span class="n">Ilo</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nsr</span><span class="o">-</span><span class="nb">MOD</span><span class="p">(</span><span class="n">nsr</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Estimate optimal workspace ====</span>
<span class="c">!</span>
<span class="c">!        ==== Workspace query call to DLAQR2 ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">CALL </span><span class="n">DLAQR2</span><span class="p">(</span><span class="n">Wantt</span><span class="p">,</span><span class="n">Wantz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">nwr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Iloz</span><span class="p">,</span><span class="n">Ihiz</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Ldz</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">               </span><span class="n">ls</span><span class="p">,</span><span class="n">ld</span><span class="p">,</span><span class="n">Wr</span><span class="p">,</span><span class="n">Wi</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Optimal workspace = MAX(DLAQR5, DLAQR2) ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">lwkopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nsr</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nb">INT</span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Quick return in case of workspace query. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">lwkopt</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">RETURN</span>
<span class="k">         ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== DLAHQR/DLAQR0 crossover point ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ILAENV</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="n">jbcmpz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">NTINY</span><span class="p">,</span><span class="n">nmin</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Nibble crossover point ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nibble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ILAENV</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="n">jbcmpz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nibble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nibble</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Accumulate reflections during ttswp?  Use block</span>
<span class="c">!        .    2-by-2 structure during matrix-matrix multiply? ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ILAENV</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="n">jbcmpz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">kacc22</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">kacc22</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== NWMAX = the largest possible deflation window for</span>
<span class="c">!        .    which there is sufficient workspace. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nwmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">((</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">Lwork</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nwmax</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== NSMAX = the Largest number of simultaneous shifts</span>
<span class="c">!        .    for which there is sufficient workspace. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">nsmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">((</span><span class="n">N</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Lwork</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">nsmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">nsmax</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== NDFL: an iteration count restarted at deflation. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== ITMAX = iteration limit ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">itmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">KEXSH</span><span class="p">)</span><span class="o">*</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">10</span><span class="p">,(</span><span class="n">Ihi</span><span class="o">-</span><span class="n">Ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Last row and column in the active block ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">kbot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ihi</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Main Loop ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">itmax</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Done when KBOT falls below ILO ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">&lt;</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Locate active block ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ilo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">            </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ilo</span><span class="w"></span>
<span class="w"> </span><span class="mi">20</span><span class="w">         </span><span class="n">ktop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Select deflation window size:</span>
<span class="c">!           .    Typical Case:</span>
<span class="c">!           .      If possible and advisable, nibble the entire</span>
<span class="c">!           .      active block.  If not, use size MIN(NWR,NWMAX)</span>
<span class="c">!           .      or MIN(NWR+1,NWMAX) depending upon which has</span>
<span class="c">!           .      the smaller corresponding subdiagonal entry</span>
<span class="c">!           .      (a heuristic).</span>
<span class="c">!           .</span>
<span class="c">!           .    Exceptional Case:</span>
<span class="c">!           .      If there have been no deflations in KEXNW or</span>
<span class="c">!           .      more iterations, then vary the deflation window</span>
<span class="c">!           .      size.   At first, because, larger windows are,</span>
<span class="c">!           .      in general, more powerful than smaller ones,</span>
<span class="c">!           .      rapidly increase the window to the maximum possible.</span>
<span class="c">!           .      Then, gradually reduce the window size. ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">nh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ktop</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">nwupbd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">nh</span><span class="p">,</span><span class="n">nwmax</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ndfl</span><span class="o">&lt;</span><span class="n">KEXNW</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">nwupbd</span><span class="p">,</span><span class="n">nwr</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">nwupbd</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">&lt;</span><span class="n">nwmax</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">&gt;=</span><span class="n">nh</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">kwtop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">kwtop</span><span class="p">,</span><span class="n">kwtop</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">kwtop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kwtop</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ndfl</span><span class="o">&lt;</span><span class="n">KEXNW</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ndec</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">nw</span><span class="o">&gt;=</span><span class="n">nwupbd</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndec</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">-</span><span class="n">ndec</span><span class="o">&lt;</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">               </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ndec</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Aggressive early deflation:</span>
<span class="c">!           .    split workspace under the subdiagonal into</span>
<span class="c">!           .      - an nw-by-nw work array V in the lower</span>
<span class="c">!           .        left-hand-corner,</span>
<span class="c">!           .      - an NW-by-at-least-NW-but-more-is-better</span>
<span class="c">!           .        (NW-by-NHO) horizontal work array along</span>
<span class="c">!           .        the bottom edge,</span>
<span class="c">!           .      - an at-least-NW-but-more-is-better (NHV-by-NW)</span>
<span class="c">!           .        vertical work array along the left-hand-edge.</span>
<span class="c">!           .        ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">kt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">nho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">nw</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">kwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">            </span><span class="n">nve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">nw</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kwv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Aggressive early deflation ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">DLAQR2</span><span class="p">(</span><span class="n">Wantt</span><span class="p">,</span><span class="n">Wantz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ktop</span><span class="p">,</span><span class="n">kbot</span><span class="p">,</span><span class="n">nw</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Iloz</span><span class="p">,</span><span class="n">Ihiz</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Ldz</span><span class="p">,</span><span class="n">ls</span><span class="p">,</span><span class="n">ld</span><span class="p">,</span><span class="n">Wr</span><span class="p">,</span><span class="n">Wi</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kv</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">nho</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kv</span><span class="p">,</span><span class="n">kt</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">nve</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kwv</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Adjust KBOT accounting for new deflations. ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">kbot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ld</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== KS points to the shifts. ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Skip an expensive QR sweep if there is a (partly</span>
<span class="c">!           .    heuristic) reason to expect that many eigenvalues</span>
<span class="c">!           .    will deflate without it.  Here, the QR sweep is</span>
<span class="c">!           .    skipped if many eigenvalues have just been deflated</span>
<span class="c">!           .    or if the remaining active block is small.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">ld</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">                                           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">((</span><span class="mi">100</span><span class="o">*</span><span class="n">ld</span><span class="o">&lt;=</span><span class="n">nw</span><span class="o">*</span><span class="n">nibble</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="n">ktop</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;</span><span class="nb">MIN</span><span class="p">(</span><span class="n">nmin</span><span class="p">,</span><span class="n">nwmax</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== NS = nominal number of simultaneous shifts.</span>
<span class="c">!              .    This may be lowered (slightly) if DLAQR2</span>
<span class="c">!              .    did not provide that many shifts. ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">nsmax</span><span class="p">,</span><span class="n">nsr</span><span class="p">,</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">kbot</span><span class="o">-</span><span class="n">ktop</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== If there have been no deflations</span>
<span class="c">!              .    in a multiple of KEXSH iterations,</span>
<span class="c">!              .    then try exceptional shifts.</span>
<span class="c">!              .    Otherwise use shifts provided by</span>
<span class="c">!              .    DLAQR2 above or from the eigenvalues</span>
<span class="c">!              .    of a trailing principal submatrix. ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">ndfl</span><span class="p">,</span><span class="n">KEXSH</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ktop</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">                     </span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WILK1</span><span class="o">*</span><span class="n">ss</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ss</span><span class="w"></span>
<span class="w">                     </span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WILK2</span><span class="o">*</span><span class="n">ss</span><span class="w"></span>
<span class="w">                     </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLANV2</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">,</span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">cs</span><span class="p">,</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">==</span><span class="n">ktop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">Wr</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Wi</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                     </span><span class="n">Wr</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Wi</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span>
<span class="k">               ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 ==== Got NS/2 or fewer shifts? Use DLAHQR</span>
<span class="c">!                 .    on a trailing principal submatrix to</span>
<span class="c">!                 .    get more. (Since NS.LE.NSMAX.LE.(N+6)/9,</span>
<span class="c">!                 .    there is enough space below the subdiagonal</span>
<span class="c">!                 .    to fit an NS-by-NS scratch array.) ====</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;=</span><span class="n">ns</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">kt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLACPY</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span><span class="n">ks</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kt</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLAHQR</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.,.</span><span class="n">FALSE</span><span class="p">.,</span><span class="n">ns</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kt</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">Wr</span><span class="p">(</span><span class="n">ks</span><span class="p">),</span><span class="n">Wi</span><span class="p">(</span><span class="n">ks</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">zdum</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">inf</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">inf</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                    ==== In case of a rare QR failure use</span>
<span class="c">!                    .    eigenvalues of the trailing 2-by-2</span>
<span class="c">!                    .    principal submatrix.  ====</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">&gt;=</span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="p">,</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">kbot</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="p">,</span><span class="n">kbot</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DLANV2</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">,</span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Wi</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="p">),</span><span class="n">Wi</span><span class="p">(</span><span class="n">kbot</span><span class="p">),</span><span class="n">cs</span><span class="p">,</span><span class="n">sn</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;</span><span class="n">ns</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                    ==== Sort the shifts (Helps a little)</span>
<span class="c">!                    .    Bubble sort keeps complex conjugate</span>
<span class="c">!                    .    pairs together. ====</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                     </span><span class="k">DO </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">EXIT</span>
<span class="k">                        </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">                        </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">&lt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ENDDO</span>
<span class="k">                     ENDDO</span>
<span class="k">                  ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 ==== Shuffle shifts into pairs of real shifts</span>
<span class="c">!                 .    and pairs of complex conjugate shifts</span>
<span class="c">!                 .    assuming complex conjugate shifts are</span>
<span class="c">!                 .    already adjacent to one another. (Yes,</span>
<span class="c">!                 .    they are.)  ====</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/=-</span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wr</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Wi</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ENDDO</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== If there are only two shifts and both are</span>
<span class="c">!              .    real, then use only one.  ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">==</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Wi</span><span class="p">(</span><span class="n">kbot</span><span class="p">)</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="p">)</span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="p">,</span><span class="n">kbot</span><span class="p">))</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="o">&lt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">kbot</span><span class="p">,</span><span class="n">kbot</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ELSE</span>
<span class="k">                        </span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wr</span><span class="p">(</span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                  ENDIF</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== Use up to NS of the the smallest magnitude</span>
<span class="c">!              .    shifts.  If there aren&#39;t NS shifts available,</span>
<span class="c">!              .    then use them all, possibly dropping one to</span>
<span class="c">!              .    make the number of shifts even. ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">MOD</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== Small-bulge multi-shift QR sweep:</span>
<span class="c">!              .    split workspace under the subdiagonal into</span>
<span class="c">!              .    - a KDU-by-KDU work array U in the lower</span>
<span class="c">!              .      left-hand-corner,</span>
<span class="c">!              .    - a KDU-by-at-least-KDU-but-more-is-better</span>
<span class="c">!              .      (KDU-by-NHo) horizontal work array WH along</span>
<span class="c">!              .      the bottom edge,</span>
<span class="c">!              .    - and an at-least-KDU-but-more-is-better-by-KDU</span>
<span class="c">!              .      (NVE-by-KDU) vertical work WV arrow along</span>
<span class="c">!              .      the left-hand-edge. ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">kdu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">ns</span><span class="w"></span>
<span class="w">               </span><span class="n">ku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">kwh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">nho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">kdu</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">kdu</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">kwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">               </span><span class="n">nve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kwv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              ==== Small-bulge multi-shift QR sweep ====</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">DLAQR5</span><span class="p">(</span><span class="n">Wantt</span><span class="p">,</span><span class="n">Wantz</span><span class="p">,</span><span class="n">kacc22</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ktop</span><span class="p">,</span><span class="n">kbot</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">Wr</span><span class="p">(</span><span class="n">ks</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Wi</span><span class="p">(</span><span class="n">ks</span><span class="p">),</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Iloz</span><span class="p">,</span><span class="n">Ihiz</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Ldz</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ku</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                     </span><span class="n">Ldh</span><span class="p">,</span><span class="n">nve</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">kwv</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">nho</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ku</span><span class="p">,</span><span class="n">kwh</span><span class="p">),</span><span class="n">Ldh</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== Note progress (or the lack of it). ====</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ld</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndfl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           ==== End of main loop ====</span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        ==== Iteration limit exceeded.  Set INFO to show where</span>
<span class="c">!        .    the problem occurred and exit. ====</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== Return the optimal value of LWORK. ====</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">lwkopt</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     ==== End of DLAQR4 ====</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">DLAQR4</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>