<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>SGESVJ &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>SGESVJ
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.3% of total for procedures.">696 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/sgesvj.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/sgesvj.f90.html'>sgesvj.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">SGESVJ</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/sgesvj.html#variable-half~13">HALF</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-nsweep">NSWEEP</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-one~226">ONE</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-zero~205">ZERO</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-aapp~2">aapp</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-aapp0">aapp0</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-aapq">aapq</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-aaqq~2">aaqq</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-apoaq">apoaq</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-applv">applv</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-aqoap">aqoap</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-big~4">big</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-bigtheta">bigtheta</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-blskip">blskip</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-cs~7">cs</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-ctol">ctol</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-emptsw">emptsw</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-epsln~3">epsln</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-fastr">fastr</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-goscale">goscale</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-i~232">i</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-ibr">ibr</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-ierr~21">ierr</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-igl">igl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-ijblsk">ijblsk</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-ir1">ir1</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-iswrot">iswrot</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-jbc">jbc</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-jgl">jgl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-kbl">kbl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-large~6">large</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-lkahead">lkahead</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-lower~18">lower</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-lsvec~3">lsvec</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-mvl">mvl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-mxaapq">mxaapq</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-mxsinj">mxsinj</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-n2~15">n2</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-n34">n34</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-n4">n4</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-nbl">nbl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-noscale">noscale</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-notrot">notrot</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-p~8">p</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-pskipped">pskipped</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-q~3">q</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rootbig">rootbig</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rooteps">rooteps</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rootsfmin">rootsfmin</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-roottol">roottol</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rotok">rotok</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rowskip">rowskip</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-rsvec~3">rsvec</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-sfmin~12">sfmin</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-skl">skl</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-small~8">small</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-sn~9">sn</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-swband">swband</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-t~14">t</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-temp1~7">temp1</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-theta">theta</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-thsign">thsign</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-tol~9">tol</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-uctol">uctol</a>
            <a class="list-group-item" href="../proc/sgesvj.html#variable-upper~87">upper</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/sgesvj.html#src">SGESVJ</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine SGESVJ(Joba, Jobu, Jobv, M, N, A, Lda, Sva, Mv, V, Ldv, Work, Lwork, Info)  
</h2>
    

    <p>\brief \b SGESVJ
 \htmlonly
 Download SGESVJ + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/sgesvj.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/sgesvj.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/sgesvj.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>SGESVJ computes the singular value decomposition (SVD) of a real
 M-by-N matrix A, where M &gt;= N. The SVD of A is written as
                                    [++]   [xx]   [x0]   [xx]
              A = U * SIGMA * V^t,  [++] = [xx] * [ox] * [xx]
                                    [++]   [xx]
 where SIGMA is an N-by-N diagonal matrix, U is an M-by-N orthonormal
 matrix, and V is an N-by-N orthogonal matrix. The diagonal elements
 of SIGMA are the singular values of A. The columns of U and V are the
 left and the right singular vectors of A, respectively.
 SGESVJ can sometimes compute tiny singular values and their singular vectors much
 more accurately than other SVD routines, see below under Further Details.
 \endverbatim
 \param[in] JOBA
 \verbatim
          JOBA is CHARACTER*1
          Specifies the structure of A.
          = &lsquo;L&rsquo;: The input matrix A is lower triangular;
          = &lsquo;U&rsquo;: The input matrix A is upper triangular;
          = &lsquo;G&rsquo;: The input matrix A is general M-by-N matrix, M &gt;= N.
 \endverbatim</p>
<p>\param[in] JOBU
 \verbatim
          JOBU is CHARACTER<em>1
          Specifies whether to compute the left singular vectors
          (columns of U):
          = &lsquo;U&rsquo;: The left singular vectors corresponding to the nonzero
                 singular values are computed and returned in the leading
                 columns of A. See more details in the description of A.
                 The default numerical orthogonality threshold is set to
                 approximately TOL=CTOL</em>EPS, CTOL=SQRT(M), EPS=SLAMCH(&lsquo;E&rsquo;).
          = &lsquo;C&rsquo;: Analogous to JOBU=&rsquo;U&rsquo;, except that user can control the
                 level of numerical orthogonality of the computed left
                 singular vectors. TOL can be set to TOL = CTOL<em>EPS, where
                 CTOL is given on input in the array WORK.
                 No CTOL smaller than ONE is allowed. CTOL greater
                 than 1 / EPS is meaningless. The option &lsquo;C&rsquo;
                 can be used if M</em>EPS is satisfactory orthogonality
                 of the computed left singular vectors, so CTOL=M could
                 save few sweeps of Jacobi rotations.
                 See the descriptions of A and WORK(1).
          = &lsquo;N&rsquo;: The matrix U is not computed. However, see the
                 description of A.
 \endverbatim</p>
<p>\param[in] JOBV
 \verbatim
          JOBV is CHARACTER*1
          Specifies whether to compute the right singular vectors, that
          is, the matrix V:
          = &lsquo;V&rsquo;:  the matrix V is computed and returned in the array V
          = &lsquo;A&rsquo;:  the Jacobi rotations are applied to the MV-by-N
                  array V. In other words, the right singular vector
                  matrix V is not computed explicitly; instead it is
                  applied to an MV-by-N matrix initially stored in the
                  first MV rows of V.
          = &lsquo;N&rsquo;:  the matrix V is not computed and the array V is not
                  referenced
 \endverbatim</p>
<p>\param[in] M
 \verbatim
          M is INTEGER
          The number of rows of the input matrix A. 1/SLAMCH(&lsquo;E&rsquo;) &gt; M &gt;= 0.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          The number of columns of the input matrix A.
          M &gt;= N &gt;= 0.
 \endverbatim</p>
<p>\param[in,out] A
 \verbatim
          A is REAL array, dimension (LDA,N)
          On entry, the M-by-N matrix A.
          On exit,
          If JOBU = &lsquo;U&rsquo; .OR. JOBU = &lsquo;C&rsquo;:
                 If INFO = 0:
                 RANKA orthonormal columns of U are returned in the
                 leading RANKA columns of the array A. Here RANKA &lt;= N
                 is the number of computed singular values of A that are
                 above the underflow threshold SLAMCH(&lsquo;S&rsquo;). The singular
                 vectors corresponding to underflowed or zero singular
                 values are not computed. The value of RANKA is returned
                 in the array WORK as RANKA=NINT(WORK(2)). Also see the
                 descriptions of SVA and WORK. The computed columns of U
                 are mutually numerically orthogonal up to approximately
                 TOL=SQRT(M)<em>EPS (default); or TOL=CTOL</em>EPS (JOBU = &lsquo;C&rsquo;),
                 see the description of JOBU.
                 If INFO &gt; 0,
                 the procedure SGESVJ did not converge in the given number
                 of iterations (sweeps). In that case, the computed
                 columns of U may not be orthogonal up to TOL. The output
                 U (stored in A), SIGMA (given by the computed singular
                 values in SVA(1:N)) and V is still a decomposition of the
                 input matrix A in the sense that the residual
                 ||A-SCALE<em>U</em>SIGMA<em>V^T||_2 / ||A||_2 is small.
          If JOBU = &lsquo;N&rsquo;:
                 If INFO = 0:
                 Note that the left singular vectors are &lsquo;for free&rsquo; in the
                 one-sided Jacobi SVD algorithm. However, if only the
                 singular values are needed, the level of numerical
                 orthogonality of U is not an issue and iterations are
                 stopped when the columns of the iterated matrix are
                 numerically orthogonal up to approximately M</em>EPS. Thus,
                 on exit, A contains the columns of U scaled with the
                 corresponding singular values.
                 If INFO &gt; 0:
                 the procedure SGESVJ did not converge in the given number
                 of iterations (sweeps).
 \endverbatim</p>
<p>\param[in] LDA
 \verbatim
          LDA is INTEGER
          The leading dimension of the array A.  LDA &gt;= max(1,M).
 \endverbatim</p>
<p>\param[out] SVA
 \verbatim
          SVA is REAL array, dimension (N)
          On exit,
          If INFO = 0 :
          depending on the value SCALE = WORK(1), we have:
                 If SCALE = ONE:
                 SVA(1:N) contains the computed singular values of A.
                 During the computation SVA contains the Euclidean column
                 norms of the iterated matrices in the array A.
                 If SCALE .NE. ONE:
                 The singular values of A are SCALE*SVA(1:N), and this
                 factored representation is due to the fact that some of the
                 singular values of A might underflow or overflow.</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">INFO</span> <span class="o">&gt;</span> <span class="mi">0</span> :
      <span class="nv">the</span> <span class="nv">procedure</span> <span class="nv">SGESVJ</span> <span class="nv">did</span> <span class="nv">not</span> <span class="nv">converge</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">given</span> <span class="nv">number</span> <span class="nv">of</span>
      <span class="nv">iterations</span> <span class="ss">(</span><span class="nv">sweeps</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">SCALE</span><span class="o">*</span><span class="nv">SVA</span><span class="ss">(</span><span class="mi">1</span>:<span class="nv">N</span><span class="ss">)</span> <span class="nv">may</span> <span class="nv">not</span> <span class="nv">be</span> <span class="nv">accurate</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[in] MV
 \verbatim
          MV is INTEGER
          If JOBV = &lsquo;A&rsquo;, then the product of Jacobi rotations in SGESVJ
          is applied to the first MV rows of V. See the description of JOBV.
 \endverbatim</p>
<p>\param[in,out] V
 \verbatim
          V is REAL array, dimension (LDV,N)
          If JOBV = &lsquo;V&rsquo;, then V contains on exit the N-by-N matrix of
                         the right singular vectors;
          If JOBV = &lsquo;A&rsquo;, then V contains the product of the computed right
                         singular vector matrix and the initial matrix in
                         the array V.
          If JOBV = &lsquo;N&rsquo;, then V is not referenced.
 \endverbatim</p>
<p>\param[in] LDV
 \verbatim
          LDV is INTEGER
          The leading dimension of the array V, LDV &gt;= 1.
          If JOBV = &lsquo;V&rsquo;, then LDV &gt;= max(1,N).
          If JOBV = &lsquo;A&rsquo;, then LDV &gt;= max(1,MV) .
 \endverbatim</p>
<p>\param[in,out] WORK
 \verbatim
          WORK is REAL array, dimension (LWORK)
          On entry,
          If JOBU = &lsquo;C&rsquo; :
          WORK(1) = CTOL, where CTOL defines the threshold for convergence.
                    The process stops if all columns of A are mutually
                    orthogonal up to CTOL<em>EPS, EPS=SLAMCH(&lsquo;E&rsquo;).
                    It is required that CTOL &gt;= ONE, i.e. it is not
                    allowed to force the routine to obtain orthogonality
                    below EPSILON.
          On exit,
          WORK(1) = SCALE is the scaling factor such that SCALE</em>SVA(1:N)
                    are the computed singular vcalues of A.
                    (See description of SVA().)
          WORK(2) = NINT(WORK(2)) is the number of the computed nonzero
                    singular values.
          WORK(3) = NINT(WORK(3)) is the number of the computed singular
                    values that are larger than the underflow threshold.
          WORK(4) = NINT(WORK(4)) is the number of sweeps of Jacobi
                    rotations needed for numerical convergence.
          WORK(5) = max_{i.NE.j} |COS(A(:,i),A(:,j))| in the last sweep.
                    This is useful information in cases when SGESVJ did
                    not converge, as it can be used to estimate whether
                    the output is still useful and for post festum analysis.
          WORK(6) = the largest absolute value over all sines of the
                    Jacobi rotation angles in the last sweep. It can be
                    useful for a post festum analysis.
 \endverbatim</p>
<p>\param[in] LWORK
 \verbatim
          LWORK is INTEGER
         length of WORK, WORK &gt;= MAX(6,M+N)
 \endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          = 0:  successful exit.
          &lt; 0:  if INFO = -i, then the i-th argument had an illegal value
          &gt; 0:  SGESVJ did not converge in the maximal allowed number (30)
                of sweeps. The output may still be useful. See the
                description of WORK.
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date June 2017
 \ingroup realGEcomputational
 \par Further Details:</p>
<p>The orthogonal N-by-N matrix V is obtained as a product of Jacobi plane
 rotations. The rotations are implemented as fast scaled rotations of
 Anda and Park [1]. In the case of underflow of the Jacobi angle, a
 modified Jacobi transformation of Drmac [4] is used. Pivot strategy uses
 column interchanges of de Rijk [2]. The relative accuracy of the computed
 singular values and the accuracy of the computed singular vectors (in
 angle metric) is as guaranteed by the theory of Demmel and Veselic [3].
 The condition number that determines the accuracy in the full rank case
 is essentially min_{D=diag} kappa(A*D), where kappa(.) is the
 spectral condition number. The best performance of this Jacobi SVD
 procedure is achieved if used in an  accelerated version of Drmac and
 Veselic [5,6], and it is the kernel routine in the SIGMA library [7].
 Some tuning parameters (marked with [TP]) are available for the
 implementer. \n
 The computational range for the nonzero singular values is the  machine
 number interval ( UNDERFLOW , OVERFLOW ). In extreme cases, even
 denormalized singular values can be computed with the corresponding
 gradual loss of accurate digits.</p>
<p>\par Contributors:</p>
<p>Zlatko Drmac (Zagreb, Croatia) and Kresimir Veselic (Hagen, Germany)</p>
<p>\par References:</p>
<p>[1] A. A. Anda and H. Park: Fast plane rotations with dynamic scaling. \n
    SIAM J. matrix Anal. Appl., Vol. 15 (1994), pp. 162-174. \n\n
 [2] P. P. M. De Rijk: A one-sided Jacobi algorithm for computing the
    singular value decomposition on a vector computer. \n
    SIAM J. Sci. Stat. Comp., Vol. 10 (1998), pp. 359-371. \n\n
 [3] J. Demmel and K. Veselic: Jacobi method is more accurate than QR. \n
 [4] Z. Drmac: Implementation of Jacobi rotations for accurate singular
    value computation in floating point arithmetic. \n
    SIAM J. Sci. Comp., Vol. 18 (1997), pp. 1200-1222. \n\n
 [5] Z. Drmac and K. Veselic: New fast and accurate Jacobi SVD algorithm I. \n
    SIAM J. Matrix Anal. Appl. Vol. 35, No. 2 (2008), pp. 1322-1342. \n
    LAPACK Working note 169. \n\n
 [6] Z. Drmac and K. Veselic: New fast and accurate Jacobi SVD algorithm II. \n
    SIAM J. Matrix Anal. Appl. Vol. 35, No. 2 (2008), pp. 1343-1362. \n
    LAPACK Working note 170. \n\n
 [7] Z. Drmac: SIGMA - mathematical software library for accurate SVD, PSV,
    QSVD, (H,K)-SVD computations.\n
    Department of Mathematics, University of Zagreb, 2008.</p>
<p>\par Bugs, Examples and Comments:</p>
<p>Please report all bugs and send interesting test examples and comments to
 drmac@math.hr. Thank you.
&ndash;SGESVJ327</p>
<p>&ndash; LAPACK computational routine (version 3.7.1) &ndash;
  &ndash; LAPACK is a software package provided by Univ. of Tennessee,    &ndash;
  &ndash; Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..&ndash;
     June 2017</p>
<div class="codehilite"><pre><span></span><code> .. Scalar Arguments ..
</code></pre></div>

<p>*</p>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-joba~3"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Joba</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobu~6"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobu</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jobv~5"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Jobv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~115"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>M</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~329"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a~194"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>A</strong>(Lda,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lda~190"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lda</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sva~2"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Sva</strong>(N)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mv"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Mv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-v~21"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>V</strong>(Ldv,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldv~14"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldv</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~201"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(Lwork)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~106"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~271"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-half~13"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>HALF</strong></td>
<td> =</td>
                <td>0.5E0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nsweep"></span>
              integer,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>NSWEEP</strong></td>
<td> =</td>
                <td>30</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~226"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0E0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~205"></span>
              real,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0E0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapp~2"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapp0"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapp0</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aapq"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aapq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aaqq~2"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aaqq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-apoaq"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>apoaq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-applv"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>applv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-aqoap"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>aqoap</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-big~4"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>big</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bigtheta"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bigtheta</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-blskip"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>blskip</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cs~7"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cs</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ctol"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ctol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-emptsw"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>emptsw</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-epsln~3"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>epsln</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-fastr"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>fastr</strong>(5)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-goscale"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>goscale</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-i~232"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ibr"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ibr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ierr~21"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ierr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-igl"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>igl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ijblsk"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ijblsk</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ir1"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ir1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iswrot"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iswrot</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jbc"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jbc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jgl"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jgl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-kbl"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>kbl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-large~6"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>large</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lkahead"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lkahead</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lower~18"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lower</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lsvec~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mvl"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mvl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mxaapq"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mxaapq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-mxsinj"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>mxsinj</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n2~15"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>n2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n34"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>n34</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>n4</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-nbl"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>nbl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-noscale"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>noscale</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-notrot"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>notrot</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-p~8"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>p</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pskipped"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>pskipped</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~3"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>q</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rootbig"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rootbig</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rooteps"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rooteps</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rootsfmin"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rootsfmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-roottol"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>roottol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rotok"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rotok</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rowskip"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rowskip</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rsvec~3"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>rsvec</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sfmin~12"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sfmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-skl"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>skl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-small~8"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>small</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sn~9"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sn</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-swband"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>swband</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~14"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>t</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-temp1~7"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>temp1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-theta"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>theta</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-thsign"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>thsign</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tol~9"></span>
              real,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>tol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-uctol"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>uctol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-upper~87"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>upper</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">SGESVJ</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="n">Jobu</span><span class="p">,</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">Mv</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Lwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--SGESVJ327</span>
<span class="c">!</span>
<span class="c">!  -- LAPACK computational routine (version 3.7.1) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     June 2017</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lda</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Mv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">1</span><span class="w"> </span><span class="n">Joba</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobu</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Jobv</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">A</span><span class="p">(</span><span class="n">Lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">Ldv</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">Lwork</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Local Parameters ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">HALF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0E0</span><span class="p">,</span><span class="n">HALF</span><span class="o">=</span><span class="mf">0.5E0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0E0</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">NSWEEP</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">NSWEEP</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">aapp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aapp0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aapq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">apoaq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">aqoap</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bigtheta</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="n">cs</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ctol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">epsln</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">large</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mxaapq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mxsinj</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rootbig</span><span class="w"> </span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="n">rooteps</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rootsfmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">roottol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">skl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="n">t</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">thsign</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">blskip</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">emptsw</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ibr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ir1</span><span class="w"> </span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">iswrot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jbc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">kbl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lkahead</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mvl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n34</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n4</span><span class="w"> </span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">nbl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rowskip</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">swband</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">applv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">goscale</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">noscale</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">rsvec</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">uctol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">upper</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays ..</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">fastr</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">FLOAT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SIGN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SQRT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="c">!     ..</span>
<span class="c">!     from BLAS</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">SDOT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SNRM2</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SDOT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SNRM2</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">ISAMAX</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">ISAMAX</span><span class="w"></span>
<span class="c">!     from LAPACK</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">SLAMCH</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SLAMCH</span><span class="w"></span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="c">!     ..</span>
<span class="c">!     from BLAS</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SAXPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SCOPY</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SROTM</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SSCAL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SSWAP</span><span class="w"></span>
<span class="c">!     from LAPACK</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SLASCL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SLASSQ</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">SGSVJ0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SGSVJ1</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Test the input arguments</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">lsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">uctol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">applv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">upper</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">uctol</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobu</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">M</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lda</span><span class="o">&lt;</span><span class="n">M</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">7</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Mv</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">9</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">applv</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Ldv</span><span class="o">&lt;</span><span class="n">Mv</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">11</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">uctol</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">ONE</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">12</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">13</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     #:(</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVJ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">! #:) Quick return for void matrix</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">M</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Set numerical parameters</span>
<span class="c">!     The stopping criterion for Jacobi rotations is</span>
<span class="c">!</span>
<span class="c">!     max_{i&lt;&gt;j}|A(:,i)^T * A(:,j)|/(||A(:,i)||*||A(:,j)||) &lt; CTOL*EPS</span>
<span class="c">!</span>
<span class="c">!     where EPS is the round-off and CTOL is defined as follows:</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">uctol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        ... user controlled</span>
<span class="w">         </span><span class="n">ctol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!        ... default</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ctol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">M</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">ctol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!     ... and the machine dependent parameters are</span>
<span class="c">![!]  (Make sure that SLAMCH() works properly on the target machine.)</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">epsln</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rooteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">epsln</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">sfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;SafeMinimum&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">rootsfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">small</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sfmin</span><span class="o">/</span><span class="n">epsln</span><span class="w"></span>
<span class="w">      </span><span class="n">big</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SLAMCH</span><span class="p">(</span><span class="s1">&#39;Overflow&#39;</span><span class="p">)</span><span class="w"></span>
<span class="c">!     BIG         = ONE    / SFMIN</span>
<span class="w">      </span><span class="n">rootbig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">rootsfmin</span><span class="w"></span>
<span class="w">      </span><span class="n">large</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="n">bigtheta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">rooteps</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctol</span><span class="o">*</span><span class="n">epsln</span><span class="w"></span>
<span class="w">      </span><span class="n">roottol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">epsln</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">         </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVJ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Initialize the right singular vector matrix.</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">mvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">mvl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mv</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      </span><span class="n">rsvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">applv</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Initialize SVA( 1:N ) = ( ||A e_i||_2, i = 1:N )</span>
<span class="c">!(!)  If necessary, scale A to protect the largest singular value</span>
<span class="c">!     from overflow. It is possible that saving the largest singular</span>
<span class="c">!     value destroys the information about the small ones.</span>
<span class="c">!     This initial scaling is almost minimal in the sense that the</span>
<span class="c">!     goal is to make sure that no column norm overflows, and that</span>
<span class="c">!     SQRT(N)*max_i SVA(i) does not overflow. If INFinite entries</span>
<span class="c">!     in A are detected, the procedure returns with INFO=-6.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">skl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="n">noscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="n">goscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        the input matrix is M-by-N lower triangular (trapezoidal)</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">big</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVJ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">RETURN</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">noscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">noscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="p">(</span><span class="n">aaqq</span><span class="o">*</span><span class="n">skl</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">goscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">skl</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!        the input matrix is M-by-N upper triangular (trapezoidal)</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">big</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVJ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">RETURN</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">noscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">noscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="p">(</span><span class="n">aaqq</span><span class="o">*</span><span class="n">skl</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">goscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">skl</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">      ELSE</span><span class="w"></span>
<span class="c">!        the input matrix is M-by-N general dense</span>
<span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">big</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;SGESVJ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">RETURN</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">noscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="n">noscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="p">(</span><span class="n">aaqq</span><span class="o">*</span><span class="n">skl</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">goscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                  </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">skl</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDDO</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">noscale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">skl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Move the smaller part of the spectrum from the underflow threshold</span>
<span class="c">!(!)  Start by determining the position of the nonzero entries of the</span>
<span class="c">!     array SVA() relative to ( SFMIN, BIG ).</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">      </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">aaqq</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">aapp</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">! #:) Quick return for zero matrix</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASET</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">! #:) Quick return for one-column matrix</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">skl</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">skl</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">Work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Protect small singular values from underflow, and try to</span>
<span class="c">!     avoid underflows/overflows in computing Jacobi rotations.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">sfmin</span><span class="o">/</span><span class="n">epsln</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;=</span><span class="n">sn</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">                           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="p">((</span><span class="n">sn</span><span class="o">&lt;=</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">big</span><span class="p">,</span><span class="n">temp1</span><span class="o">/</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="c">!         AAQQ  = AAQQ*TEMP1</span>
<span class="c">!         AAPP  = AAPP*TEMP1</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;=</span><span class="n">sn</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">sn</span><span class="o">/</span><span class="n">aaqq</span><span class="p">,</span><span class="n">big</span><span class="o">/</span><span class="p">(</span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span><span class="w"></span>
<span class="c">!         AAQQ  = AAQQ*TEMP1</span>
<span class="c">!         AAPP  = AAPP*TEMP1</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">sn</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">sn</span><span class="o">/</span><span class="n">aaqq</span><span class="p">,</span><span class="n">temp1</span><span class="o">/</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="c">!         AAQQ  = AAQQ*TEMP1</span>
<span class="c">!         AAPP  = AAPP*TEMP1</span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;=</span><span class="n">sn</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">sn</span><span class="o">/</span><span class="n">aaqq</span><span class="p">,</span><span class="n">big</span><span class="o">/</span><span class="p">(</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">aapp</span><span class="p">))</span><span class="w"></span>
<span class="c">!         AAQQ  = AAQQ*TEMP1</span>
<span class="c">!         AAPP  = AAPP*TEMP1</span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Scale, if necessary</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">skl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="o">*</span><span class="n">skl</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">skl</span><span class="o">/=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="n">Joba</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">skl</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">skl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">skl</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Row-cyclic Jacobi SVD algorithm with column pivoting</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">emptsw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">fastr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     A is represented in factored form A = A * diag(WORK), where diag(WORK)</span>
<span class="c">!     is initialized to identity. WORK is updated during fast scaled</span>
<span class="c">!     rotations.</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">swband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="c">![TP] SWBAND is a tuning parameter [TP]. It is meaningful and effective</span>
<span class="c">!     if SGESVJ is used as a computational routine in the preconditioned</span>
<span class="c">!     Jacobi SVD algorithm SGESVJ. For sweeps i=1:SWBAND the procedure</span>
<span class="c">!     works on pivots inside a band-like region around the diagonal.</span>
<span class="c">!     The boundaries are determined dynamically, based on the number of</span>
<span class="c">!     pivots above a threshold.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">kbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">![TP] KBL is a tuning parameter that defines the tile size in the</span>
<span class="c">!     tiling of the p-q loops of pivot pairs. In general, an optimal</span>
<span class="c">!     value of KBL depends on the matrix dimensions and on the</span>
<span class="c">!     parameters of the computer&#39;s memory.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">nbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="n">kbl</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">nbl</span><span class="o">*</span><span class="n">kbl</span><span class="p">)</span><span class="o">/=</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">nbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">blskip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbl</span><span class="o">**</span><span class="mi">2</span><span class="w"></span>
<span class="c">![TP] BLKSKIP is a tuning parameter that depends on SWBAND and KBL.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">rowskip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">kbl</span><span class="p">)</span><span class="w"></span>
<span class="c">![TP] ROWSKIP is a tuning parameter.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">lkahead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![TP] LKAHEAD is a tuning parameter.</span>
<span class="c">!</span>
<span class="c">!     Quasi block transformations, using the lower (upper) triangular</span>
<span class="c">!     structure of the input matrix. The quasi-block-cycling usually</span>
<span class="c">!     invokes cubic convergence. Big part of this cycle is done inside</span>
<span class="c">!     canonical subspaces of dimensions less than M.</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">lower</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">upper</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">kbl</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">![TP] The number of partition levels and the actual partition are</span>
<span class="c">!     tuning parameters.</span>
<span class="w">         </span><span class="n">n4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="mi">4</span><span class="w"></span>
<span class="w">         </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>
<span class="w">         </span><span class="n">n34</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">n4</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lower</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     This works very well on lower triangular matrices, in particular</span>
<span class="c">!     in the framework of the preconditioned Jacobi SVD (xGEJSV).</span>
<span class="c">!     The idea is simple:</span>
<span class="c">!     [+ 0 0 0]   Note that Jacobi transformations of [0 0]</span>
<span class="c">!     [+ + 0 0]                                       [0 0]</span>
<span class="c">!     [+ + x 0]   actually work on [x 0]              [x 0]</span>
<span class="c">!     [+ + x x]                    [x x].             [x x]</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">n34</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">n34</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">n34</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n34</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n34</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Sva</span><span class="p">(</span><span class="n">n34</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n34</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n34</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">n2</span><span class="p">,</span><span class="n">n34</span><span class="o">-</span><span class="n">n2</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Sva</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n2</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ1</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">n2</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">n2</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Sva</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n2</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="o">-</span><span class="n">n4</span><span class="p">,</span><span class="n">n2</span><span class="o">-</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Sva</span><span class="p">(</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n4</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ1</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">sfmin</span><span class="p">,</span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">upper</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">tol</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Sva</span><span class="p">(</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n4</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n4</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ1</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Sva</span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">sfmin</span><span class="p">,</span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SGSVJ0</span><span class="p">(</span><span class="n">Jobv</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="n">n4</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Sva</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="p">,</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="n">n2</span><span class="o">*</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldv</span><span class="p">,</span><span class="n">epsln</span><span class="p">,</span><span class="n">sfmin</span><span class="p">,</span><span class="n">tol</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lwork</span><span class="o">-</span><span class="n">N</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. Row-cyclic pivot strategy with de Rijk&#39;s pivoting ..</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">DO </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">NSWEEP</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. go go go ...</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Each sweep is unrolled using KBL-by-KBL tiles over the pivot pairs</span>
<span class="c">!     1 &lt;= p &lt; q &lt;= N. This is the first step toward a blocked implementation</span>
<span class="c">!     of the rotations. New implementation, based on block transformations,</span>
<span class="c">!     is under development.</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">ibr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ibr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">ir1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">lkahead</span><span class="p">,</span><span class="n">nbl</span><span class="o">-</span><span class="n">ibr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ir1</span><span class="o">*</span><span class="n">kbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. de Rijk&#39;s pivoting</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISAMAX</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     CALL </span><span class="n">SSWAP</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SSWAP</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Column norms are periodically updated by explicit</span>
<span class="c">!        norm computation.</span>
<span class="c">!        Caveat:</span>
<span class="c">!        Unfortunately, some BLAS implementations compute SNRM2(M,A(1,p),1)</span>
<span class="c">!        as SQRT(SDOT(M,A(1,p),1,A(1,p),1)), which may cause the result to</span>
<span class="c">!        overflow for ||A(:,p)||_2 &gt; SQRT(overflow_threshold), and to</span>
<span class="c">!        underflow for ||A(:,p)||_2 &lt; SQRT(underflow_threshold).</span>
<span class="c">!        Hence, SNRM2 cannot be trusted, not even in the case when</span>
<span class="c">!        the true norm is far from the under(over)flow boundaries.</span>
<span class="c">!        If properly implemented SNRM2 is available, the IF-THEN-ELSE</span>
<span class="c">!        below should read &quot;AAPP = SNRM2( M, A(1,p), 1 ) * WORK(p)&quot;.</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ELSE</span>
<span class="k">                        </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                     </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="n">aapp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aapp</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ELSE</span>
<span class="k">                              </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aaqq</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">),</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxaapq</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        TO rotate or NOT to rotate, THAT is the question ...</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           .. rotate</span>
<span class="c">![RTD]      ROTATED = ROTATED + ONE</span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                                 </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                                 </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iswrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                                 </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                                 </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">HALF</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aqoap</span><span class="o">-</span><span class="n">apoaq</span><span class="p">)</span><span class="o">/</span><span class="n">aapq</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">&gt;</span><span class="n">bigtheta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HALF</span><span class="o">/</span><span class="n">theta</span><span class="w"></span>
<span class="w">                                    </span><span class="n">fastr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">fastr</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 .. choose correct signum for THETA and rotate</span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">SIGN</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">thsign</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">theta</span><span class="o">*</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                       IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         </span><span class="n">fastr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="w"></span>
<span class="w">                                         </span><span class="n">fastr</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ELSE</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">ENDIF</span>
<span class="k">                                       ENDIF</span>
<span class="k">                                    </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    ELSE</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    ENDIF</span>
<span class="k">                                 ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!              .. have to use modified Gram-Schmidt like transformation</span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!           END IF ROTOK THEN ... ELSE</span>
<span class="c">!</span>
<span class="c">!           In the case of cancellation in updating SVA(q), SVA(p)</span>
<span class="c">!           recompute SVA(q), SVA(p).</span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                              ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">aapp0</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!        A(:,p) and A(:,q) already numerically orthogonal</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![RTD]      SKIPPED  = SKIPPED  + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ELSE</span><span class="w"></span>
<span class="c">!        A(:,q) is zero column</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pskipped</span><span class="o">&gt;</span><span class="n">rowskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">EXIT</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     END q-LOOP</span>
<span class="c">!</span>
<span class="c">!     bailed out of q-loop</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ELSE</span>
<span class="k">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">ir1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the p-loop</span>
<span class="c">!     end of doing the block ( ibr, ibr )</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of ir1-loop</span>
<span class="c">!</span>
<span class="c">! ... go to the off diagonal blocks</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">igl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ibr</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">jbc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ibr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">nbl</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">jgl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">jbc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">kbl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        doing the block at ( ibr, jbc )</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">               </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">jgl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">aapp0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     .. M x 2 Jacobi SVD ..</span>
<span class="c">!</span>
<span class="c">!        Safe Gram matrix computation</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aapp</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="o">*</span><span class="n">aaqq</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ELSE</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;=</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aaqq</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 </span><span class="n">rotok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">small</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">),</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">aapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SDOT</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span>
<span class="k">                           ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="n">mxaapq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxaapq</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        TO rotate or NOT to rotate, THAT is the question ...</span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">aapq</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">![RTD]      ROTATED  = ROTATED + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                              </span><span class="n">iswrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iswrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rotok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">/</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                                 </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">/</span><span class="n">aaqq</span><span class="w"></span>
<span class="w">                                 </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">HALF</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">aqoap</span><span class="o">-</span><span class="n">apoaq</span><span class="p">)</span><span class="o">/</span><span class="n">aapq</span><span class="w"></span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">aapp0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">theta</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                 </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">&gt;</span><span class="n">bigtheta</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HALF</span><span class="o">/</span><span class="n">theta</span><span class="w"></span>
<span class="w">                                    </span><span class="n">fastr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">fastr</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 .. choose correct signum for THETA and rotate</span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">SIGN</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">aapp0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">thsign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">thsign</span><span class="w"></span>
<span class="w">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="w">                            </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">thsign</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">theta</span><span class="o">*</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                  </span><span class="n">theta</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">sn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                    </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">sn</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                 </span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                    </span><span class="n">apoaq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aqoap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         </span><span class="n">fastr</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="w"></span>
<span class="w">                                         </span><span class="n">fastr</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="k">CALL </span><span class="n">SROTM</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">fastr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ELSE</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">ENDIF</span>
<span class="k">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                         </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">ONE</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                    </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    ELSE</span>
<span class="k">                                       CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                    </span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">cs</span><span class="w"></span>
<span class="w">                                       </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                         CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">t</span><span class="o">*</span><span class="n">apoaq</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                         </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="o">-</span><span class="n">cs</span><span class="o">*</span><span class="n">sn</span><span class="o">*</span><span class="n">aqoap</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                      </span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                       </span><span class="k">ENDIF</span>
<span class="k">                                    ENDIF</span>
<span class="k">                                 ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                              </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ELSE</span>
<span class="k">                                 CALL </span><span class="n">SCOPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aaqq</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SAXPY</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">CALL </span><span class="n">SLASCL</span><span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">aapp</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">,</span><span class="n">Lda</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">                                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="o">-</span><span class="n">aapq</span><span class="o">*</span><span class="n">aapq</span><span class="p">))</span><span class="w"></span>
<span class="w">                                 </span><span class="n">mxsinj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">mxsinj</span><span class="p">,</span><span class="n">sfmin</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!           END IF ROTOK THEN ... ELSE</span>
<span class="c">!</span>
<span class="c">!           In the case of cancellation in updating SVA(q)</span>
<span class="c">!           .. recompute SVA(q)</span>
<span class="w">                              </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">aaqq</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aaqq</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aaqq</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                              ENDIF</span>
<span class="k">                              IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">/</span><span class="n">aapp0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">rooteps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                 IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                                </span><span class="p">(</span><span class="n">aapp</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ELSE</span>
<span class="k">                                    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                                    </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">                                    </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">                                 </span><span class="k">ENDIF</span>
<span class="k">                                 </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                              </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!              end of OK rotation</span>
<span class="w">                           </span><span class="k">ELSE</span>
<span class="k">                              </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="c">![RTD]      SKIPPED  = SKIPPED  + 1</span>
<span class="w">                              </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                              </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ELSE</span>
<span class="k">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">pskipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pskipped</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ijblsk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ijblsk</span><span class="o">&gt;=</span><span class="n">blskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span>
<span class="k">                        IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pskipped</span><span class="o">&gt;</span><span class="n">rowskip</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">aapp</span><span class="w"></span>
<span class="w">                           </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                           </span><span class="k">EXIT</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!        end of the q-loop</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">==</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">+</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="nb">MIN</span><span class="p">(</span><span class="n">jgl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">jgl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">notrot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the p-loop</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end of the jbc-loop</span>
<span class="c">!2011 bailed out of the jbc-loop</span>
<span class="w"> </span><span class="mi">20</span><span class="w">         </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">igl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">igl</span><span class="o">+</span><span class="n">kbl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!**</span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!2000 :: end of the ibr-loop</span>
<span class="c">!</span>
<span class="c">!     .. update SVA(N)</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">&lt;</span><span class="n">rootbig</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">&gt;</span><span class="n">rootsfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SNRM2</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SLASSQ</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">aapp</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="o">*</span><span class="nb">SQRT</span><span class="p">(</span><span class="n">aapp</span><span class="p">)</span><span class="o">*</span><span class="n">Work</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Additional steering devices</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">swband</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">mxaapq</span><span class="o">&lt;=</span><span class="n">roottol</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">iswrot</span><span class="o">&lt;=</span><span class="n">N</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">swband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">swband</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">mxaapq</span><span class="o">&lt;</span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">mxaapq</span><span class="o">*</span><span class="n">mxsinj</span><span class="o">&lt;</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">notrot</span><span class="o">&gt;=</span><span class="n">emptsw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!     end i=1:NSWEEP loop</span>
<span class="c">!</span>
<span class="c">! #:( Reaching this point means that the procedure has not converged.</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NSWEEP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="c">!</span>
<span class="c">! #:) Reaching this point means numerical convergence after the i-th</span>
<span class="c">!     sweep.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">! #:) INFO = 0 confirms successful iterations.</span>
<span class="c">!</span>
<span class="c">!     Sort the singular values and find how many are above</span>
<span class="c">!     the underflow threshold.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">200</span><span class="w">  </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">n4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ISAMAX</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">/=</span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Work</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SSWAP</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">SSWAP</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">n4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">skl</span><span class="o">&gt;</span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">      ENDDO</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">n4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Sva</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">skl</span><span class="o">&gt;</span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Normalize the left singular vectors.</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">uctol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Scale the product of Jacobi rotations (assemble the fast rotations).</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">applv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">Work</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ELSE</span>
<span class="k">            DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">               </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">SNRM2</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">SSCAL</span><span class="p">(</span><span class="n">mvl</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">V</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span>
<span class="k">         ENDIF</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Undo scaling, if necessary (and possible).</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">((</span><span class="n">skl</span><span class="o">&gt;</span><span class="n">ONE</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">skl</span><span class="p">)))</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w">                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">     </span><span class="p">((</span><span class="n">skl</span><span class="o">&lt;</span><span class="n">ONE</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">Sva</span><span class="p">(</span><span class="nb">MAX</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sfmin</span><span class="o">/</span><span class="n">skl</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         DO </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">            </span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skl</span><span class="o">*</span><span class="n">Sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDDO</span>
<span class="k">         </span><span class="n">skl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skl</span><span class="w"></span>
<span class="c">!     The singular values of A are SKL*SVA(1:N). If SKL.NE.ONE</span>
<span class="c">!     then some of the singular values may overflow or underflow and</span>
<span class="c">!     the spectrum is given in this factored representation.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">n4</span><span class="p">)</span><span class="w"></span>
<span class="c">!     N4 is the number of computed nonzero singular values of A.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="w"></span>
<span class="c">!     N2 is the number of singular values of A greater than SFMIN.</span>
<span class="c">!     If N2&lt;N, SVA(N2:N) contains ZEROS and/or denormalized numbers</span>
<span class="c">!     that may carry some information.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="c">!     i is the index of the last sweep before declaring convergence.</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxaapq</span><span class="w"></span>
<span class="c">!     MXAAPQ is the largest absolute value of scaled pivots in the</span>
<span class="c">!     last sweep</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mxsinj</span><span class="w"></span>
<span class="c">!     MXSINJ is the largest absolute value of the sines of Jacobi angles</span>
<span class="c">!     in the last sweep</span>
<span class="c">!</span>
<span class="c">!     ..</span>
<span class="c">!     .. END OF SGESVJ</span>
<span class="c">!     ..</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">SGESVJ</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>