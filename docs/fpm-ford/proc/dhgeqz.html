<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="spag_lapack module">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>DHGEQZ &ndash; spag_lapack</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="../css/fontawesome.min.css" rel="stylesheet">
    <link href="../css/brands.min.css" rel="stylesheet">
    <link href="../css/regular.min.css" rel="stylesheet">
    <link href="../css/solid.min.css" rel="stylesheet">
    <link href="../css/v4-font-face.min.css" rel="stylesheet">
    <link href="../css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="../css/local.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">spag_lapack </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>DHGEQZ
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 0.3% of total for procedures.">640 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/dhgeqz.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/dhgeqz.f90.html'>dhgeqz.f90</a></li>
            <li class="breadcrumb-item active" aria-current="page">DHGEQZ</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    // Enable Bootstrap tooltips
    (function () {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    })();
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#vars-0"
         aria-expanded="false" aria-controls="vars-0">
         <h4 class="card-header bg-primary text-white">Variables</h4>
      </a>
      <div id="vars-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-half~43">HALF</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-one~518">ONE</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-safety~2">SAFETY</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-zero~490">ZERO</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a11~3">a11</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a12~2">a12</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a1i">a1i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a1r">a1r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a21~2">a21</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a22~2">a22</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a2i">a2i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-a2r">a2r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad11~2">ad11</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad11l">ad11l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad12~2">ad12</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad12l">ad12l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad21~2">ad21</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad21l">ad21l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad22~2">ad22</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad22l">ad22l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ad32l">ad32l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-an">an</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-anorm~41">anorm</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ascale~6">ascale</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-atol~2">atol</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b11~2">b11</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b1a">b1a</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b1i">b1i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b1r">b1r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b22~2">b22</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b2a">b2a</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b2i">b2i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-b2r">b2r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-bn~3">bn</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-bnorm~11">bnorm</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-bscale~6">bscale</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-btol~2">btol</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c~20">c</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c11i">c11i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c11r">c11r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c12">c12</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c21">c21</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c22i">c22i</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-c22r">c22r</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-cl">cl</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-cq">cq</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-cr~2">cr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-cz">cz</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-eshift~2">eshift</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-icompq~4">icompq</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-icompz~7">icompz</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ifirst~5">ifirst</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ifrstm~2">ifrstm</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-iiter~6">iiter</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilast~5">ilast</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilastm~2">ilastm</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilazr2~2">ilazr2</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilazro~2">ilazro</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilpivt">ilpivt</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilq~4">ilq</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilschr~2">ilschr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ilz~4">ilz</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-in~22">in</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ischur~2">ischur</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-istart~2">istart</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-j~421">j</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-jc~25">jc</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-jch~2">jch</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-jiter~2">jiter</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-jr~14">jr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-lquery~199">lquery</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-maxit~6">maxit</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-s~60">s</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-s1~6">s1</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-s1inv">s1inv</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-s2~6">s2</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-safmax~8">safmax</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-safmin~81">safmin</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-scale~49">scale</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-sl~3">sl</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-sqi">sqi</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-sqr">sqr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-sr~3">sr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-szi">szi</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-szr">szr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-t1~4">t1</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-tau~13">tau</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-temp~98">temp</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-temp2~18">temp2</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-tempi">tempi</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-tempr~2">tempr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-u1">u1</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-u12~2">u12</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-u12l">u12l</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-u2">u2</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-ulp~18">ulp</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-v~3">v</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-vs">vs</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-w11">w11</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-w12">w12</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-w21">w21</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-w22">w22</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-wabs~2">wabs</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-wi~4">wi</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-wr~3">wr</a>
            <a class="list-group-item" href="../proc/dhgeqz.html#variable-wr2~2">wr2</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/dhgeqz.html#src">DHGEQZ</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2> subroutine DHGEQZ(Job, Compq, Compz, N, Ilo, Ihi, H, Ldh, T, Ldt, Alphar, Alphai, Beta, Q, Ldq, Z, Ldz, Work, Lwork, Info)  
</h2>
    

    <p>\brief \b DHGEQZ
 \htmlonly
 Download DHGEQZ + dependencies
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.tgz?format=tgz&filename=/lapack/lapack_routine/dhgeqz.f">
 [TGZ]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.zip?format=zip&filename=/lapack/lapack_routine/dhgeqz.f">
 [ZIP]</a>
 <a href="http://www.netlib.org/cgi-bin/netlibfiles.txt?format=txt&filename=/lapack/lapack_routine/dhgeqz.f">
 [TXT]</a>
 \endhtmlonly
 \par Purpose:</p>
<p>\verbatim</p>
<p>DHGEQZ computes the eigenvalues of a real matrix pair (H,T),
 where H is an upper Hessenberg matrix and T is upper triangular,
 using the double-shift QZ method.
 Matrix pairs of this type are produced by the reduction to
 generalized upper Hessenberg form of a real matrix pair (A,B):</p>
<div class="codehilite"><pre><span></span><code>A = Q1*H*Z1**T,  B = Q1*T*Z1**T,
</code></pre></div>

<p>as computed by DGGHRD.</p>
<p>If JOB=&rsquo;S&rsquo;, then the Hessenberg-triangular pair (H,T) is
 also reduced to generalized Schur form,</p>
<div class="codehilite"><pre><span></span><code>H = Q*S*Z**T,  T = Q*P*Z**T,
</code></pre></div>

<p>where Q and Z are orthogonal matrices, P is an upper triangular
 matrix, and S is a quasi-triangular matrix with 1-by-1 and 2-by-2
 diagonal blocks.</p>
<p>The 1-by-1 blocks correspond to real eigenvalues of the matrix pair
 (H,T) and the 2-by-2 blocks correspond to complex conjugate pairs of
 eigenvalues.</p>
<p>Additionally, the 2-by-2 upper triangular diagonal blocks of P
 corresponding to 2-by-2 blocks of S are reduced to positive diagonal
 form, i.e., if S(j+1,j) is non-zero, then P(j+1,j) = P(j,j+1) = 0,
 P(j,j) &gt; 0, and P(j+1,j+1) &gt; 0.</p>
<p>Optionally, the orthogonal matrix Q from the generalized Schur
 factorization may be postmultiplied into an input matrix Q1, and the
 orthogonal matrix Z may be postmultiplied into an input matrix Z1.
 If Q1 and Z1 are the orthogonal matrices from DGGHRD that reduced
 the matrix pair (A,B) to generalized upper Hessenberg form, then the
 output matrices Q1<em>Q and Z1</em>Z are the orthogonal factors from the
 generalized Schur factorization of (A,B):</p>
<div class="codehilite"><pre><span></span><code>A = (Q1*Q)*S*(Z1*Z)**T,  B = (Q1*Q)*P*(Z1*Z)**T.
</code></pre></div>

<p>To avoid overflow, eigenvalues of the matrix pair (H,T) (equivalently,
 of (A,B)) are computed as a pair of values (alpha,beta), where alpha is
 complex and beta real.
 If beta is nonzero, lambda = alpha / beta is an eigenvalue of the
 generalized nonsymmetric eigenvalue problem (GNEP)
    A<em>x = lambda</em>B<em>x
 and if alpha is nonzero, mu = beta / alpha is an eigenvalue of the
 alternate form of the GNEP
    mu</em>A<em>y = B</em>y.
 Real eigenvalues can be read directly from the generalized Schur
 form:
   alpha = S(i,i), beta = P(i,i).</p>
<p>Ref: C.B. Moler &amp; G.W. Stewart, &ldquo;An Algorithm for Generalized Matrix
      Eigenvalue Problems&rdquo;, SIAM J. Numer. Anal., 10(1973),
      pp. 241&ndash;256.
 \endverbatim
 \param[in] JOB
 \verbatim
          JOB is CHARACTER*1
          = &lsquo;E&rsquo;: Compute eigenvalues only;
          = &lsquo;S&rsquo;: Compute eigenvalues and the Schur form.
 \endverbatim</p>
<p>\param[in] COMPQ
 \verbatim
          COMPQ is CHARACTER<em>1
          = &lsquo;N&rsquo;: Left Schur vectors (Q) are not computed;
          = &lsquo;I&rsquo;: Q is initialized to the unit matrix and the matrix Q
                 of left Schur vectors of (H,T) is returned;
          = &lsquo;V&rsquo;: Q must contain an orthogonal matrix Q1 on entry and
                 the product Q1</em>Q is returned.
 \endverbatim</p>
<p>\param[in] COMPZ
 \verbatim
          COMPZ is CHARACTER<em>1
          = &lsquo;N&rsquo;: Right Schur vectors (Z) are not computed;
          = &lsquo;I&rsquo;: Z is initialized to the unit matrix and the matrix Z
                 of right Schur vectors of (H,T) is returned;
          = &lsquo;V&rsquo;: Z must contain an orthogonal matrix Z1 on entry and
                 the product Z1</em>Z is returned.
 \endverbatim</p>
<p>\param[in] N
 \verbatim
          N is INTEGER
          The order of the matrices H, T, Q, and Z.  N &gt;= 0.
 \endverbatim</p>
<p>\param[in] ILO
 \verbatim
          ILO is INTEGER
 \endverbatim</p>
<p>\param[in] IHI
 \verbatim
          IHI is INTEGER
          ILO and IHI mark the rows and columns of H which are in
          Hessenberg form.  It is assumed that A is already upper
          triangular in rows and columns 1:ILO-1 and IHI+1:N.
          If N &gt; 0, 1 &lt;= ILO &lt;= IHI &lt;= N; if N = 0, ILO=1 and IHI=0.
 \endverbatim</p>
<p>\param[in,out] H
 \verbatim
          H is DOUBLE PRECISION array, dimension (LDH, N)
          On entry, the N-by-N upper Hessenberg matrix H.
          On exit, if JOB = &lsquo;S&rsquo;, H contains the upper quasi-triangular
          matrix S from the generalized Schur factorization.
          If JOB = &lsquo;E&rsquo;, the diagonal blocks of H match those of S, but
          the rest of H is unspecified.
 \endverbatim</p>
<p>\param[in] LDH
 \verbatim
          LDH is INTEGER
          The leading dimension of the array H.  LDH &gt;= max( 1, N ).
 \endverbatim</p>
<p>\param[in,out] T
 \verbatim
          T is DOUBLE PRECISION array, dimension (LDT, N)
          On entry, the N-by-N upper triangular matrix T.
          On exit, if JOB = &lsquo;S&rsquo;, T contains the upper triangular
          matrix P from the generalized Schur factorization;
          2-by-2 diagonal blocks of P corresponding to 2-by-2 blocks of S
          are reduced to positive diagonal form, i.e., if H(j+1,j) is
          non-zero, then T(j+1,j) = T(j,j+1) = 0, T(j,j) &gt; 0, and
          T(j+1,j+1) &gt; 0.
          If JOB = &lsquo;E&rsquo;, the diagonal blocks of T match those of P, but
          the rest of T is unspecified.
 \endverbatim</p>
<p>\param[in] LDT
 \verbatim
          LDT is INTEGER
          The leading dimension of the array T.  LDT &gt;= max( 1, N ).
 \endverbatim</p>
<p>\param[out] ALPHAR
 \verbatim
          ALPHAR is DOUBLE PRECISION array, dimension (N)
          The real parts of each scalar alpha defining an eigenvalue
          of GNEP.
 \endverbatim</p>
<p>\param[out] ALPHAI
 \verbatim
          ALPHAI is DOUBLE PRECISION array, dimension (N)
          The imaginary parts of each scalar alpha defining an
          eigenvalue of GNEP.
          If ALPHAI(j) is zero, then the j-th eigenvalue is real; if
          positive, then the j-th and (j+1)-st eigenvalues are a
          complex conjugate pair, with ALPHAI(j+1) = -ALPHAI(j).
 \endverbatim</p>
<p>\param[out] BETA
 \verbatim
          BETA is DOUBLE PRECISION array, dimension (N)
          The scalars beta that define the eigenvalues of GNEP.
          Together, the quantities alpha = (ALPHAR(j),ALPHAI(j)) and
          beta = BETA(j) represent the j-th eigenvalue of the matrix
          pair (A,B), in one of the forms lambda = alpha/beta or
          mu = beta/alpha.  Since either lambda or mu may overflow,
          they should not, in general, be computed.
 \endverbatim</p>
<p>\param[in,out] Q
 \verbatim
          Q is DOUBLE PRECISION array, dimension (LDQ, N)
          On entry, if COMPQ = &lsquo;V&rsquo;, the orthogonal matrix Q1 used in
          the reduction of (A,B) to generalized Hessenberg form.
          On exit, if COMPQ = &lsquo;I&rsquo;, the orthogonal matrix of left Schur
          vectors of (H,T), and if COMPQ = &lsquo;V&rsquo;, the orthogonal matrix
          of left Schur vectors of (A,B).
          Not referenced if COMPQ = &lsquo;N&rsquo;.
 \endverbatim</p>
<p>\param[in] LDQ
 \verbatim
          LDQ is INTEGER
          The leading dimension of the array Q.  LDQ &gt;= 1.
          If COMPQ=&rsquo;V&rsquo; or &lsquo;I&rsquo;, then LDQ &gt;= N.
 \endverbatim</p>
<p>\param[in,out] Z
 \verbatim
          Z is DOUBLE PRECISION array, dimension (LDZ, N)
          On entry, if COMPZ = &lsquo;V&rsquo;, the orthogonal matrix Z1 used in
          the reduction of (A,B) to generalized Hessenberg form.
          On exit, if COMPZ = &lsquo;I&rsquo;, the orthogonal matrix of
          right Schur vectors of (H,T), and if COMPZ = &lsquo;V&rsquo;, the
          orthogonal matrix of right Schur vectors of (A,B).
          Not referenced if COMPZ = &lsquo;N&rsquo;.
 \endverbatim</p>
<p>\param[in] LDZ
 \verbatim
          LDZ is INTEGER
          The leading dimension of the array Z.  LDZ &gt;= 1.
          If COMPZ=&rsquo;V&rsquo; or &lsquo;I&rsquo;, then LDZ &gt;= N.
 \endverbatim</p>
<p>\param[out] WORK
 \verbatim
          WORK is DOUBLE PRECISION array, dimension (MAX(1,LWORK))
          On exit, if INFO &gt;= 0, WORK(1) returns the optimal LWORK.
 \endverbatim</p>
<p>\param[in] LWORK
 \verbatim
          LWORK is INTEGER
          The dimension of the array WORK.  LWORK &gt;= max(1,N).</p>
<div class="codehilite"><pre><span></span><code>      <span class="k">If</span> <span class="nv">LWORK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>, <span class="k">then</span> <span class="nv">a</span> <span class="nv">workspace</span> <span class="nv">query</span> <span class="nv">is</span> <span class="nv">assumed</span><span class="c1">; the routine</span>
      <span class="nv">only</span> <span class="nv">calculates</span> <span class="nv">the</span> <span class="nv">optimal</span> <span class="nv">size</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">WORK</span> <span class="nv">array</span>, <span class="nv">returns</span>
      <span class="nv">this</span> <span class="nv">value</span> <span class="nv">as</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">entry</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">WORK</span> <span class="nv">array</span>, <span class="nv">and</span> <span class="nv">no</span> <span class="nv">error</span>
      <span class="nv">message</span> <span class="nv">related</span> <span class="nv">to</span> <span class="nv">LWORK</span> <span class="nv">is</span> <span class="nv">issued</span> <span class="nv">by</span> <span class="nv">XERBLA</span>.
</code></pre></div>

<p>\endverbatim</p>
<p>\param[out] INFO
 \verbatim
          INFO is INTEGER
          = 0: successful exit
          &lt; 0: if INFO = -i, the i-th argument had an illegal value
          = 1,&hellip;,N: the QZ iteration did not converge.  (H,T) is not
                     in Schur form, but ALPHAR(i), ALPHAI(i), and
                     BETA(i), i=INFO+1,&hellip;,N should be correct.
          = N+1,&hellip;,2*N: the shift calculation failed.  (H,T) is not
                     in Schur form, but ALPHAR(i), ALPHAI(i), and
                     BETA(i), i=INFO-N+1,&hellip;,N should be correct.
 \endverbatim
 \author Univ. of Tennessee
 \author Univ. of California Berkeley
 \author Univ. of Colorado Denver
 \author NAG Ltd.
 \date June 2016
 \ingroup doubleGEcomputational
 \par Further Details:</p>
<p>\verbatim</p>
<p>Iteration counters:</p>
<p>JITER  &ndash; counts iterations.
  IITER  &ndash; counts iterations run since ILAST was last
            changed.  This is therefore reset only when a 1-by-1 or
            2-by-2 block deflates off the bottom.
 \endverbatim</p>
<p>&ndash;DHGEQZ307</p>
<p>&ndash; LAPACK computational routine (version 3.7.0) &ndash;
  &ndash; LAPACK is a software package provided by Univ. of Tennessee,    &ndash;
  &ndash; Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..&ndash;
     June 2016</p>
<div class="codehilite"><pre><span></span><code> .. Scalar Arguments ..
</code></pre></div>


    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-job~16"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Job</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-compq~7"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Compq</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-compz~9"></span>
              character(len=1)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Compz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-n~783"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>N</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilo~28"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ilo</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ihi~28"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ihi</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-h~16"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>H</strong>(Ldh,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldh~15"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldh</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~70"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>T</strong>(Ldt,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldt~65"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-alphar~8"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Alphar</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-alphai~8"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Alphai</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-beta~46"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Beta</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-q~41"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Q</strong>(Ldq,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldq~27"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldq</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-z~83"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Z</strong>(Ldz,*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ldz~65"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Ldz</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-work~457"></span>
              double precision
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Work</strong>(*)</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lwork~216"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Lwork</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-info~618"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>Info</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>


    <section>    
      <h2>Variables</h2>
      <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Visibility</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
<th></th><th scope="col">Initial</th>        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-half~43"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>HALF</strong></td>
<td> =</td>
                <td>0.5D+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-one~518"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ONE</strong></td>
<td> =</td>
                <td>1.0D+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-safety~2"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>SAFETY</strong></td>
<td> =</td>
                <td>1.0D+2</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zero~490"></span>
              double precision,
            </td>
              <td>public,</td>
            <td>
              parameter
            </td>
            <td>::</td>
            <td><strong>ZERO</strong></td>
<td> =</td>
                <td>0.0D+0</td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a11~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a11</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a12~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a12</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a1i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a1i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a1r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a1r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a21~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a21</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a22~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a22</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a2i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a2i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-a2r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>a2r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad11~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad11</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad11l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad11l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad12~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad12</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad12l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad12l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad21~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad21</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad21l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad21l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad22~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad22</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad22l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad22l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ad32l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ad32l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-an"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>an</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-anorm~41"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>anorm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ascale~6"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ascale</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-atol~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>atol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b11~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b11</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b1a"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b1a</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b1i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b1i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b1r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b1r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b22~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b22</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b2a"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b2a</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b2i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b2i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b2r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>b2r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bn~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bn</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bnorm~11"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bnorm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bscale~6"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>bscale</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-btol~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>btol</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c~20"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c11i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c11i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c11r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c11r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c12"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c12</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c21"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c21</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c22i"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c22i</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-c22r"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>c22r</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cl"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cq"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cr~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-cz"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>cz</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-eshift~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>eshift</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-icompq~4"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>icompq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-icompz~7"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>icompz</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ifirst~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ifirst</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ifrstm~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ifrstm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iiter~6"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>iiter</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilast~5"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilast</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilastm~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilastm</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilazr2~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilazr2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilazro~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilazro</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilpivt"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilpivt</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilq~4"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilq</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilschr~2"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilschr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ilz~4"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ilz</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-in~22"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>in</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ischur~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ischur</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-istart~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>istart</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-j~421"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>j</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jc~25"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jc</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jch~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jch</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jiter~2"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jiter</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-jr~14"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>jr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-lquery~199"></span>
              logical,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>lquery</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-maxit~6"></span>
              integer,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>maxit</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-s~60"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>s</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-s1~6"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>s1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-s1inv"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>s1inv</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-s2~6"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>s2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-safmax~8"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>safmax</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-safmin~81"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>safmin</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-scale~49"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>scale</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sl~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sl</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sqi"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sqi</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sqr"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sqr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sr~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>sr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-szi"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>szi</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-szr"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>szr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t1~4"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>t1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tau~13"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>tau</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-temp~98"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>temp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-temp2~18"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>temp2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tempi"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>tempi</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tempr~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>tempr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u1"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>u1</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u12~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>u12</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u12l"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>u12l</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-u2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>u2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ulp~18"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>ulp</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-v~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>v</strong>(3)</td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-vs"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>vs</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w11"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>w11</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w12"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>w12</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w21"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>w21</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w22"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>w22</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wabs~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wabs</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wi~4"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wi</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wr~3"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wr</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-wr2~2"></span>
              double precision,
            </td>
              <td>public</td>
            <td>
              
            </td>
            <td>::</td>
            <td><strong>wr2</strong></td>
                <td></td>
                <td></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    </section>
    <br>
    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">DHGEQZ</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span><span class="n">Compq</span><span class="p">,</span><span class="n">Compz</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ihi</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Ldh</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">Ldt</span><span class="p">,</span><span class="n">Alphar</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="n">Alphai</span><span class="p">,</span><span class="n">Beta</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">Ldq</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Ldz</span><span class="p">,</span><span class="n">Work</span><span class="p">,</span><span class="n">Lwork</span><span class="p">,</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPLICIT NONE</span><span class="w"></span>
<span class="c">!*--DHGEQZ307</span>
<span class="c">!</span>
<span class="c">!  -- LAPACK computational routine (version 3.7.0) --</span>
<span class="c">!  -- LAPACK is a software package provided by Univ. of Tennessee,    --</span>
<span class="c">!  -- Univ. of California Berkeley, Univ. of Colorado Denver and NAG Ltd..--</span>
<span class="c">!     June 2016</span>
<span class="c">!</span>
<span class="c">!     .. Scalar Arguments ..</span>
<span class="w">      </span><span class="kt">CHARACTER </span><span class="n">Compq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Compz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Job</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">Ihi</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ilo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Info</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldh</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ldz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Lwork</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Array Arguments ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">Alphai</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Alphar</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Beta</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">Ldh</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">Q</span><span class="p">(</span><span class="n">Ldq</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">Ldt</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Work</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="n">Ldz</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!</span>
<span class="c">!  =====================================================================</span>
<span class="c">!</span>
<span class="c">!     .. Parameters ..</span>
<span class="c">!    $                     SAFETY = 1.0E+0 )</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">HALF</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ZERO</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ONE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">SAFETY</span><span class="w"></span>
<span class="w">      </span><span class="k">PARAMETER</span><span class="w"> </span><span class="p">(</span><span class="n">HALF</span><span class="o">=</span><span class="mf">0.5D+0</span><span class="p">,</span><span class="n">ZERO</span><span class="o">=</span><span class="mf">0.0D+0</span><span class="p">,</span><span class="n">ONE</span><span class="o">=</span><span class="mf">1.0D+0</span><span class="p">,</span><span class="n">SAFETY</span><span class="o">=</span><span class="mf">1.0D+2</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Scalars ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">ilazr2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilazro</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilpivt</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilschr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">lquery</span><span class="w"></span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">icompq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">icompz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ifirst</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">iiter</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">ilastm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ischur</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jc</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jch</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">jiter</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">        </span><span class="n">jr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxit</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">a11</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a12</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a1i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a1r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a21</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a22</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a2i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">a2r</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">ad11</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad11l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad12</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad12l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad21</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad21l</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">ad22</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad22l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ad32l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">anorm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ascale</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">atol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b11</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b1a</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b1i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b1r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b22</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b2a</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">b2i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">b2r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bn</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bnorm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">bscale</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">btol</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c11i</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">c11r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c12</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c21</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c22i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">c22r</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cq</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">cr</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">cz</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">eshift</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">s1inv</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">safmax</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">safmin</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">scale</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sl</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sqi</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sqr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">sr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">szi</span><span class="w"> </span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">szr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tau</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">temp2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tempi</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">tempr</span><span class="w"> </span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">u1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">u12</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">u12l</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">u2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ulp</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">w11</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">w12</span><span class="w"> </span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                 </span><span class="n">w21</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">w22</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wabs</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wi</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">wr2</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Local Arrays ..</span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Functions ..</span>
<span class="w">      </span><span class="kt">LOGICAL </span><span class="n">LSAME</span><span class="w"></span>
<span class="w">      </span><span class="kt">DOUBLE PRECISION </span><span class="n">DLAMCH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLANHS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAPY2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAPY3</span><span class="w"></span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">LSAME</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAMCH</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLANHS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAPY2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLAPY3</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. External Subroutines ..</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">DLAG2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLARFG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLARTG</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLASET</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DLASV2</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">DROT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">XERBLA</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Intrinsic Functions ..</span>
<span class="w">      </span><span class="k">INTRINSIC </span><span class="nb">ABS</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">DBLE</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MAX</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">SQRT</span><span class="w"></span>
<span class="c">!     ..</span>
<span class="c">!     .. Executable Statements ..</span>
<span class="c">!</span>
<span class="c">!     Decode JOB, COMPQ, COMPZ</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilschr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">ischur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Job</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilschr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">ischur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">ischur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compq</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compq</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compq</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">icompq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compz</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compz</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">LSAME</span><span class="p">(</span><span class="n">Compz</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">         </span><span class="n">icompz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span>
<span class="k">         </span><span class="n">icompz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Check Argument Values</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">lquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Lwork</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ischur</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icompq</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icompz</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ilo</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ihi</span><span class="o">&gt;</span><span class="n">N</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">Ihi</span><span class="o">&lt;</span><span class="n">Ilo</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldh</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldt</span><span class="o">&lt;</span><span class="n">N</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldq</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ilq</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldq</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">15</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ldz</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ilz</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">Ldz</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">17</span><span class="w"></span>
<span class="w">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Lwork</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">19</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span>
<span class="k">      IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         CALL </span><span class="n">XERBLA</span><span class="p">(</span><span class="s1">&#39;DHGEQZ&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Info</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lquery</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Quick return if possible</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">N</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">         </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="k">RETURN</span>
<span class="k">      ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Initialize Q and Z</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icompq</span><span class="o">==</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DLASET</span><span class="p">(</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">Ldq</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">icompz</span><span class="o">==</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DLASET</span><span class="p">(</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ZERO</span><span class="p">,</span><span class="n">ONE</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Ldz</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Machine Constants</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ihi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Ilo</span><span class="w"></span>
<span class="w">      </span><span class="n">safmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">safmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">safmin</span><span class="w"></span>
<span class="w">      </span><span class="n">ulp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">DLAMCH</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">anorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLANHS</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">in</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ilo</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">Work</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">bnorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLANHS</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">in</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">Ilo</span><span class="p">,</span><span class="n">Ilo</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="n">Work</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">atol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="n">anorm</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">btol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="n">bnorm</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">ascale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">anorm</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">bscale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">bnorm</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Set Eigenvalues IHI+1:N</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ihi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">         </span><span class="n">Alphar</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">Alphai</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Beta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     If IHI &lt; ILO, skip QZ steps</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">Ihi</span><span class="o">&gt;=</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     MAIN QZ ITERATION LOOP</span>
<span class="c">!</span>
<span class="c">!     Initialize dynamic indices</span>
<span class="c">!</span>
<span class="c">!     Eigenvalues ILAST+1:N have been found.</span>
<span class="c">!        Column operations modify rows IFRSTM:whatever.</span>
<span class="c">!        Row operations modify columns whatever:ILASTM.</span>
<span class="c">!</span>
<span class="c">!     If only eigenvalues are being computed, then</span>
<span class="c">!        IFRSTM is the row of the last splitting row above row ILAST;</span>
<span class="c">!        this is always at least ILO.</span>
<span class="c">!     IITER counts iterations since the last eigenvalue was found,</span>
<span class="c">!        to tell when to use an extraordinary shift.</span>
<span class="c">!     MAXIT is the maximum number of QZ sweeps allowed.</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ihi</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            </span><span class="n">ifrstm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">ilastm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">         </span><span class="k">ELSE</span>
<span class="k">            </span><span class="n">ifrstm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ilo</span><span class="w"></span>
<span class="w">            </span><span class="n">ilastm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ihi</span><span class="w"></span>
<span class="w">         </span><span class="k">ENDIF</span>
<span class="k">         </span><span class="n">iiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">         </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">maxit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="o">*</span><span class="p">(</span><span class="n">Ihi</span><span class="o">-</span><span class="n">Ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">         </span><span class="k">DO </span><span class="n">jiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">maxit</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Split the matrix if possible.</span>
<span class="c">!</span>
<span class="c">!        Two tests:</span>
<span class="c">!           1: H(j,j-1)=0  or  j=ILO</span>
<span class="c">!           2: T(j,j)=0</span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!           Special case: j=ILAST</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilast</span><span class="o">==</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w">                                  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="o">&lt;=</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">               </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">                                    </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="o">&lt;=</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">           </span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">               </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        General case: j&lt;ILAST</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ilo</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Test 1: for H(j,j-1)=0 or j=ILO</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">==</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">ilazro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w">                                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="o">&lt;=</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                  </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                  </span><span class="n">ilazro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">ilazro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Test 2: for T(j,j)=0</span>
<span class="c">!</span>
<span class="w">               </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">&lt;</span><span class="nb">MAX</span><span class="p">(</span><span class="n">safmin</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Test 1a: Check for 2 consecutive small subdiagonals in A</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">ilazr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">ilazro</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">temp2</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tempr</span><span class="o">&lt;</span><span class="n">ONE</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">tempr</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">/</span><span class="n">tempr</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp2</span><span class="o">/</span><span class="n">tempr</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span>
<span class="k">                     IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)))</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="o">&lt;=</span><span class="n">temp2</span><span class="o">*</span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">atol</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ilazr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              If both tests pass (1 &amp; 2), i.e., the leading diagonal</span>
<span class="c">!              element of B in the block is zero, split a 1x1 block off</span>
<span class="c">!              at the top. (I.e., at the J-th row/column) The leading</span>
<span class="c">!              diagonal element of the remainder can also be zero, so</span>
<span class="c">!              this may have to be done repeatedly.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilazro</span><span class="w"> </span><span class="p">.</span><span class="nb">OR</span><span class="p">.</span><span class="w"> </span><span class="n">ilazr2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                     DO </span><span class="n">jch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="p">))</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">-</span><span class="n">jch</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">-</span><span class="n">jch</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilazr2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="w"></span>
<span class="w">                        </span><span class="n">ilazr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">&gt;=</span><span class="n">btol</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;=</span><span class="n">ilast</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">                           </span><span class="n">ifirst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                           </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">60</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span>
<span class="k">                        </span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!                 Only test 2 passed -- chase the zero to T(ILAST,ILAST)</span>
<span class="c">!                 Then process as in the case T(ILAST,ILAST)=0</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">jch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jch</span><span class="o">&lt;</span><span class="n">ilastm</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w">                             </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">-</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">T</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">-</span><span class="n">jch</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">)&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                              </span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">jch</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">jch</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">jch</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                  ENDIF</span>
<span class="k">                  GOTO</span><span class="w"> </span><span class="mi">20</span><span class="w"></span>
<span class="w">               </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilazro</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Only test 1 passed -- work on J:ILAST</span>
<span class="c">!</span>
<span class="w">                  </span><span class="n">ifirst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                  </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">60</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Neither test passed -- try next J</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        (Drop-through is &quot;impossible&quot;)</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        T(ILAST,ILAST)=0 -- clear H(ILAST,ILAST-1) to split off a</span>
<span class="c">!        1x1 block.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">20</span><span class="w">         </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                </span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        H(ILAST,ILAST-1)=0 -- Standardize B, set ALPHAR, ALPHAI,</span>
<span class="c">!                              and BETA</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">40</span><span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">                     </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ELSE</span>
<span class="k">                  </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="n">Z</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span>
<span class="k">            </span><span class="n">Alphar</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">Alphai</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="n">Beta</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Go to next block -- exit if finished.</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilast</span><span class="o">&lt;</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Reset counters</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">iiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="n">ilastm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ifrstm</span><span class="o">&gt;</span><span class="n">ilast</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ilo</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            CYCLE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        QZ step</span>
<span class="c">!</span>
<span class="c">!        This iteration only involves rows/columns IFIRST:ILAST. We</span>
<span class="c">!        assume IFIRST &lt; ILAST, and that the diagonal of B is non-zero.</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">60</span><span class="w">         </span><span class="n">iiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iiter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifirst</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Compute single shifts.</span>
<span class="c">!</span>
<span class="c">!        At this point, IFIRST &lt; ILAST, and the diagonal elements of</span>
<span class="c">!        T(IFIRST:ILAST,IFIRST,ILAST) are larger than BTOL (in</span>
<span class="c">!        magnitude)</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">iiter</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">==</span><span class="n">iiter</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Exceptional shift.  Chosen for no particularly good reason.</span>
<span class="c">!           (Single shift only.)</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">maxit</span><span class="p">)</span><span class="o">*</span><span class="n">safmin</span><span class="p">)</span><span class="o">*</span><span class="nb">ABS</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="o">&lt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ELSE</span>
<span class="k">                  </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eshift</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="n">safmin</span><span class="o">*</span><span class="nb">DBLE</span><span class="p">(</span><span class="n">maxit</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">               </span><span class="n">wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eshift</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Shifts based on the generalized eigenvalues of the</span>
<span class="c">!           bottom-right 2x2 block of A and B. The first eigenvalue</span>
<span class="c">!           returned by DLAG2 is the Wilkinson shift (AEP p.512),</span>
<span class="c">!</span>
<span class="w">               </span><span class="k">CALL </span><span class="n">DLAG2</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">safmin</span><span class="o">*</span><span class="n">SAFETY</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">wr</span><span class="p">,</span><span class="n">wr2</span><span class="p">,</span><span class="n">wi</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">((</span><span class="n">wr</span><span class="o">/</span><span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="o">&gt;</span><span class="nb">ABS</span><span class="p">((</span><span class="n">wr2</span><span class="o">/</span><span class="n">s2</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="w"></span>
<span class="w">                  </span><span class="n">wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr2</span><span class="w"></span>
<span class="w">                  </span><span class="n">wr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="w"></span>
<span class="w">                  </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="w"></span>
<span class="w">                  </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">safmin</span><span class="o">*</span><span class="nb">MAX</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">wr</span><span class="p">),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">wi</span><span class="p">)))</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Use Francis double-shift</span>
<span class="c">!</span>
<span class="c">!        Note: the Francis double-shift should work with real shifts,</span>
<span class="c">!              but only if the block is at least 3x3.</span>
<span class="c">!              This code may break if this point is reached with</span>
<span class="c">!              a 2x2 block with real eigenvalues.</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="o">==</span><span class="n">ilast</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Special case -- 2x2 block with complex eigenvectors</span>
<span class="c">!</span>
<span class="c">!           Step 1: Standardize, that is, rotate so that</span>
<span class="c">!</span>
<span class="c">!                       ( B11  0  )</span>
<span class="c">!                   B = (         )  with B11 non-negative.</span>
<span class="c">!                       (  0  B22 )</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLASV2</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="n">b22</span><span class="p">,</span><span class="n">b11</span><span class="p">,</span><span class="n">sr</span><span class="p">,</span><span class="n">cr</span><span class="p">,</span><span class="n">sl</span><span class="p">,</span><span class="n">cl</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">b11</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">cr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">cr</span><span class="w"></span>
<span class="w">                        </span><span class="n">sr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sr</span><span class="w"></span>
<span class="w">                        </span><span class="n">b11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">b11</span><span class="w"></span>
<span class="w">                        </span><span class="n">b22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">b22</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ifirst</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="n">cl</span><span class="p">,</span><span class="n">sl</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilast</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                         </span><span class="n">H</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cr</span><span class="p">,</span><span class="n">sr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilast</span><span class="o">&lt;</span><span class="n">ilastm</span><span class="w"> </span><span class="p">)</span><span class="w">                                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ilastm</span><span class="o">-</span><span class="n">ilast</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="n">cl</span><span class="p">,</span><span class="n">sl</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ifrstm</span><span class="o">&lt;</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">ifirst</span><span class="o">-</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">T</span><span class="p">(</span><span class="n">ifrstm</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">cr</span><span class="p">,</span><span class="n">sr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Q</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">cl</span><span class="p">,</span><span class="n">sl</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">CALL </span><span class="n">DROT</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">),</span><span class="mi">1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                    </span><span class="n">cr</span><span class="p">,</span><span class="n">sr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b11</span><span class="w"></span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b22</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           If B22 is negative, negate column ILAST</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">b22</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                              </span><span class="n">Z</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDDO</span>
<span class="k">                        ENDIF</span>
<span class="k">                        </span><span class="n">b22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">b22</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Step 2: Compute ALPHAR, ALPHAI, and BETA (see refs.)</span>
<span class="c">!</span>
<span class="c">!           Recompute shift</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLAG2</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldh</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">Ldt</span><span class="p">,</span><span class="n">safmin</span><span class="o">*</span><span class="n">SAFETY</span><span class="p">,</span><span class="n">s1</span><span class="p">,&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                          </span><span class="n">temp</span><span class="p">,</span><span class="n">wr</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">wi</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           If standardization has perturbed the shift onto real line,</span>
<span class="c">!           do another (real single-shift) QR step.</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        </span><span class="n">s1inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="o">/</span><span class="n">s1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Do EISPACK (QZVAL) computation of alpha and beta</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">a11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">a21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">a12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">a22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Compute complex Givens rotation on right</span>
<span class="c">!           (Assume some element of C = (sA - wB) &gt; unfl )</span>
<span class="c">!                            __</span>
<span class="c">!           (sA - wB) ( CZ   -SZ )</span>
<span class="c">!                     ( SZ    CZ )</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">c11r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">a11</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wr</span><span class="o">*</span><span class="n">b11</span><span class="w"></span>
<span class="w">                        </span><span class="n">c11i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">wi</span><span class="o">*</span><span class="n">b11</span><span class="w"></span>
<span class="w">                        </span><span class="n">c12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">a12</span><span class="w"></span>
<span class="w">                        </span><span class="n">c21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">a21</span><span class="w"></span>
<span class="w">                        </span><span class="n">c22r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">a22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wr</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="w">                        </span><span class="n">c22i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">wi</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">c11r</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">c11i</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">c12</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">c21</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">c22r</span><span class="p">)</span><span class="o">+</span><span class="nb">ABS</span><span class="p">(</span><span class="n">c22i</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY3</span><span class="p">(</span><span class="n">c12</span><span class="p">,</span><span class="n">c11r</span><span class="p">,</span><span class="n">c11i</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">cz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c12</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                           </span><span class="n">szr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">c11r</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                           </span><span class="n">szi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">c11i</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                        </span><span class="k">ELSE</span>
<span class="k">                           </span><span class="n">cz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY2</span><span class="p">(</span><span class="n">c22r</span><span class="p">,</span><span class="n">c22i</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cz</span><span class="o">&lt;=</span><span class="n">safmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">cz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                              </span><span class="n">szr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                              </span><span class="n">szi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="k">ELSE</span>
<span class="k">                              </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c22r</span><span class="o">/</span><span class="n">cz</span><span class="w"></span>
<span class="w">                              </span><span class="n">tempi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c22i</span><span class="o">/</span><span class="n">cz</span><span class="w"></span>
<span class="w">                              </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY2</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">c21</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">cz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cz</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                              </span><span class="n">szr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">c21</span><span class="o">*</span><span class="n">tempr</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                              </span><span class="n">szi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c21</span><span class="o">*</span><span class="n">tempi</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Compute Givens rotation on left</span>
<span class="c">!</span>
<span class="c">!           (  CQ   SQ )</span>
<span class="c">!           (  __      )  A or B</span>
<span class="c">!           ( -SQ   CQ )</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">an</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">a11</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">a12</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">a21</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">a22</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">bn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">b11</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">b22</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">wabs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">wi</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">an</span><span class="o">&gt;</span><span class="n">wabs</span><span class="o">*</span><span class="n">bn</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cz</span><span class="o">*</span><span class="n">b11</span><span class="w"></span>
<span class="w">                           </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">szr</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="w">                           </span><span class="n">sqi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">szi</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="w">                        </span><span class="k">ELSE</span>
<span class="k">                           </span><span class="n">a1r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cz</span><span class="o">*</span><span class="n">a11</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">szr</span><span class="o">*</span><span class="n">a12</span><span class="w"></span>
<span class="w">                           </span><span class="n">a1i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">szi</span><span class="o">*</span><span class="n">a12</span><span class="w"></span>
<span class="w">                           </span><span class="n">a2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cz</span><span class="o">*</span><span class="n">a21</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">szr</span><span class="o">*</span><span class="n">a22</span><span class="w"></span>
<span class="w">                           </span><span class="n">a2i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">szi</span><span class="o">*</span><span class="n">a22</span><span class="w"></span>
<span class="w">                           </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY2</span><span class="p">(</span><span class="n">a1r</span><span class="p">,</span><span class="n">a1i</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cq</span><span class="o">&lt;=</span><span class="n">safmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                              </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                              </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                              </span><span class="n">sqi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="k">ELSE</span>
<span class="k">                              </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1r</span><span class="o">/</span><span class="n">cq</span><span class="w"></span>
<span class="w">                              </span><span class="n">tempi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1i</span><span class="o">/</span><span class="n">cq</span><span class="w"></span>
<span class="w">                              </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempr</span><span class="o">*</span><span class="n">a2r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tempi</span><span class="o">*</span><span class="n">a2i</span><span class="w"></span>
<span class="w">                              </span><span class="n">sqi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempi</span><span class="o">*</span><span class="n">a2r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tempr</span><span class="o">*</span><span class="n">a2i</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDIF</span>
<span class="k">                        ENDIF</span>
<span class="k">                        </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY3</span><span class="p">(</span><span class="n">cq</span><span class="p">,</span><span class="n">sqr</span><span class="p">,</span><span class="n">sqi</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">cq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                        </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqr</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                        </span><span class="n">sqi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqi</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Compute diagonal elements of QBZ</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqr</span><span class="o">*</span><span class="n">szr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sqi</span><span class="o">*</span><span class="n">szi</span><span class="w"></span>
<span class="w">                        </span><span class="n">tempi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqr</span><span class="o">*</span><span class="n">szi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sqi</span><span class="o">*</span><span class="n">szr</span><span class="w"></span>
<span class="w">                        </span><span class="n">b1r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="o">*</span><span class="n">cz</span><span class="o">*</span><span class="n">b11</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tempr</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="w">                        </span><span class="n">b1i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempi</span><span class="o">*</span><span class="n">b22</span><span class="w"></span>
<span class="w">                        </span><span class="n">b1a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY2</span><span class="p">(</span><span class="n">b1r</span><span class="p">,</span><span class="n">b1i</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">b2r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cq</span><span class="o">*</span><span class="n">cz</span><span class="o">*</span><span class="n">b22</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tempr</span><span class="o">*</span><span class="n">b11</span><span class="w"></span>
<span class="w">                        </span><span class="n">b2i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">tempi</span><span class="o">*</span><span class="n">b11</span><span class="w"></span>
<span class="w">                        </span><span class="n">b2a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DLAPY2</span><span class="p">(</span><span class="n">b2r</span><span class="p">,</span><span class="n">b2i</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Normalize so beta &gt; 0, and Im( alpha1 ) &gt; 0</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">Beta</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b1a</span><span class="w"></span>
<span class="w">                        </span><span class="n">Beta</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b2a</span><span class="w"></span>
<span class="w">                        </span><span class="n">Alphar</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">wr</span><span class="o">*</span><span class="n">b1a</span><span class="p">)</span><span class="o">*</span><span class="n">s1inv</span><span class="w"></span>
<span class="w">                        </span><span class="n">Alphai</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">wi</span><span class="o">*</span><span class="n">b1a</span><span class="p">)</span><span class="o">*</span><span class="n">s1inv</span><span class="w"></span>
<span class="w">                        </span><span class="n">Alphar</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">wr</span><span class="o">*</span><span class="n">b2a</span><span class="p">)</span><span class="o">*</span><span class="n">s1inv</span><span class="w"></span>
<span class="w">                        </span><span class="n">Alphai</span><span class="p">(</span><span class="n">ilast</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="p">(</span><span class="n">wi</span><span class="o">*</span><span class="n">b2a</span><span class="p">)</span><span class="o">*</span><span class="n">s1inv</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Step 3: Go to next block -- exit if finished.</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">ilast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifirst</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilast</span><span class="o">&lt;</span><span class="n">Ilo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Reset counters</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">iiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">                        </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">NOT</span><span class="p">.</span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">ilastm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">                           </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ifrstm</span><span class="o">&gt;</span><span class="n">ilast</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ilo</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span>
<span class="k">                     ENDIF</span>
<span class="k">                  ELSE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Usual case: 3x3 or larger block, using Francis implicit</span>
<span class="c">!                       double-shift</span>
<span class="c">!</span>
<span class="c">!                                    2</span>
<span class="c">!           Eigenvalue equation is  w  - c w + d = 0,</span>
<span class="c">!</span>
<span class="c">!                                         -1 2        -1</span>
<span class="c">!           so compute 1st column of  (A B  )  - c A B   + d</span>
<span class="c">!           using the formula in QZIT (from EISPACK)</span>
<span class="c">!</span>
<span class="c">!           We assume that the block is at least 3x3</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">ad11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">                   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">u12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">(</span><span class="n">ilast</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad11l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ifirst</span><span class="p">,</span><span class="n">ifirst</span><span class="p">))</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="p">,</span><span class="n">ifirst</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad21l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="p">))</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="p">,</span><span class="n">ifirst</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad12l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ifirst</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad22l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">ad32l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w">              </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="o">/</span><span class="p">(</span><span class="n">bscale</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">u12l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">(</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ifirst</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ad11</span><span class="o">-</span><span class="n">ad11l</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ad22</span><span class="o">-</span><span class="n">ad11l</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ad12</span><span class="o">*</span><span class="n">ad21</span><span class="w"> </span><span class="o">+</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="n">ad21</span><span class="o">*</span><span class="n">u12</span><span class="o">*</span><span class="n">ad11l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">ad12l</span><span class="o">-</span><span class="n">ad11l</span><span class="o">*</span><span class="n">u12l</span><span class="p">)</span><span class="o">*</span><span class="n">ad21l</span><span class="w"></span>
<span class="w">                     </span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ad22l</span><span class="o">-</span><span class="n">ad11l</span><span class="p">)</span><span class="o">-</span><span class="n">ad21l</span><span class="o">*</span><span class="n">u12l</span><span class="o">-</span><span class="p">(</span><span class="n">ad11</span><span class="o">-</span><span class="n">ad11l</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                      </span><span class="o">-</span><span class="p">(</span><span class="n">ad22</span><span class="o">-</span><span class="n">ad11l</span><span class="p">)</span><span class="o">+</span><span class="n">ad21</span><span class="o">*</span><span class="n">u12</span><span class="p">)</span><span class="o">*</span><span class="n">ad21l</span><span class="w"></span>
<span class="w">                     </span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ad32l</span><span class="o">*</span><span class="n">ad21l</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">istart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifirst</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLARFG</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">tau</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Sweep</span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              All but last elements: use 3x3 Householder transforms.</span>
<span class="c">!</span>
<span class="c">!              Zero (j-1)st column of A</span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">istart</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                           </span><span class="k">CALL </span><span class="n">DLARFG</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">tau</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">DO </span><span class="n">jc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilastm</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">))</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                             </span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">))</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp2</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp2</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp2</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                              </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">                              </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                              </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDDO</span>
<span class="k">                        ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Zero j-th column of B (see DLAGBC for details)</span>
<span class="c">!</span>
<span class="c">!              Swap rows to pivot</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">ilpivt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">FALSE</span><span class="p">.</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span><span class="nb">ABS</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">temp2</span><span class="p">)</span><span class="o">&lt;</span><span class="n">safmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                           </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">62</span><span class="w"></span>
<span class="w">                        </span><span class="n">ELSEIF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">temp</span><span class="o">&gt;=</span><span class="n">temp2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">w11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ELSE</span>
<span class="k">                           </span><span class="n">w21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">w12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Swap columns if nec.</span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">w12</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">w11</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">ilpivt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">TRUE</span><span class="p">.</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w12</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w22</span><span class="w"></span>
<span class="w">                           </span><span class="n">w12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w11</span><span class="w"></span>
<span class="w">                           </span><span class="n">w22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w21</span><span class="w"></span>
<span class="w">                           </span><span class="n">w11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                           </span><span class="n">w21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp2</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              LU-factor</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w21</span><span class="o">/</span><span class="n">w11</span><span class="w"></span>
<span class="w">                        </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">u1</span><span class="w"></span>
<span class="w">                        </span><span class="n">w22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w22</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">w12</span><span class="w"></span>
<span class="w">                        </span><span class="n">w21</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Compute SCALE</span>
<span class="c">!</span>
<span class="w">                        </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">w22</span><span class="p">)</span><span class="o">&lt;</span><span class="n">safmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                           </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                           </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">w12</span><span class="o">/</span><span class="n">w11</span><span class="w"></span>
<span class="w">                           </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">62</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span>
<span class="k">                        IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">w22</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">w22</span><span class="o">/</span><span class="n">u2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">w11</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">ABS</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">                         </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                       </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="nb">scale</span><span class="p">,</span><span class="nb">ABS</span><span class="p">(</span><span class="n">w11</span><span class="o">/</span><span class="n">u1</span><span class="p">))</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Solve</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">scale</span><span class="o">*</span><span class="n">u2</span><span class="p">)</span><span class="o">/</span><span class="n">w22</span><span class="w"></span>
<span class="w">                        </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb">scale</span><span class="o">*</span><span class="n">u1</span><span class="o">-</span><span class="n">w12</span><span class="o">*</span><span class="n">u2</span><span class="p">)</span><span class="o">/</span><span class="n">w11</span><span class="w"></span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">62</span><span class="w">                     </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilpivt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u2</span><span class="w"></span>
<span class="w">                           </span><span class="n">u2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u1</span><span class="w"></span>
<span class="w">                           </span><span class="n">u1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Compute Householder Vector</span>
<span class="c">!</span>
<span class="w">                        </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">SQRT</span><span class="p">(</span><span class="nb">scale</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">tau</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">scale</span><span class="o">/</span><span class="n">t1</span><span class="w"></span>
<span class="w">                        </span><span class="n">vs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">ONE</span><span class="o">/</span><span class="p">(</span><span class="nb">scale</span><span class="o">+</span><span class="n">t1</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">                        </span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vs</span><span class="o">*</span><span class="n">u1</span><span class="w"></span>
<span class="w">                        </span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vs</span><span class="o">*</span><span class="n">u2</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!              Apply transformations from the right.</span>
<span class="c">!</span>
<span class="w">                        </span><span class="k">DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                            </span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                        IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                           DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                              </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w">   </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">                               </span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span><span class="w"></span>
<span class="w">                              </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                              </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">                              </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="k">ENDDO</span>
<span class="k">                        ENDIF</span>
<span class="k">                        </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Last elements: Use Givens rotations</span>
<span class="c">!</span>
<span class="c">!           Rotations from the left</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">jc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilastm</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp2</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                     ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           Rotations from the right.</span>
<span class="c">!</span>
<span class="w">                     </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                     </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                     </span><span class="k">DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                        </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                     </span><span class="k">ENDDO</span>
<span class="k">                     IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                        DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                           </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                           </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                        </span><span class="k">ENDDO</span>
<span class="k">                     ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!           End of Double-Shift code</span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">                  </span><span class="k">CYCLE</span>
<span class="k">               ENDIF</span>
<span class="k">            ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Fiddle with shift to avoid overflow</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">ascale</span><span class="p">,</span><span class="n">ONE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">HALF</span><span class="o">*</span><span class="n">safmax</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">s1</span><span class="o">&gt;</span><span class="n">temp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">/</span><span class="n">s1</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span>
<span class="k">               </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ONE</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">bscale</span><span class="p">,</span><span class="n">ONE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">HALF</span><span class="o">*</span><span class="n">safmax</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span><span class="o">&gt;</span><span class="n">temp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="nb">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="nb">scale</span><span class="p">,</span><span class="n">temp</span><span class="o">/</span><span class="nb">ABS</span><span class="p">(</span><span class="n">wr</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">scale</span><span class="o">*</span><span class="n">s1</span><span class="w"></span>
<span class="w">            </span><span class="n">wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">scale</span><span class="o">*</span><span class="n">wr</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Now check for two consecutive small subdiagonals.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ifirst</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="n">istart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">               </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ABS</span><span class="p">(</span><span class="n">s1</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">wr</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">MAX</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">temp2</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tempr</span><span class="o">&lt;</span><span class="n">ONE</span><span class="w"> </span><span class="p">.</span><span class="nb">AND</span><span class="p">.</span><span class="w"> </span><span class="n">tempr</span><span class="o">/=</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="o">/</span><span class="n">tempr</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp2</span><span class="o">/</span><span class="n">tempr</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">ABS</span><span class="p">((</span><span class="n">ascale</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">ascale</span><span class="o">*</span><span class="n">atol</span><span class="p">)</span><span class="o">*</span><span class="n">temp2</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<span class="w">     </span><span class="p">&amp;</span><span class="w">              </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">80</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="n">istart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifirst</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Do an implicit single-shift QZ sweep.</span>
<span class="c">!</span>
<span class="c">!        Initial Q</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">80</span><span class="w">         </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">istart</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wr</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">istart</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">istart</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">tempr</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        Sweep</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilast</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">               </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="o">&gt;</span><span class="n">istart</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">jc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ilastm</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jc</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp2</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Q</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">CALL </span><span class="n">DLARTG</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="c">!</span>
<span class="w">               </span><span class="k">DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="nb">MIN</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifrstm</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">               IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">                  DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                     </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"></span>
<span class="w">                  </span><span class="k">ENDDO</span>
<span class="k">               ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="w">            </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!        End of iteration loop</span>
<span class="c">!</span>
<span class="w">         </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Drop-through = non-convergence</span>
<span class="c">!</span>
<span class="w">         </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilast</span><span class="w"></span>
<span class="w">         </span><span class="k">GOTO</span><span class="w"> </span><span class="mi">200</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Successful completion of all QZ steps</span>
<span class="c">!</span>
<span class="c">!</span>
<span class="c">!     Set Eigenvalues 1:ILO-1</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">100</span><span class="w">  </span><span class="k">DO </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">Ilo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">         </span><span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">&lt;</span><span class="n">ZERO</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilschr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"></span>
<span class="w">                  </span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ELSE</span>
<span class="k">               </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span>
<span class="k">            IF</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span>
<span class="k">               DO </span><span class="n">jr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="w"></span>
<span class="w">                  </span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">Z</span><span class="p">(</span><span class="n">jr</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">ENDDO</span>
<span class="k">            ENDIF</span>
<span class="k">         ENDIF</span>
<span class="k">         </span><span class="n">Alphar</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">H</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">Alphai</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZERO</span><span class="w"></span>
<span class="w">         </span><span class="n">Beta</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDDO</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Normal Termination</span>
<span class="c">!</span>
<span class="w">      </span><span class="n">Info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     Exit (other than argument error) -- return optimal workspace size</span>
<span class="c">!</span>
<span class="w"> </span><span class="mi">200</span><span class="w">  </span><span class="n">Work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">DBLE</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="w"></span>
<span class="c">!</span>
<span class="c">!     End of DHGEQZ</span>
<span class="c">!</span>
<span class="w">      </span><span class="k">END SUBROUTINE </span><span class="n">DHGEQZ</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              spag_lapack
 was developed by John S. Urban<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2025-07-11 01:31 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>